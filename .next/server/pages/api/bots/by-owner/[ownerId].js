"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/bots/by-owner/[ownerId]";
exports.ids = ["pages/api/bots/by-owner/[ownerId]"];
exports.modules = {

/***/ "firebase-admin/app":
/*!*************************************!*\
  !*** external "firebase-admin/app" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("firebase-admin/app");

/***/ }),

/***/ "firebase-admin/auth":
/*!**************************************!*\
  !*** external "firebase-admin/auth" ***!
  \**************************************/
/***/ ((module) => {

module.exports = require("firebase-admin/auth");

/***/ }),

/***/ "firebase-admin/firestore":
/*!*******************************************!*\
  !*** external "firebase-admin/firestore" ***!
  \*******************************************/
/***/ ((module) => {

module.exports = require("firebase-admin/firestore");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "firebase/app":
/*!*******************************!*\
  !*** external "firebase/app" ***!
  \*******************************/
/***/ ((module) => {

module.exports = import("firebase/app");;

/***/ }),

/***/ "firebase/auth":
/*!********************************!*\
  !*** external "firebase/auth" ***!
  \********************************/
/***/ ((module) => {

module.exports = import("firebase/auth");;

/***/ }),

/***/ "firebase/firestore":
/*!*************************************!*\
  !*** external "firebase/firestore" ***!
  \*************************************/
/***/ ((module) => {

module.exports = import("firebase/firestore");;

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbots%2Fby-owner%2F%5BownerId%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fbots%2Fby-owner%2F%5BownerId%5D.ts&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbots%2Fby-owner%2F%5BownerId%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fbots%2Fby-owner%2F%5BownerId%5D.ts&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_bots_by_owner_ownerId_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/bots/by-owner/[ownerId].ts */ \"(api)/./pages/api/bots/by-owner/[ownerId].ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_bots_by_owner_ownerId_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_bots_by_owner_ownerId_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_bots_by_owner_ownerId_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_bots_by_owner_ownerId_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/bots/by-owner/[ownerId]\",\n        pathname: \"/api/bots/by-owner/[ownerId]\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_bots_by_owner_ownerId_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmJvdHMlMkZieS1vd25lciUyRiU1Qm93bmVySWQlNUQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmJvdHMlMkZieS1vd25lciUyRiU1Qm93bmVySWQlNUQudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDbUU7QUFDbkU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLGdFQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxnRUFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hc3F1ZS1ib3QtcGxhdGZvcm0vPzZkYTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9ib3RzL2J5LW93bmVyL1tvd25lcklkXS50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2JvdHMvYnktb3duZXIvW293bmVySWRdXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYm90cy9ieS1vd25lci9bb3duZXJJZF1cIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbots%2Fby-owner%2F%5BownerId%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fbots%2Fby-owner%2F%5BownerId%5D.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/auth/server.ts":
/*!****************************!*\
  !*** ./lib/auth/server.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authenticateRequest: () => (/* binding */ authenticateRequest),\n/* harmony export */   verifyAuthToken: () => (/* binding */ verifyAuthToken),\n/* harmony export */   verifyBotOwnership: () => (/* binding */ verifyBotOwnership),\n/* harmony export */   withAuth: () => (/* binding */ withAuth),\n/* harmony export */   withBotOwnership: () => (/* binding */ withBotOwnership)\n/* harmony export */ });\n/* harmony import */ var firebase_admin_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase-admin/auth */ \"firebase-admin/auth\");\n/* harmony import */ var firebase_admin_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(firebase_admin_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase-admin/app */ \"firebase-admin/app\");\n/* harmony import */ var firebase_admin_app__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__);\n\n\n// Initialize Firebase Admin if not already initialized\nif (!(0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__.getApps)().length) {\n    const privateKey = process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\");\n    if (process.env.FIREBASE_PROJECT_ID && process.env.FIREBASE_CLIENT_EMAIL && privateKey) {\n        (0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__.initializeApp)({\n            credential: (0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__.cert)({\n                projectId: process.env.FIREBASE_PROJECT_ID,\n                clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\n                privateKey: privateKey\n            })\n        });\n        console.log(\"\\uD83D\\uDD25 Firebase Admin initialized\");\n    } else {\n        console.warn(\"⚠️ Firebase Admin not initialized - missing environment variables\");\n    }\n}\n// Extract auth token from request headers\nconst getAuthToken = (req)=>{\n    const authHeader = req.headers.authorization;\n    if (authHeader && authHeader.startsWith(\"Bearer \")) {\n        return authHeader.substring(7);\n    }\n    // Also check for token in cookies (for browser requests)\n    const tokenFromCookie = req.cookies[\"auth-token\"];\n    if (tokenFromCookie) {\n        return tokenFromCookie;\n    }\n    return null;\n};\n// Verify Firebase auth token and return user info\nconst verifyAuthToken = async (token)=>{\n    try {\n        const auth = (0,firebase_admin_auth__WEBPACK_IMPORTED_MODULE_0__.getAuth)();\n        const decodedToken = await auth.verifyIdToken(token);\n        return {\n            uid: decodedToken.uid,\n            email: decodedToken.email,\n            phoneNumber: decodedToken.phone_number\n        };\n    } catch (error) {\n        console.error(\"❌ Token verification failed:\", error);\n        throw new Error(\"Invalid authentication token\");\n    }\n};\n// Middleware function to authenticate API requests\nconst authenticateRequest = async (req, res)=>{\n    try {\n        const token = getAuthToken(req);\n        if (!token) {\n            res.status(401).json({\n                success: false,\n                error: \"Authentication required\",\n                timestamp: new Date()\n            });\n            return null;\n        }\n        const user = await verifyAuthToken(token);\n        return user;\n    } catch (error) {\n        console.error(\"❌ Authentication error:\", error);\n        res.status(401).json({\n            success: false,\n            error: \"Invalid authentication credentials\",\n            timestamp: new Date()\n        });\n        return null;\n    }\n};\n// Higher-order function to wrap API handlers with authentication\nconst withAuth = (handler)=>{\n    return async (req, res)=>{\n        const user = await authenticateRequest(req, res);\n        if (!user) {\n            // Response already sent by authenticateRequest\n            return;\n        }\n        // Add user to request object\n        req.user = user;\n        // Call the original handler\n        return handler(req, res);\n    };\n};\n// Verify bot ownership (now with phone number fallback)\nconst verifyBotOwnership = async (botId, userId, userPhoneNumber)=>{\n    try {\n        // Import here to avoid circular dependency\n        const { serverDb } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @/lib/database */ \"(api)/./lib/database/index.ts\"));\n        const bot = await serverDb.getBot(botId);\n        if (!bot) {\n            return false;\n        }\n        // Direct ownership check\n        if (bot.ownerId === userId) {\n            return true;\n        }\n        // Phone number fallback\n        if (userPhoneNumber && bot.ownerPhoneNumber === userPhoneNumber) {\n            console.log(\"✅ Bot ownership verified via phone number fallback\");\n            // Update the bot's ownerId for future consistency\n            bot.ownerId = userId;\n            await serverDb.updateBot(bot);\n            return true;\n        }\n        return false;\n    } catch (error) {\n        console.error(\"❌ Error verifying bot ownership:\", error);\n        return false;\n    }\n};\n// Middleware to verify bot ownership for bot-specific operations\nconst withBotOwnership = (handler)=>{\n    return withAuth(async (req, res)=>{\n        const { botId } = req.query;\n        if (!botId || typeof botId !== \"string\") {\n            return res.status(400).json({\n                success: false,\n                error: \"Bot ID is required\",\n                timestamp: new Date()\n            });\n        }\n        const isOwner = await verifyBotOwnership(botId, req.user.uid, req.user.phoneNumber);\n        if (!isOwner) {\n            return res.status(403).json({\n                success: false,\n                error: \"Access denied: You do not own this bot\",\n                timestamp: new Date()\n            });\n        }\n        return handler(req, res);\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YnBhY2s6Ly9hc3F1ZS1ib3QtcGxhdGZvcm0vLi9saWIvYXV0aC9zZXJ2ZXIudHM/OTI2MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgeyBnZXRBdXRoIH0gZnJvbSAnZmlyZWJhc2UtYWRtaW4vYXV0aCc7XG5pbXBvcnQgeyBpbml0aWFsaXplQXBwLCBnZXRBcHBzLCBjZXJ0IH0gZnJvbSAnZmlyZWJhc2UtYWRtaW4vYXBwJztcblxuLy8gSW5pdGlhbGl6ZSBGaXJlYmFzZSBBZG1pbiBpZiBub3QgYWxyZWFkeSBpbml0aWFsaXplZFxuaWYgKCFnZXRBcHBzKCkubGVuZ3RoKSB7XG4gIGNvbnN0IHByaXZhdGVLZXkgPSBwcm9jZXNzLmVudi5GSVJFQkFTRV9QUklWQVRFX0tFWT8ucmVwbGFjZSgvXFxcXG4vZywgJ1xcbicpO1xuICBcbiAgaWYgKHByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQgJiYgcHJvY2Vzcy5lbnYuRklSRUJBU0VfQ0xJRU5UX0VNQUlMICYmIHByaXZhdGVLZXkpIHtcbiAgICBpbml0aWFsaXplQXBwKHtcbiAgICAgIGNyZWRlbnRpYWw6IGNlcnQoe1xuICAgICAgICBwcm9qZWN0SWQ6IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQsXG4gICAgICAgIGNsaWVudEVtYWlsOiBwcm9jZXNzLmVudi5GSVJFQkFTRV9DTElFTlRfRU1BSUwsXG4gICAgICAgIHByaXZhdGVLZXk6IHByaXZhdGVLZXksXG4gICAgICB9KSxcbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZygn8J+UpSBGaXJlYmFzZSBBZG1pbiBpbml0aWFsaXplZCcpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZpcmViYXNlIEFkbWluIG5vdCBpbml0aWFsaXplZCAtIG1pc3NpbmcgZW52aXJvbm1lbnQgdmFyaWFibGVzJyk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdXRoZW50aWNhdGVkVXNlciB7XG4gIHVpZDogc3RyaW5nO1xuICBlbWFpbD86IHN0cmluZztcbiAgcGhvbmVOdW1iZXI/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0aGVudGljYXRlZFJlcXVlc3QgZXh0ZW5kcyBOZXh0QXBpUmVxdWVzdCB7XG4gIHVzZXI6IEF1dGhlbnRpY2F0ZWRVc2VyO1xufVxuXG4vLyBFeHRyYWN0IGF1dGggdG9rZW4gZnJvbSByZXF1ZXN0IGhlYWRlcnNcbmNvbnN0IGdldEF1dGhUb2tlbiA9IChyZXE6IE5leHRBcGlSZXF1ZXN0KTogc3RyaW5nIHwgbnVsbCA9PiB7XG4gIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xuICBcbiAgaWYgKGF1dGhIZWFkZXIgJiYgYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICByZXR1cm4gYXV0aEhlYWRlci5zdWJzdHJpbmcoNyk7XG4gIH1cbiAgXG4gIC8vIEFsc28gY2hlY2sgZm9yIHRva2VuIGluIGNvb2tpZXMgKGZvciBicm93c2VyIHJlcXVlc3RzKVxuICBjb25zdCB0b2tlbkZyb21Db29raWUgPSByZXEuY29va2llc1snYXV0aC10b2tlbiddO1xuICBpZiAodG9rZW5Gcm9tQ29va2llKSB7XG4gICAgcmV0dXJuIHRva2VuRnJvbUNvb2tpZTtcbiAgfVxuICBcbiAgcmV0dXJuIG51bGw7XG59O1xuXG4vLyBWZXJpZnkgRmlyZWJhc2UgYXV0aCB0b2tlbiBhbmQgcmV0dXJuIHVzZXIgaW5mb1xuZXhwb3J0IGNvbnN0IHZlcmlmeUF1dGhUb2tlbiA9IGFzeW5jICh0b2tlbjogc3RyaW5nKTogUHJvbWlzZTxBdXRoZW50aWNhdGVkVXNlcj4gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGF1dGggPSBnZXRBdXRoKCk7XG4gICAgY29uc3QgZGVjb2RlZFRva2VuID0gYXdhaXQgYXV0aC52ZXJpZnlJZFRva2VuKHRva2VuKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdWlkOiBkZWNvZGVkVG9rZW4udWlkLFxuICAgICAgZW1haWw6IGRlY29kZWRUb2tlbi5lbWFpbCxcbiAgICAgIHBob25lTnVtYmVyOiBkZWNvZGVkVG9rZW4ucGhvbmVfbnVtYmVyLFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIFRva2VuIHZlcmlmaWNhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhdXRoZW50aWNhdGlvbiB0b2tlbicpO1xuICB9XG59O1xuXG4vLyBNaWRkbGV3YXJlIGZ1bmN0aW9uIHRvIGF1dGhlbnRpY2F0ZSBBUEkgcmVxdWVzdHNcbmV4cG9ydCBjb25zdCBhdXRoZW50aWNhdGVSZXF1ZXN0ID0gYXN5bmMgKFxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxuICByZXM6IE5leHRBcGlSZXNwb25zZVxuKTogUHJvbWlzZTxBdXRoZW50aWNhdGVkVXNlciB8IG51bGw+ID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB0b2tlbiA9IGdldEF1dGhUb2tlbihyZXEpO1xuICAgIFxuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB2ZXJpZnlBdXRoVG9rZW4odG9rZW4pO1xuICAgIHJldHVybiB1c2VyO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBBdXRoZW50aWNhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0ludmFsaWQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgfSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cbi8vIEhpZ2hlci1vcmRlciBmdW5jdGlvbiB0byB3cmFwIEFQSSBoYW5kbGVycyB3aXRoIGF1dGhlbnRpY2F0aW9uXG5leHBvcnQgY29uc3Qgd2l0aEF1dGggPSAoXG4gIGhhbmRsZXI6IChyZXE6IEF1dGhlbnRpY2F0ZWRSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkgPT4gUHJvbWlzZTx2b2lkPlxuKSA9PiB7XG4gIHJldHVybiBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aGVudGljYXRlUmVxdWVzdChyZXEsIHJlcyk7XG4gICAgXG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICAvLyBSZXNwb25zZSBhbHJlYWR5IHNlbnQgYnkgYXV0aGVudGljYXRlUmVxdWVzdFxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgdXNlciB0byByZXF1ZXN0IG9iamVjdFxuICAgIChyZXEgYXMgQXV0aGVudGljYXRlZFJlcXVlc3QpLnVzZXIgPSB1c2VyO1xuICAgIFxuICAgIC8vIENhbGwgdGhlIG9yaWdpbmFsIGhhbmRsZXJcbiAgICByZXR1cm4gaGFuZGxlcihyZXEgYXMgQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlcyk7XG4gIH07XG59O1xuXG4vLyBWZXJpZnkgYm90IG93bmVyc2hpcCAobm93IHdpdGggcGhvbmUgbnVtYmVyIGZhbGxiYWNrKVxuZXhwb3J0IGNvbnN0IHZlcmlmeUJvdE93bmVyc2hpcCA9IGFzeW5jIChcbiAgYm90SWQ6IHN0cmluZyxcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHVzZXJQaG9uZU51bWJlcj86IHN0cmluZ1xuKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gIHRyeSB7XG4gICAgLy8gSW1wb3J0IGhlcmUgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jeVxuICAgIGNvbnN0IHsgc2VydmVyRGIgfSA9IGF3YWl0IGltcG9ydCgnQC9saWIvZGF0YWJhc2UnKTtcbiAgICBjb25zdCBib3QgPSBhd2FpdCBzZXJ2ZXJEYi5nZXRCb3QoYm90SWQpO1xuICAgIFxuICAgIGlmICghYm90KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIERpcmVjdCBvd25lcnNoaXAgY2hlY2tcbiAgICBpZiAoYm90Lm93bmVySWQgPT09IHVzZXJJZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIFxuICAgIC8vIFBob25lIG51bWJlciBmYWxsYmFja1xuICAgIGlmICh1c2VyUGhvbmVOdW1iZXIgJiYgYm90Lm93bmVyUGhvbmVOdW1iZXIgPT09IHVzZXJQaG9uZU51bWJlcikge1xuICAgICAgY29uc29sZS5sb2coJ+KchSBCb3Qgb3duZXJzaGlwIHZlcmlmaWVkIHZpYSBwaG9uZSBudW1iZXIgZmFsbGJhY2snKTtcbiAgICAgIC8vIFVwZGF0ZSB0aGUgYm90J3Mgb3duZXJJZCBmb3IgZnV0dXJlIGNvbnNpc3RlbmN5XG4gICAgICBib3Qub3duZXJJZCA9IHVzZXJJZDtcbiAgICAgIGF3YWl0IHNlcnZlckRiLnVwZGF0ZUJvdChib3QpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBmYWxzZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdmVyaWZ5aW5nIGJvdCBvd25lcnNoaXA6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuLy8gTWlkZGxld2FyZSB0byB2ZXJpZnkgYm90IG93bmVyc2hpcCBmb3IgYm90LXNwZWNpZmljIG9wZXJhdGlvbnNcbmV4cG9ydCBjb25zdCB3aXRoQm90T3duZXJzaGlwID0gKFxuICBoYW5kbGVyOiAocmVxOiBBdXRoZW50aWNhdGVkUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IFByb21pc2U8dm9pZD5cbikgPT4ge1xuICByZXR1cm4gd2l0aEF1dGgoYXN5bmMgKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiB7XG4gICAgY29uc3QgeyBib3RJZCB9ID0gcmVxLnF1ZXJ5O1xuICAgIFxuICAgIGlmICghYm90SWQgfHwgdHlwZW9mIGJvdElkICE9PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQm90IElEIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgaXNPd25lciA9IGF3YWl0IHZlcmlmeUJvdE93bmVyc2hpcChib3RJZCwgcmVxLnVzZXIudWlkLCByZXEudXNlci5waG9uZU51bWJlcik7XG4gICAgXG4gICAgaWYgKCFpc093bmVyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdBY2Nlc3MgZGVuaWVkOiBZb3UgZG8gbm90IG93biB0aGlzIGJvdCcsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzKTtcbiAgfSk7XG59OyAiXSwibmFtZXMiOlsiZ2V0QXV0aCIsImluaXRpYWxpemVBcHAiLCJnZXRBcHBzIiwiY2VydCIsImxlbmd0aCIsInByaXZhdGVLZXkiLCJwcm9jZXNzIiwiZW52IiwiRklSRUJBU0VfUFJJVkFURV9LRVkiLCJyZXBsYWNlIiwiRklSRUJBU0VfUFJPSkVDVF9JRCIsIkZJUkVCQVNFX0NMSUVOVF9FTUFJTCIsImNyZWRlbnRpYWwiLCJwcm9qZWN0SWQiLCJjbGllbnRFbWFpbCIsImNvbnNvbGUiLCJsb2ciLCJ3YXJuIiwiZ2V0QXV0aFRva2VuIiwicmVxIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3RhcnRzV2l0aCIsInN1YnN0cmluZyIsInRva2VuRnJvbUNvb2tpZSIsImNvb2tpZXMiLCJ2ZXJpZnlBdXRoVG9rZW4iLCJ0b2tlbiIsImF1dGgiLCJkZWNvZGVkVG9rZW4iLCJ2ZXJpZnlJZFRva2VuIiwidWlkIiwiZW1haWwiLCJwaG9uZU51bWJlciIsInBob25lX251bWJlciIsImVycm9yIiwiRXJyb3IiLCJhdXRoZW50aWNhdGVSZXF1ZXN0IiwicmVzIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidXNlciIsIndpdGhBdXRoIiwiaGFuZGxlciIsInZlcmlmeUJvdE93bmVyc2hpcCIsImJvdElkIiwidXNlcklkIiwidXNlclBob25lTnVtYmVyIiwic2VydmVyRGIiLCJib3QiLCJnZXRCb3QiLCJvd25lcklkIiwib3duZXJQaG9uZU51bWJlciIsInVwZGF0ZUJvdCIsIndpdGhCb3RPd25lcnNoaXAiLCJxdWVyeSIsImlzT3duZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/auth/server.ts\n");

/***/ }),

/***/ "(api)/./lib/database/index.ts":
/*!*******************************!*\
  !*** ./lib/database/index.ts ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   clientDb: () => (/* binding */ clientDb),\n/* harmony export */   serverDb: () => (/* binding */ serverDb)\n/* harmony export */ });\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/firestore */ \"firebase/firestore\");\n/* harmony import */ var _lib_firebase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/firebase */ \"(api)/./lib/firebase.ts\");\n/* harmony import */ var _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/firebase-admin */ \"(api)/./lib/firebase-admin.ts\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_4__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([firebase_firestore__WEBPACK_IMPORTED_MODULE_0__, _lib_firebase__WEBPACK_IMPORTED_MODULE_1__]);\n([firebase_firestore__WEBPACK_IMPORTED_MODULE_0__, _lib_firebase__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n// Client-side database operations (for frontend)\nconst clientDb = {\n    // Get bot data\n    async getBot (botId) {\n        try {\n            const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, \"bots\", botId);\n            const docSnap = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(docRef);\n            if (docSnap.exists()) {\n                return {\n                    id: docSnap.id,\n                    ...docSnap.data()\n                };\n            }\n            return null;\n        } catch (error) {\n            console.error(\"Error fetching bot:\", error);\n            return null;\n        }\n    },\n    // Add chat session\n    async addChatSession (sessionData) {\n        try {\n            const docRef = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.addDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, \"chatSessions\"), sessionData);\n            return docRef.id;\n        } catch (error) {\n            console.error(\"Error adding chat session:\", error);\n            return null;\n        }\n    }\n};\n// File-based persistence for development\nconst DEV_DATA_DIR = path__WEBPACK_IMPORTED_MODULE_4__.join(process.cwd(), \".dev-data\");\nconst BOTS_FILE = path__WEBPACK_IMPORTED_MODULE_4__.join(DEV_DATA_DIR, \"bots.json\");\nconst CHAT_SESSIONS_FILE = path__WEBPACK_IMPORTED_MODULE_4__.join(DEV_DATA_DIR, \"chat-sessions.json\");\nconst UNANSWERED_QUESTIONS_FILE = path__WEBPACK_IMPORTED_MODULE_4__.join(DEV_DATA_DIR, \"unanswered-questions.json\");\n// Ensure dev data directory exists\nconst ensureDevDataDir = ()=>{\n    if (false) {} // Only run on server\n    try {\n        if (!fs__WEBPACK_IMPORTED_MODULE_3__.existsSync(DEV_DATA_DIR)) {\n            fs__WEBPACK_IMPORTED_MODULE_3__.mkdirSync(DEV_DATA_DIR, {\n                recursive: true\n            });\n        }\n    } catch (error) {\n        console.warn(\"Could not create dev data directory:\", error);\n    }\n};\n// Load data from file\nconst loadFromFile = (filePath)=>{\n    if (false) {} // Only run on server\n    try {\n        console.log(`📂 Attempting to load data from: ${filePath}`);\n        if (fs__WEBPACK_IMPORTED_MODULE_3__.existsSync(filePath)) {\n            console.log(`✅ File exists: ${filePath}`);\n            const data = fs__WEBPACK_IMPORTED_MODULE_3__.readFileSync(filePath, \"utf-8\");\n            console.log(`📄 File content length: ${data.length} characters`);\n            const parsed = JSON.parse(data);\n            console.log(`🔍 Parsed object keys: ${Object.keys(parsed)}`);\n            const map = new Map();\n            // Convert dates back to Date objects\n            Object.entries(parsed).forEach(([key, value])=>{\n                console.log(`🔑 Processing key: ${key}`);\n                if (value && typeof value === \"object\") {\n                    // Convert date strings back to Date objects\n                    Object.keys(value).forEach((prop)=>{\n                        if (prop.includes(\"At\") || prop === \"timestamp\") {\n                            if (typeof value[prop] === \"string\" && value[prop].includes(\"T\")) {\n                                const originalValue = value[prop];\n                                value[prop] = new Date(value[prop]);\n                                console.log(`📅 Converted date ${prop}: ${originalValue} -> ${value[prop]}`);\n                            }\n                        }\n                    });\n                }\n                map.set(key, value);\n                console.log(`✅ Added to map: ${key}`);\n            });\n            console.log(`📊 Final map size: ${map.size}`);\n            return map;\n        } else {\n            console.log(`❌ File does not exist: ${filePath}`);\n        }\n    } catch (error) {\n        console.warn(`❌ Could not load data from ${filePath}:`, error);\n    }\n    return new Map();\n};\n// Save data to file\nconst saveToFile = (filePath, data)=>{\n    if (false) {} // Only run on server\n    try {\n        ensureDevDataDir();\n        const obj = Object.fromEntries(data.entries());\n        fs__WEBPACK_IMPORTED_MODULE_3__.writeFileSync(filePath, JSON.stringify(obj, null, 2));\n    } catch (error) {\n        console.warn(`Could not save data to ${filePath}:`, error);\n    }\n};\n// Initialize global mock databases if not exists\nif (typeof global !== \"undefined\") {\n    try {\n        if (!global.__MOCK_BOTS__) {\n            global.__MOCK_BOTS__ = loadFromFile(BOTS_FILE);\n            console.log(`📂 Loaded ${global.__MOCK_BOTS__.size} bots from file`);\n        }\n        if (!global.__MOCK_CHAT_SESSIONS__) {\n            global.__MOCK_CHAT_SESSIONS__ = loadFromFile(CHAT_SESSIONS_FILE);\n            console.log(`📂 Loaded ${global.__MOCK_CHAT_SESSIONS__.size} chat sessions from file`);\n        }\n        if (!global.__MOCK_UNANSWERED_QUESTIONS__) {\n            global.__MOCK_UNANSWERED_QUESTIONS__ = loadFromFile(UNANSWERED_QUESTIONS_FILE);\n            console.log(`📂 Loaded ${global.__MOCK_UNANSWERED_QUESTIONS__.size} unanswered questions from file`);\n        }\n    } catch (error) {\n        console.warn(\"⚠️ Error initializing mock databases:\", error);\n        // Initialize empty maps as fallback\n        if (!global.__MOCK_BOTS__) global.__MOCK_BOTS__ = new Map();\n        if (!global.__MOCK_CHAT_SESSIONS__) global.__MOCK_CHAT_SESSIONS__ = new Map();\n        if (!global.__MOCK_UNANSWERED_QUESTIONS__) global.__MOCK_UNANSWERED_QUESTIONS__ = new Map();\n    }\n}\n// Get the persistent mock database instances\nconst getMockBots = ()=>{\n    if (typeof global !== \"undefined\") {\n        if (!global.__MOCK_BOTS__) {\n            global.__MOCK_BOTS__ = loadFromFile(BOTS_FILE);\n        }\n        return global.__MOCK_BOTS__;\n    }\n    return new Map();\n};\nconst getMockChatSessions = ()=>{\n    if (typeof global !== \"undefined\") {\n        if (!global.__MOCK_CHAT_SESSIONS__) {\n            global.__MOCK_CHAT_SESSIONS__ = loadFromFile(CHAT_SESSIONS_FILE);\n        }\n        return global.__MOCK_CHAT_SESSIONS__;\n    }\n    return new Map();\n};\nconst getMockUnansweredQuestions = ()=>{\n    if (typeof global !== \"undefined\") {\n        if (!global.__MOCK_UNANSWERED_QUESTIONS__) {\n            global.__MOCK_UNANSWERED_QUESTIONS__ = loadFromFile(UNANSWERED_QUESTIONS_FILE);\n        }\n        return global.__MOCK_UNANSWERED_QUESTIONS__;\n    }\n    return new Map();\n};\n// Helper function to check if Firebase is available and working\n// Cache Firebase availability to avoid repeated checks\nlet firebaseAvailableCache = null;\nlet firebaseCheckTime = 0;\nconst FIREBASE_CHECK_CACHE_DURATION = 30000; // 30 seconds\nconst isFirebaseAvailable = async ()=>{\n    if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n        return false;\n    }\n    // Return cached result if recent\n    const now = Date.now();\n    if (firebaseAvailableCache !== null && now - firebaseCheckTime < FIREBASE_CHECK_CACHE_DURATION) {\n        return firebaseAvailableCache;\n    }\n    try {\n        // Quick test to see if Firebase is responsive\n        await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"_test\").limit(1).get();\n        firebaseAvailableCache = true;\n        firebaseCheckTime = now;\n        return true;\n    } catch (error) {\n        console.warn(\"\\uD83D\\uDD25 Firebase connection test failed, using mock database\");\n        firebaseAvailableCache = false;\n        firebaseCheckTime = now;\n        return false;\n    }\n};\n// Helper function to calculate analytics from chat sessions\nconst calculateAnalytics = (sessions)=>{\n    if (sessions.length === 0) {\n        return {\n            totalVisitors: 0,\n            totalChats: 0,\n            totalMessages: 0,\n            averageResponseTime: 0,\n            dailyVisitors: [],\n            weeklyChats: [],\n            topQuestions: [],\n            responseTimeHistory: []\n        };\n    }\n    const totalVisitors = sessions.length;\n    const totalChats = sessions.filter((s)=>s.messageCount > 0).length;\n    const totalMessages = sessions.reduce((sum, s)=>sum + s.messageCount, 0);\n    const averageResponseTime = sessions.reduce((sum, s)=>sum + s.averageResponseTime, 0) / sessions.length;\n    const lastActiveAt = new Date(Math.max(...sessions.map((s)=>new Date(s.lastActivityAt).getTime())));\n    // Calculate daily visitors for the last 7 days\n    const dailyVisitors = [];\n    for(let i = 6; i >= 0; i--){\n        const date = new Date();\n        date.setDate(date.getDate() - i);\n        const dateStr = date.toISOString().split(\"T\")[0];\n        const count = sessions.filter((s)=>{\n            const sessionDate = new Date(s.startedAt).toISOString().split(\"T\")[0];\n            return sessionDate === dateStr;\n        }).length;\n        dailyVisitors.push({\n            date: dateStr,\n            count\n        });\n    }\n    // Calculate weekly chats for the last 4 weeks\n    const weeklyChats = [];\n    for(let i = 3; i >= 0; i--){\n        const startOfWeek = new Date();\n        startOfWeek.setDate(startOfWeek.getDate() - i * 7);\n        startOfWeek.setHours(0, 0, 0, 0);\n        const endOfWeek = new Date(startOfWeek);\n        endOfWeek.setDate(endOfWeek.getDate() + 6);\n        endOfWeek.setHours(23, 59, 59, 999);\n        const weekStr = `${startOfWeek.toLocaleDateString()} - ${endOfWeek.toLocaleDateString()}`;\n        const count = sessions.filter((s)=>{\n            const sessionDate = new Date(s.startedAt);\n            return sessionDate >= startOfWeek && sessionDate <= endOfWeek;\n        }).length;\n        weeklyChats.push({\n            week: weekStr,\n            count\n        });\n    }\n    // Top questions would need to be extracted from chat messages\n    // For now, we'll use a placeholder\n    const topQuestions = [];\n    // Response time history for the last 7 days\n    const responseTimeHistory = [];\n    for(let i = 6; i >= 0; i--){\n        const date = new Date();\n        date.setDate(date.getDate() - i);\n        const dateStr = date.toISOString().split(\"T\")[0];\n        const daySessions = sessions.filter((s)=>{\n            const sessionDate = new Date(s.startedAt).toISOString().split(\"T\")[0];\n            return sessionDate === dateStr;\n        });\n        const avgTime = daySessions.length > 0 ? daySessions.reduce((sum, s)=>sum + s.averageResponseTime, 0) / daySessions.length : 0;\n        responseTimeHistory.push({\n            date: dateStr,\n            avgTime\n        });\n    }\n    return {\n        totalVisitors,\n        totalChats,\n        totalMessages,\n        averageResponseTime,\n        lastActiveAt,\n        dailyVisitors,\n        weeklyChats,\n        topQuestions,\n        responseTimeHistory\n    };\n};\n// Server-side database operations (for API routes)\nconst serverDb = {\n    // Get bot by ID\n    async getBot (botId) {\n        console.log(\"\\uD83D\\uDD0D serverDb.getBot called for:\", botId);\n        // Always check mock database first for development\n        const mockBots = getMockBots();\n        const mockBot = mockBots.get(botId);\n        if (mockBot) {\n            console.log(\"\\uD83D\\uDD0D Mock bot details:\", {\n                id: mockBot.id,\n                name: mockBot.name,\n                ownerId: mockBot.ownerId,\n                ownerPhoneNumber: mockBot.ownerPhoneNumber\n            });\n        }\n        // For development, use mock data only to avoid Firebase delays\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            console.log(\"\\uD83D\\uDCF1 Firebase Admin not available, using mock database only\");\n            if (mockBot) {\n                console.log(\"✅ Returning mock bot data for:\", botId);\n                return mockBot;\n            } else {\n                console.log(\"\\uD83D\\uDEAB Mock bot not found for:\", botId);\n                return null;\n            }\n        }\n        // Skip Firebase for now to improve performance\n        // TODO: Re-enable Firebase when needed for production\n        if (mockBot) {\n            console.log(\"✅ Returning mock bot data for:\", botId);\n            return mockBot;\n        }\n        console.log(\"\\uD83D\\uDEAB Bot not found in Firebase or mock database:\", botId);\n        return null;\n    },\n    // Get bot with analytics\n    async getBotWithAnalytics (botId) {\n        console.log(\"\\uD83D\\uDCCA serverDb.getBotWithAnalytics called for:\", botId);\n        const bot = await this.getBot(botId);\n        if (!bot) {\n            return null;\n        }\n        // Get chat sessions for this bot\n        const sessions = await this.getChatSessionsByBot(botId);\n        // Calculate analytics from sessions\n        const analytics = calculateAnalytics(sessions);\n        return {\n            ...bot,\n            analytics\n        };\n    },\n    // Create new bot\n    async createBot (botData) {\n        console.log(\"\\uD83E\\uDD16 serverDb.createBot called with:\", botData.id);\n        // Always save to mock database for development reliability\n        const mockBots = getMockBots();\n        mockBots.set(botData.id, botData);\n        console.log(\"✅ Bot saved to mock database:\", botData.id);\n        console.log(\"\\uD83D\\uDCCB Total mock bots now:\", mockBots.size);\n        // Save to file for persistence\n        saveToFile(BOTS_FILE, mockBots);\n        console.log(\"\\uD83D\\uDCBE Bot data saved to file\");\n        // Try to save to Firebase if available\n        if (_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            const firebaseAvailable = await isFirebaseAvailable();\n            if (firebaseAvailable) {\n                try {\n                    console.log(\"\\uD83D\\uDD25 Attempting to save bot to Firebase...\");\n                    // Clean the bot data to avoid Firestore undefined value errors\n                    const cleanBotData = {\n                        ...botData,\n                        description: botData.description || \"\",\n                        deployedAt: botData.deployedAt || null,\n                        profilePictureUrl: botData.profilePictureUrl || null,\n                        welcomeMessage: botData.welcomeMessage || null\n                    };\n                    await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").doc(botData.id).set(cleanBotData);\n                    console.log(\"✅ Bot also saved to Firebase successfully\");\n                } catch (error) {\n                    console.error(\"❌ Error saving bot to Firebase (using mock as primary):\", error instanceof Error ? error.message : String(error));\n                }\n            }\n        }\n        return botData;\n    },\n    // Update bot\n    async updateBot (botData) {\n        console.log(\"\\uD83D\\uDD04 serverDb.updateBot called for:\", botData.id);\n        // Always update mock database\n        const mockBots = getMockBots();\n        mockBots.set(botData.id, botData);\n        console.log(\"✅ Bot updated in mock database:\", botData.id);\n        // Save to file for persistence\n        saveToFile(BOTS_FILE, mockBots);\n        console.log(\"\\uD83D\\uDCBE Bot data saved to file\");\n        // Try to update Firebase if available\n        if (_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            const firebaseAvailable = await isFirebaseAvailable();\n            if (firebaseAvailable) {\n                try {\n                    console.log(\"\\uD83D\\uDD25 Attempting to update bot in Firebase...\");\n                    // Clean the bot data to avoid Firestore undefined value errors\n                    const cleanBotData = {\n                        ...botData,\n                        description: botData.description || \"\",\n                        deployedAt: botData.deployedAt || null,\n                        profilePictureUrl: botData.profilePictureUrl || null,\n                        welcomeMessage: botData.welcomeMessage || null\n                    };\n                    await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").doc(botData.id).set(cleanBotData);\n                    console.log(\"✅ Bot also updated in Firebase successfully\");\n                } catch (error) {\n                    console.error(\"❌ Error updating bot in Firebase (using mock as primary):\", error instanceof Error ? error.message : String(error));\n                }\n            }\n        }\n        return botData;\n    },\n    // Get bots by owner ID\n    async getBotsByOwner (ownerId) {\n        console.log(\"\\uD83D\\uDCCB serverDb.getBotsByOwner called for:\", ownerId);\n        // Always check mock database\n        const mockBots = getMockBots();\n        const mockOwnerBots = Array.from(mockBots.values()).filter((bot)=>bot.ownerId === ownerId);\n        console.log(\"\\uD83D\\uDCF1 Found\", mockOwnerBots.length, \"mock bots for owner:\", ownerId);\n        // If no Firebase, return mock only\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            console.log(\"✅ Returning mock bots only (no Firebase)\");\n            return mockOwnerBots;\n        }\n        // Try Firebase if available\n        const firebaseAvailable = await isFirebaseAvailable();\n        if (firebaseAvailable) {\n            try {\n                console.log(\"\\uD83D\\uDD25 Attempting to fetch bots from Firebase...\");\n                const querySnapshot = await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").where(\"ownerId\", \"==\", ownerId).orderBy(\"createdAt\", \"desc\").get();\n                const firebaseBots = [];\n                querySnapshot.forEach((doc)=>{\n                    firebaseBots.push({\n                        id: doc.id,\n                        ...doc.data()\n                    });\n                });\n                console.log(\"✅ Found\", firebaseBots.length, \"Firebase bots for owner:\", ownerId);\n                // If we have Firebase bots, return them (they're the source of truth)\n                if (firebaseBots.length > 0) {\n                    return firebaseBots;\n                }\n            } catch (error) {\n                console.error(\"❌ Firebase query failed for bots by owner:\", error instanceof Error ? error.message : String(error));\n            }\n        }\n        // Fallback to mock database\n        console.log(\"\\uD83D\\uDD04 Using mock database as fallback for getBotsByOwner\");\n        return mockOwnerBots;\n    },\n    // Get bots by phone number (fallback for cross-session identification)\n    async getBotsByPhoneNumber (phoneNumber) {\n        console.log(\"\\uD83D\\uDCF1 serverDb.getBotsByPhoneNumber called for:\", phoneNumber);\n        // Always check mock database\n        const mockBots = getMockBots();\n        const mockPhoneBots = Array.from(mockBots.values()).filter((bot)=>bot.ownerPhoneNumber === phoneNumber);\n        console.log(\"\\uD83D\\uDCF1 Found\", mockPhoneBots.length, \"mock bots for phone:\", phoneNumber);\n        // If no Firebase, return mock only\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            console.log(\"✅ Returning mock bots only (no Firebase)\");\n            return mockPhoneBots;\n        }\n        // Try Firebase if available\n        const firebaseAvailable = await isFirebaseAvailable();\n        if (firebaseAvailable) {\n            try {\n                console.log(\"\\uD83D\\uDD25 Attempting to fetch bots from Firebase by phone...\");\n                const querySnapshot = await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").where(\"ownerPhoneNumber\", \"==\", phoneNumber).orderBy(\"createdAt\", \"desc\").get();\n                const firebaseBots = [];\n                querySnapshot.forEach((doc)=>{\n                    firebaseBots.push({\n                        id: doc.id,\n                        ...doc.data()\n                    });\n                });\n                console.log(\"✅ Found\", firebaseBots.length, \"Firebase bots for phone:\", phoneNumber);\n                // If we have Firebase bots, return them (they're the source of truth)\n                if (firebaseBots.length > 0) {\n                    return firebaseBots;\n                }\n            } catch (error) {\n                console.error(\"❌ Firebase query failed for bots by phone:\", error instanceof Error ? error.message : String(error));\n            }\n        }\n        // Fallback to mock database\n        console.log(\"\\uD83D\\uDD04 Using mock database as fallback for getBotsByPhoneNumber\");\n        return mockPhoneBots;\n    },\n    // Enhanced getBotsByOwner that also checks phone number as fallback\n    async getBotsByOwnerWithFallback (ownerId, phoneNumber) {\n        console.log(\"\\uD83D\\uDD0D serverDb.getBotsByOwnerWithFallback called for:\", ownerId, \"phone:\", phoneNumber);\n        // First try to get bots by owner ID\n        let bots = await this.getBotsByOwner(ownerId);\n        // If no bots found and we have a phone number, try phone number fallback\n        if (bots.length === 0 && phoneNumber) {\n            console.log(\"\\uD83D\\uDD04 No bots found by owner ID, trying phone number fallback...\");\n            const phoneBots = await this.getBotsByPhoneNumber(phoneNumber);\n            if (phoneBots.length > 0) {\n                console.log(\"✅ Found bots by phone number, updating owner IDs...\");\n                // Update the owner IDs to the current user ID for future consistency\n                for (const bot of phoneBots){\n                    bot.ownerId = ownerId;\n                    await this.updateBot(bot);\n                }\n                bots = phoneBots;\n            }\n        }\n        console.log(\"\\uD83D\\uDCCA Total bots found:\", bots.length);\n        return bots;\n    },\n    // Delete bot\n    async deleteBot (botId) {\n        console.log(\"\\uD83D\\uDDD1️ serverDb.deleteBot called for:\", botId);\n        // Always delete from mock database\n        const mockBots = getMockBots();\n        const deleted = mockBots.delete(botId);\n        console.log(\"✅ Bot deleted from mock database:\", deleted);\n        // Save to file for persistence\n        saveToFile(BOTS_FILE, mockBots);\n        console.log(\"\\uD83D\\uDCBE Bot data saved to file\");\n        // Try to delete from Firebase if available\n        if (_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            const firebaseAvailable = await isFirebaseAvailable();\n            if (firebaseAvailable) {\n                try {\n                    console.log(\"\\uD83D\\uDD25 Attempting to delete bot from Firebase...\");\n                    await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").doc(botId).delete();\n                    console.log(\"✅ Bot also deleted from Firebase successfully\");\n                } catch (error) {\n                    console.error(\"❌ Error deleting bot from Firebase (mock deletion successful):\", error instanceof Error ? error.message : String(error));\n                }\n            }\n        }\n        return deleted;\n    },\n    // Chat Sessions Management\n    async createChatSession (sessionData) {\n        console.log(\"\\uD83D\\uDCAC serverDb.createChatSession called for bot:\", sessionData.botId);\n        const mockSessions = getMockChatSessions();\n        mockSessions.set(sessionData.id, sessionData);\n        console.log(\"✅ Chat session saved to mock database:\", sessionData.id);\n        // Save to file for persistence\n        saveToFile(CHAT_SESSIONS_FILE, mockSessions);\n        // Try to save to Firebase if available\n        if (_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            const firebaseAvailable = await isFirebaseAvailable();\n            if (firebaseAvailable) {\n                try {\n                    await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"chatSessions\").doc(sessionData.id).set(sessionData);\n                    console.log(\"✅ Chat session also saved to Firebase successfully\");\n                } catch (error) {\n                    console.error(\"❌ Error saving chat session to Firebase:\", error instanceof Error ? error.message : String(error));\n                }\n            }\n        }\n        return sessionData;\n    },\n    async updateChatSession (sessionData) {\n        console.log(\"\\uD83D\\uDD04 serverDb.updateChatSession called for:\", sessionData.id);\n        const mockSessions = getMockChatSessions();\n        mockSessions.set(sessionData.id, sessionData);\n        console.log(\"✅ Chat session updated in mock database:\", sessionData.id);\n        // Save to file for persistence\n        saveToFile(CHAT_SESSIONS_FILE, mockSessions);\n        // Try to update Firebase if available\n        if (_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            const firebaseAvailable = await isFirebaseAvailable();\n            if (firebaseAvailable) {\n                try {\n                    await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"chatSessions\").doc(sessionData.id).set(sessionData);\n                    console.log(\"✅ Chat session also updated in Firebase successfully\");\n                } catch (error) {\n                    console.error(\"❌ Error updating chat session in Firebase:\", error instanceof Error ? error.message : String(error));\n                }\n            }\n        }\n        return sessionData;\n    },\n    async getChatSessionsByBot (botId) {\n        console.log(\"\\uD83D\\uDCCA serverDb.getChatSessionsByBot called for:\", botId);\n        const mockSessions = getMockChatSessions();\n        const mockBotSessions = Array.from(mockSessions.values()).filter((session)=>session.botId === botId);\n        console.log(\"\\uD83D\\uDCF1 Found\", mockBotSessions.length, \"mock sessions for bot:\", botId);\n        // For development, use mock data only to avoid Firebase delays\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            return mockBotSessions;\n        }\n        // Skip Firebase for now to improve performance\n        // TODO: Re-enable Firebase when needed for production\n        return mockBotSessions;\n    },\n    // Unanswered Questions Management\n    async createUnansweredQuestion (questionData) {\n        console.log(\"❓ serverDb.createUnansweredQuestion called for bot:\", questionData.botId);\n        const mockQuestions = getMockUnansweredQuestions();\n        mockQuestions.set(questionData.id, questionData);\n        console.log(\"✅ Unanswered question saved to mock database:\", questionData.id);\n        // Save to file for persistence\n        saveToFile(UNANSWERED_QUESTIONS_FILE, mockQuestions);\n        // Try to save to Firebase if available\n        if (_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            const firebaseAvailable = await isFirebaseAvailable();\n            if (firebaseAvailable) {\n                try {\n                    await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"unansweredQuestions\").doc(questionData.id).set(questionData);\n                    console.log(\"✅ Unanswered question also saved to Firebase successfully\");\n                } catch (error) {\n                    console.error(\"❌ Error saving unanswered question to Firebase:\", error instanceof Error ? error.message : String(error));\n                }\n            }\n        }\n        return questionData;\n    },\n    async updateUnansweredQuestion (questionData) {\n        console.log(\"\\uD83D\\uDD04 serverDb.updateUnansweredQuestion called for:\", questionData.id);\n        const mockQuestions = getMockUnansweredQuestions();\n        mockQuestions.set(questionData.id, questionData);\n        console.log(\"✅ Unanswered question updated in mock database:\", questionData.id);\n        // Save to file for persistence\n        saveToFile(UNANSWERED_QUESTIONS_FILE, mockQuestions);\n        // Try to update Firebase if available\n        if (_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            const firebaseAvailable = await isFirebaseAvailable();\n            if (firebaseAvailable) {\n                try {\n                    await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"unansweredQuestions\").doc(questionData.id).set(questionData);\n                    console.log(\"✅ Unanswered question also updated in Firebase successfully\");\n                } catch (error) {\n                    console.error(\"❌ Error updating unanswered question in Firebase:\", error instanceof Error ? error.message : String(error));\n                }\n            }\n        }\n        return questionData;\n    },\n    async getUnansweredQuestionsByBot (botId) {\n        console.log(\"❓ serverDb.getUnansweredQuestionsByBot called for:\", botId);\n        const mockQuestions = getMockUnansweredQuestions();\n        const mockBotQuestions = Array.from(mockQuestions.values()).filter((question)=>question.botId === botId);\n        console.log(\"\\uD83D\\uDCF1 Found\", mockBotQuestions.length, \"mock unanswered questions for bot:\", botId);\n        // For development, use mock data only to avoid Firebase delays\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            return mockBotQuestions;\n        }\n        // Skip Firebase for now to improve performance\n        // TODO: Re-enable Firebase when needed for production\n        return mockBotQuestions;\n    },\n    async getUnansweredQuestion (questionId) {\n        console.log(\"❓ serverDb.getUnansweredQuestion called for:\", questionId);\n        const mockQuestions = getMockUnansweredQuestions();\n        const mockQuestion = mockQuestions.get(questionId);\n        // If no Firebase, return mock only\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            return mockQuestion || null;\n        }\n        // Try Firebase if available\n        const firebaseAvailable = await isFirebaseAvailable();\n        if (firebaseAvailable) {\n            try {\n                const docRef = _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"unansweredQuestions\").doc(questionId);\n                const docSnap = await docRef.get();\n                if (docSnap.exists) {\n                    console.log(\"✅ Unanswered question found in Firebase:\", questionId);\n                    return {\n                        id: docSnap.id,\n                        ...docSnap.data()\n                    };\n                }\n            } catch (error) {\n                console.error(\"❌ Firebase query failed for unanswered question:\", error instanceof Error ? error.message : String(error));\n            }\n        }\n        return mockQuestion || null;\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxzQkFBWStILGlCQUFpQjdILE1BQU0sRUFBRSxzQ0FBc0MzQjtRQUV2RiwrREFBK0Q7UUFDL0QsSUFBSSxDQUFDTCx3REFBT0EsRUFBRTtZQUNaLE9BQU82SjtRQUNUO1FBRUEsK0NBQStDO1FBQy9DLHNEQUFzRDtRQUN0RCxPQUFPQTtJQUNUO0lBRUEsTUFBTUUsdUJBQXNCQyxVQUFrQjtRQUM1Q3BKLFFBQVFrQixHQUFHLENBQUMsZ0RBQWdEa0k7UUFFNUQsTUFBTU4sZ0JBQWdCOUY7UUFDdEIsTUFBTXFHLGVBQWVQLGNBQWN2RixHQUFHLENBQUM2RjtRQUV2QyxtQ0FBbUM7UUFDbkMsSUFBSSxDQUFDaEssd0RBQU9BLEVBQUU7WUFDWixPQUFPaUssZ0JBQWdCO1FBQ3pCO1FBRUEsNEJBQTRCO1FBQzVCLE1BQU0xQyxvQkFBb0IsTUFBTXZEO1FBQ2hDLElBQUl1RCxtQkFBbUI7WUFDckIsSUFBSTtnQkFDRixNQUFNakgsU0FBU04sd0RBQU9BLENBQUNMLFVBQVUsQ0FBQyx1QkFBdUJDLEdBQUcsQ0FBQ29LO2dCQUM3RCxNQUFNekosVUFBVSxNQUFNRCxPQUFPNkQsR0FBRztnQkFFaEMsSUFBSTVELFFBQVFDLE1BQU0sRUFBRTtvQkFDbEJJLFFBQVFrQixHQUFHLENBQUMsNENBQTRDa0k7b0JBQ3hELE9BQU87d0JBQUV2SixJQUFJRixRQUFRRSxFQUFFO3dCQUFFLEdBQUdGLFFBQVFHLElBQUksRUFBRTtvQkFBQztnQkFDN0M7WUFDRixFQUFFLE9BQU9DLE9BQU87Z0JBQ2RDLFFBQVFELEtBQUssQ0FBQyxvREFBb0RBLGlCQUFpQmtILFFBQVFsSCxNQUFNbUgsT0FBTyxHQUFHQyxPQUFPcEg7WUFDcEg7UUFDRjtRQUVBLE9BQU9zSixnQkFBZ0I7SUFDekI7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXNxdWUtYm90LXBsYXRmb3JtLy4vbGliL2RhdGFiYXNlL2luZGV4LnRzP2FjNzYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgXG4gIGNvbGxlY3Rpb24sIFxuICBkb2MsIFxuICBnZXREb2MsIFxuICBhZGREb2Ncbn0gZnJvbSAnZmlyZWJhc2UvZmlyZXN0b3JlJztcbmltcG9ydCB7IGRiIH0gZnJvbSAnQC9saWIvZmlyZWJhc2UnO1xuaW1wb3J0IHsgYWRtaW5EYiB9IGZyb20gJ0AvbGliL2ZpcmViYXNlLWFkbWluJztcbmltcG9ydCB7IEJvdCwgQ2hhdFNlc3Npb24sIFVuYW5zd2VyZWRRdWVzdGlvbiwgQ2hhdEFuYWx5dGljcywgQm90QW5hbHl0aWNzIH0gZnJvbSAnQC90eXBlcyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG4vLyBDbGllbnQtc2lkZSBkYXRhYmFzZSBvcGVyYXRpb25zIChmb3IgZnJvbnRlbmQpXG5leHBvcnQgY29uc3QgY2xpZW50RGIgPSB7XG4gIC8vIEdldCBib3QgZGF0YVxuICBhc3luYyBnZXRCb3QoYm90SWQ6IHN0cmluZyk6IFByb21pc2U8Qm90IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkb2NSZWYgPSBkb2MoZGIsICdib3RzJywgYm90SWQpO1xuICAgICAgY29uc3QgZG9jU25hcCA9IGF3YWl0IGdldERvYyhkb2NSZWYpO1xuICAgICAgXG4gICAgICBpZiAoZG9jU25hcC5leGlzdHMoKSkge1xuICAgICAgICByZXR1cm4geyBpZDogZG9jU25hcC5pZCwgLi4uZG9jU25hcC5kYXRhKCkgfSBhcyBCb3Q7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgYm90OicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfSxcblxuICAvLyBBZGQgY2hhdCBzZXNzaW9uXG4gIGFzeW5jIGFkZENoYXRTZXNzaW9uKHNlc3Npb25EYXRhOiBPbWl0PENoYXRTZXNzaW9uLCAnaWQnPik6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkb2NSZWYgPSBhd2FpdCBhZGREb2MoY29sbGVjdGlvbihkYiwgJ2NoYXRTZXNzaW9ucycpLCBzZXNzaW9uRGF0YSk7XG4gICAgICByZXR1cm4gZG9jUmVmLmlkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhZGRpbmcgY2hhdCBzZXNzaW9uOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxufTtcblxuLy8gRmlsZS1iYXNlZCBwZXJzaXN0ZW5jZSBmb3IgZGV2ZWxvcG1lbnRcbmNvbnN0IERFVl9EQVRBX0RJUiA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnLmRldi1kYXRhJyk7XG5jb25zdCBCT1RTX0ZJTEUgPSBwYXRoLmpvaW4oREVWX0RBVEFfRElSLCAnYm90cy5qc29uJyk7XG5jb25zdCBDSEFUX1NFU1NJT05TX0ZJTEUgPSBwYXRoLmpvaW4oREVWX0RBVEFfRElSLCAnY2hhdC1zZXNzaW9ucy5qc29uJyk7XG5jb25zdCBVTkFOU1dFUkVEX1FVRVNUSU9OU19GSUxFID0gcGF0aC5qb2luKERFVl9EQVRBX0RJUiwgJ3VuYW5zd2VyZWQtcXVlc3Rpb25zLmpzb24nKTtcblxuLy8gRW5zdXJlIGRldiBkYXRhIGRpcmVjdG9yeSBleGlzdHNcbmNvbnN0IGVuc3VyZURldkRhdGFEaXIgPSAoKSA9PiB7XG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgcmV0dXJuOyAvLyBPbmx5IHJ1biBvbiBzZXJ2ZXJcbiAgXG4gIHRyeSB7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKERFVl9EQVRBX0RJUikpIHtcbiAgICAgIGZzLm1rZGlyU3luYyhERVZfREFUQV9ESVIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBjcmVhdGUgZGV2IGRhdGEgZGlyZWN0b3J5OicsIGVycm9yKTtcbiAgfVxufTtcblxuLy8gTG9hZCBkYXRhIGZyb20gZmlsZVxuY29uc3QgbG9hZEZyb21GaWxlID0gPFQ+KGZpbGVQYXRoOiBzdHJpbmcpOiBNYXA8c3RyaW5nLCBUPiA9PiB7XG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgcmV0dXJuIG5ldyBNYXAoKTsgLy8gT25seSBydW4gb24gc2VydmVyXG4gIFxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGDwn5OCIEF0dGVtcHRpbmcgdG8gbG9hZCBkYXRhIGZyb206ICR7ZmlsZVBhdGh9YCk7XG4gICAgaWYgKGZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSB7XG4gICAgICBjb25zb2xlLmxvZyhg4pyFIEZpbGUgZXhpc3RzOiAke2ZpbGVQYXRofWApO1xuICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0Zi04Jyk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+ThCBGaWxlIGNvbnRlbnQgbGVuZ3RoOiAke2RhdGEubGVuZ3RofSBjaGFyYWN0ZXJzYCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+UjSBQYXJzZWQgb2JqZWN0IGtleXM6ICR7T2JqZWN0LmtleXMocGFyc2VkKX1gKTtcbiAgICAgIFxuICAgICAgY29uc3QgbWFwID0gbmV3IE1hcDxzdHJpbmcsIFQ+KCk7XG4gICAgICBcbiAgICAgIC8vIENvbnZlcnQgZGF0ZXMgYmFjayB0byBEYXRlIG9iamVjdHNcbiAgICAgIE9iamVjdC5lbnRyaWVzKHBhcnNlZCkuZm9yRWFjaCgoW2tleSwgdmFsdWVdOiBbc3RyaW5nLCBhbnldKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5SRIFByb2Nlc3Npbmcga2V5OiAke2tleX1gKTtcbiAgICAgICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAvLyBDb252ZXJ0IGRhdGUgc3RyaW5ncyBiYWNrIHRvIERhdGUgb2JqZWN0c1xuICAgICAgICAgIE9iamVjdC5rZXlzKHZhbHVlKS5mb3JFYWNoKHByb3AgPT4ge1xuICAgICAgICAgICAgaWYgKHByb3AuaW5jbHVkZXMoJ0F0JykgfHwgcHJvcCA9PT0gJ3RpbWVzdGFtcCcpIHtcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZVtwcm9wXSA9PT0gJ3N0cmluZycgJiYgdmFsdWVbcHJvcF0uaW5jbHVkZXMoJ1QnKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsVmFsdWUgPSB2YWx1ZVtwcm9wXTtcbiAgICAgICAgICAgICAgICB2YWx1ZVtwcm9wXSA9IG5ldyBEYXRlKHZhbHVlW3Byb3BdKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+ThSBDb252ZXJ0ZWQgZGF0ZSAke3Byb3B9OiAke29yaWdpbmFsVmFsdWV9IC0+ICR7dmFsdWVbcHJvcF19YCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBtYXAuc2V0KGtleSwgdmFsdWUgYXMgVCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgQWRkZWQgdG8gbWFwOiAke2tleX1gKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhg8J+TiiBGaW5hbCBtYXAgc2l6ZTogJHttYXAuc2l6ZX1gKTtcbiAgICAgIHJldHVybiBtYXA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKGDinYwgRmlsZSBkb2VzIG5vdCBleGlzdDogJHtmaWxlUGF0aH1gKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKGDinYwgQ291bGQgbm90IGxvYWQgZGF0YSBmcm9tICR7ZmlsZVBhdGh9OmAsIGVycm9yKTtcbiAgfVxuICBcbiAgcmV0dXJuIG5ldyBNYXA8c3RyaW5nLCBUPigpO1xufTtcblxuLy8gU2F2ZSBkYXRhIHRvIGZpbGVcbmNvbnN0IHNhdmVUb0ZpbGUgPSA8VD4oZmlsZVBhdGg6IHN0cmluZywgZGF0YTogTWFwPHN0cmluZywgVD4pID0+IHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSByZXR1cm47IC8vIE9ubHkgcnVuIG9uIHNlcnZlclxuICBcbiAgdHJ5IHtcbiAgICBlbnN1cmVEZXZEYXRhRGlyKCk7XG4gICAgY29uc3Qgb2JqID0gT2JqZWN0LmZyb21FbnRyaWVzKGRhdGEuZW50cmllcygpKTtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDIpKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLndhcm4oYENvdWxkIG5vdCBzYXZlIGRhdGEgdG8gJHtmaWxlUGF0aH06YCwgZXJyb3IpO1xuICB9XG59O1xuXG4vLyBHbG9iYWwgbW9jayBkYXRhYmFzZSBzdG9yYWdlIGZvciBkZXZlbG9wbWVudFxuLy8gVXNlIGdsb2JhbCB0byBwZXJzaXN0IGFjcm9zcyBob3QgcmVsb2FkcyBhbmQgZGlmZmVyZW50IEFQSSByb3V0ZXNcbmRlY2xhcmUgZ2xvYmFsIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXZhclxuICB2YXIgX19NT0NLX0JPVFNfXzogTWFwPHN0cmluZywgQm90PiB8IHVuZGVmaW5lZDtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXZhclxuICB2YXIgX19NT0NLX0NIQVRfU0VTU0lPTlNfXzogTWFwPHN0cmluZywgQ2hhdFNlc3Npb24+IHwgdW5kZWZpbmVkO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXG4gIHZhciBfX01PQ0tfVU5BTlNXRVJFRF9RVUVTVElPTlNfXzogTWFwPHN0cmluZywgVW5hbnN3ZXJlZFF1ZXN0aW9uPiB8IHVuZGVmaW5lZDtcbn1cblxuLy8gSW5pdGlhbGl6ZSBnbG9iYWwgbW9jayBkYXRhYmFzZXMgaWYgbm90IGV4aXN0c1xuaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnKSB7XG4gIHRyeSB7XG4gICAgaWYgKCFnbG9iYWwuX19NT0NLX0JPVFNfXykge1xuICAgICAgZ2xvYmFsLl9fTU9DS19CT1RTX18gPSBsb2FkRnJvbUZpbGU8Qm90PihCT1RTX0ZJTEUpO1xuICAgICAgY29uc29sZS5sb2coYPCfk4IgTG9hZGVkICR7Z2xvYmFsLl9fTU9DS19CT1RTX18uc2l6ZX0gYm90cyBmcm9tIGZpbGVgKTtcbiAgICB9XG4gICAgaWYgKCFnbG9iYWwuX19NT0NLX0NIQVRfU0VTU0lPTlNfXykge1xuICAgICAgZ2xvYmFsLl9fTU9DS19DSEFUX1NFU1NJT05TX18gPSBsb2FkRnJvbUZpbGU8Q2hhdFNlc3Npb24+KENIQVRfU0VTU0lPTlNfRklMRSk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+TgiBMb2FkZWQgJHtnbG9iYWwuX19NT0NLX0NIQVRfU0VTU0lPTlNfXy5zaXplfSBjaGF0IHNlc3Npb25zIGZyb20gZmlsZWApO1xuICAgIH1cbiAgICBpZiAoIWdsb2JhbC5fX01PQ0tfVU5BTlNXRVJFRF9RVUVTVElPTlNfXykge1xuICAgICAgZ2xvYmFsLl9fTU9DS19VTkFOU1dFUkVEX1FVRVNUSU9OU19fID0gbG9hZEZyb21GaWxlPFVuYW5zd2VyZWRRdWVzdGlvbj4oVU5BTlNXRVJFRF9RVUVTVElPTlNfRklMRSk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+TgiBMb2FkZWQgJHtnbG9iYWwuX19NT0NLX1VOQU5TV0VSRURfUVVFU1RJT05TX18uc2l6ZX0gdW5hbnN3ZXJlZCBxdWVzdGlvbnMgZnJvbSBmaWxlYCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIEVycm9yIGluaXRpYWxpemluZyBtb2NrIGRhdGFiYXNlczonLCBlcnJvcik7XG4gICAgLy8gSW5pdGlhbGl6ZSBlbXB0eSBtYXBzIGFzIGZhbGxiYWNrXG4gICAgaWYgKCFnbG9iYWwuX19NT0NLX0JPVFNfXykgZ2xvYmFsLl9fTU9DS19CT1RTX18gPSBuZXcgTWFwPHN0cmluZywgQm90PigpO1xuICAgIGlmICghZ2xvYmFsLl9fTU9DS19DSEFUX1NFU1NJT05TX18pIGdsb2JhbC5fX01PQ0tfQ0hBVF9TRVNTSU9OU19fID0gbmV3IE1hcDxzdHJpbmcsIENoYXRTZXNzaW9uPigpO1xuICAgIGlmICghZ2xvYmFsLl9fTU9DS19VTkFOU1dFUkVEX1FVRVNUSU9OU19fKSBnbG9iYWwuX19NT0NLX1VOQU5TV0VSRURfUVVFU1RJT05TX18gPSBuZXcgTWFwPHN0cmluZywgVW5hbnN3ZXJlZFF1ZXN0aW9uPigpO1xuICB9XG59XG5cbi8vIEdldCB0aGUgcGVyc2lzdGVudCBtb2NrIGRhdGFiYXNlIGluc3RhbmNlc1xuY29uc3QgZ2V0TW9ja0JvdHMgPSAoKTogTWFwPHN0cmluZywgQm90PiA9PiB7XG4gIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykge1xuICAgIGlmICghZ2xvYmFsLl9fTU9DS19CT1RTX18pIHtcbiAgICAgIGdsb2JhbC5fX01PQ0tfQk9UU19fID0gbG9hZEZyb21GaWxlPEJvdD4oQk9UU19GSUxFKTtcbiAgICB9XG4gICAgcmV0dXJuIGdsb2JhbC5fX01PQ0tfQk9UU19fO1xuICB9XG4gIHJldHVybiBuZXcgTWFwPHN0cmluZywgQm90PigpO1xufTtcblxuY29uc3QgZ2V0TW9ja0NoYXRTZXNzaW9ucyA9ICgpOiBNYXA8c3RyaW5nLCBDaGF0U2Vzc2lvbj4gPT4ge1xuICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBpZiAoIWdsb2JhbC5fX01PQ0tfQ0hBVF9TRVNTSU9OU19fKSB7XG4gICAgICBnbG9iYWwuX19NT0NLX0NIQVRfU0VTU0lPTlNfXyA9IGxvYWRGcm9tRmlsZTxDaGF0U2Vzc2lvbj4oQ0hBVF9TRVNTSU9OU19GSUxFKTtcbiAgICB9XG4gICAgcmV0dXJuIGdsb2JhbC5fX01PQ0tfQ0hBVF9TRVNTSU9OU19fO1xuICB9XG4gIHJldHVybiBuZXcgTWFwPHN0cmluZywgQ2hhdFNlc3Npb24+KCk7XG59O1xuXG5jb25zdCBnZXRNb2NrVW5hbnN3ZXJlZFF1ZXN0aW9ucyA9ICgpOiBNYXA8c3RyaW5nLCBVbmFuc3dlcmVkUXVlc3Rpb24+ID0+IHtcbiAgaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgaWYgKCFnbG9iYWwuX19NT0NLX1VOQU5TV0VSRURfUVVFU1RJT05TX18pIHtcbiAgICAgIGdsb2JhbC5fX01PQ0tfVU5BTlNXRVJFRF9RVUVTVElPTlNfXyA9IGxvYWRGcm9tRmlsZTxVbmFuc3dlcmVkUXVlc3Rpb24+KFVOQU5TV0VSRURfUVVFU1RJT05TX0ZJTEUpO1xuICAgIH1cbiAgICByZXR1cm4gZ2xvYmFsLl9fTU9DS19VTkFOU1dFUkVEX1FVRVNUSU9OU19fO1xuICB9XG4gIHJldHVybiBuZXcgTWFwPHN0cmluZywgVW5hbnN3ZXJlZFF1ZXN0aW9uPigpO1xufTtcblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIEZpcmViYXNlIGlzIGF2YWlsYWJsZSBhbmQgd29ya2luZ1xuLy8gQ2FjaGUgRmlyZWJhc2UgYXZhaWxhYmlsaXR5IHRvIGF2b2lkIHJlcGVhdGVkIGNoZWNrc1xubGV0IGZpcmViYXNlQXZhaWxhYmxlQ2FjaGU6IGJvb2xlYW4gfCBudWxsID0gbnVsbDtcbmxldCBmaXJlYmFzZUNoZWNrVGltZSA9IDA7XG5jb25zdCBGSVJFQkFTRV9DSEVDS19DQUNIRV9EVVJBVElPTiA9IDMwMDAwOyAvLyAzMCBzZWNvbmRzXG5cbmNvbnN0IGlzRmlyZWJhc2VBdmFpbGFibGUgPSBhc3luYyAoKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gIGlmICghYWRtaW5EYikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgLy8gUmV0dXJuIGNhY2hlZCByZXN1bHQgaWYgcmVjZW50XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGlmIChmaXJlYmFzZUF2YWlsYWJsZUNhY2hlICE9PSBudWxsICYmIChub3cgLSBmaXJlYmFzZUNoZWNrVGltZSkgPCBGSVJFQkFTRV9DSEVDS19DQUNIRV9EVVJBVElPTikge1xuICAgIHJldHVybiBmaXJlYmFzZUF2YWlsYWJsZUNhY2hlO1xuICB9XG4gIFxuICB0cnkge1xuICAgIC8vIFF1aWNrIHRlc3QgdG8gc2VlIGlmIEZpcmViYXNlIGlzIHJlc3BvbnNpdmVcbiAgICBhd2FpdCBhZG1pbkRiLmNvbGxlY3Rpb24oJ190ZXN0JykubGltaXQoMSkuZ2V0KCk7XG4gICAgZmlyZWJhc2VBdmFpbGFibGVDYWNoZSA9IHRydWU7XG4gICAgZmlyZWJhc2VDaGVja1RpbWUgPSBub3c7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKCfwn5SlIEZpcmViYXNlIGNvbm5lY3Rpb24gdGVzdCBmYWlsZWQsIHVzaW5nIG1vY2sgZGF0YWJhc2UnKTtcbiAgICBmaXJlYmFzZUF2YWlsYWJsZUNhY2hlID0gZmFsc2U7XG4gICAgZmlyZWJhc2VDaGVja1RpbWUgPSBub3c7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIGFuYWx5dGljcyBmcm9tIGNoYXQgc2Vzc2lvbnNcbmNvbnN0IGNhbGN1bGF0ZUFuYWx5dGljcyA9IChzZXNzaW9uczogQ2hhdFNlc3Npb25bXSk6IEJvdEFuYWx5dGljcyA9PiB7XG4gIGlmIChzZXNzaW9ucy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxWaXNpdG9yczogMCxcbiAgICAgIHRvdGFsQ2hhdHM6IDAsXG4gICAgICB0b3RhbE1lc3NhZ2VzOiAwLFxuICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogMCxcbiAgICAgIGRhaWx5VmlzaXRvcnM6IFtdLFxuICAgICAgd2Vla2x5Q2hhdHM6IFtdLFxuICAgICAgdG9wUXVlc3Rpb25zOiBbXSxcbiAgICAgIHJlc3BvbnNlVGltZUhpc3Rvcnk6IFtdXG4gICAgfTtcbiAgfVxuXG4gIGNvbnN0IHRvdGFsVmlzaXRvcnMgPSBzZXNzaW9ucy5sZW5ndGg7XG4gIGNvbnN0IHRvdGFsQ2hhdHMgPSBzZXNzaW9ucy5maWx0ZXIocyA9PiBzLm1lc3NhZ2VDb3VudCA+IDApLmxlbmd0aDtcbiAgY29uc3QgdG90YWxNZXNzYWdlcyA9IHNlc3Npb25zLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBzLm1lc3NhZ2VDb3VudCwgMCk7XG4gIGNvbnN0IGF2ZXJhZ2VSZXNwb25zZVRpbWUgPSBzZXNzaW9ucy5yZWR1Y2UoKHN1bSwgcykgPT4gc3VtICsgcy5hdmVyYWdlUmVzcG9uc2VUaW1lLCAwKSAvIHNlc3Npb25zLmxlbmd0aDtcbiAgY29uc3QgbGFzdEFjdGl2ZUF0ID0gbmV3IERhdGUoTWF0aC5tYXgoLi4uc2Vzc2lvbnMubWFwKHMgPT4gbmV3IERhdGUocy5sYXN0QWN0aXZpdHlBdCkuZ2V0VGltZSgpKSkpO1xuXG4gIC8vIENhbGN1bGF0ZSBkYWlseSB2aXNpdG9ycyBmb3IgdGhlIGxhc3QgNyBkYXlzXG4gIGNvbnN0IGRhaWx5VmlzaXRvcnM6IHsgZGF0ZTogc3RyaW5nOyBjb3VudDogbnVtYmVyIH1bXSA9IFtdO1xuICBmb3IgKGxldCBpID0gNjsgaSA+PSAwOyBpLS0pIHtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcbiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgLSBpKTtcbiAgICBjb25zdCBkYXRlU3RyID0gZGF0ZS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XG4gICAgY29uc3QgY291bnQgPSBzZXNzaW9ucy5maWx0ZXIocyA9PiB7XG4gICAgICBjb25zdCBzZXNzaW9uRGF0ZSA9IG5ldyBEYXRlKHMuc3RhcnRlZEF0KS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XG4gICAgICByZXR1cm4gc2Vzc2lvbkRhdGUgPT09IGRhdGVTdHI7XG4gICAgfSkubGVuZ3RoO1xuICAgIGRhaWx5VmlzaXRvcnMucHVzaCh7IGRhdGU6IGRhdGVTdHIsIGNvdW50IH0pO1xuICB9XG5cbiAgLy8gQ2FsY3VsYXRlIHdlZWtseSBjaGF0cyBmb3IgdGhlIGxhc3QgNCB3ZWVrc1xuICBjb25zdCB3ZWVrbHlDaGF0czogeyB3ZWVrOiBzdHJpbmc7IGNvdW50OiBudW1iZXIgfVtdID0gW107XG4gIGZvciAobGV0IGkgPSAzOyBpID49IDA7IGktLSkge1xuICAgIGNvbnN0IHN0YXJ0T2ZXZWVrID0gbmV3IERhdGUoKTtcbiAgICBzdGFydE9mV2Vlay5zZXREYXRlKHN0YXJ0T2ZXZWVrLmdldERhdGUoKSAtIChpICogNykpO1xuICAgIHN0YXJ0T2ZXZWVrLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICAgIGNvbnN0IGVuZE9mV2VlayA9IG5ldyBEYXRlKHN0YXJ0T2ZXZWVrKTtcbiAgICBlbmRPZldlZWsuc2V0RGF0ZShlbmRPZldlZWsuZ2V0RGF0ZSgpICsgNik7XG4gICAgZW5kT2ZXZWVrLnNldEhvdXJzKDIzLCA1OSwgNTksIDk5OSk7XG4gICAgXG4gICAgY29uc3Qgd2Vla1N0ciA9IGAke3N0YXJ0T2ZXZWVrLnRvTG9jYWxlRGF0ZVN0cmluZygpfSAtICR7ZW5kT2ZXZWVrLnRvTG9jYWxlRGF0ZVN0cmluZygpfWA7XG4gICAgY29uc3QgY291bnQgPSBzZXNzaW9ucy5maWx0ZXIocyA9PiB7XG4gICAgICBjb25zdCBzZXNzaW9uRGF0ZSA9IG5ldyBEYXRlKHMuc3RhcnRlZEF0KTtcbiAgICAgIHJldHVybiBzZXNzaW9uRGF0ZSA+PSBzdGFydE9mV2VlayAmJiBzZXNzaW9uRGF0ZSA8PSBlbmRPZldlZWs7XG4gICAgfSkubGVuZ3RoO1xuICAgIHdlZWtseUNoYXRzLnB1c2goeyB3ZWVrOiB3ZWVrU3RyLCBjb3VudCB9KTtcbiAgfVxuXG4gIC8vIFRvcCBxdWVzdGlvbnMgd291bGQgbmVlZCB0byBiZSBleHRyYWN0ZWQgZnJvbSBjaGF0IG1lc3NhZ2VzXG4gIC8vIEZvciBub3csIHdlJ2xsIHVzZSBhIHBsYWNlaG9sZGVyXG4gIGNvbnN0IHRvcFF1ZXN0aW9uczogeyBxdWVzdGlvbjogc3RyaW5nOyBjb3VudDogbnVtYmVyIH1bXSA9IFtdO1xuXG4gIC8vIFJlc3BvbnNlIHRpbWUgaGlzdG9yeSBmb3IgdGhlIGxhc3QgNyBkYXlzXG4gIGNvbnN0IHJlc3BvbnNlVGltZUhpc3Rvcnk6IHsgZGF0ZTogc3RyaW5nOyBhdmdUaW1lOiBudW1iZXIgfVtdID0gW107XG4gIGZvciAobGV0IGkgPSA2OyBpID49IDA7IGktLSkge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSAtIGkpO1xuICAgIGNvbnN0IGRhdGVTdHIgPSBkYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcbiAgICBjb25zdCBkYXlTZXNzaW9ucyA9IHNlc3Npb25zLmZpbHRlcihzID0+IHtcbiAgICAgIGNvbnN0IHNlc3Npb25EYXRlID0gbmV3IERhdGUocy5zdGFydGVkQXQpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcbiAgICAgIHJldHVybiBzZXNzaW9uRGF0ZSA9PT0gZGF0ZVN0cjtcbiAgICB9KTtcbiAgICBjb25zdCBhdmdUaW1lID0gZGF5U2Vzc2lvbnMubGVuZ3RoID4gMCBcbiAgICAgID8gZGF5U2Vzc2lvbnMucmVkdWNlKChzdW0sIHMpID0+IHN1bSArIHMuYXZlcmFnZVJlc3BvbnNlVGltZSwgMCkgLyBkYXlTZXNzaW9ucy5sZW5ndGggXG4gICAgICA6IDA7XG4gICAgcmVzcG9uc2VUaW1lSGlzdG9yeS5wdXNoKHsgZGF0ZTogZGF0ZVN0ciwgYXZnVGltZSB9KTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdG90YWxWaXNpdG9ycyxcbiAgICB0b3RhbENoYXRzLFxuICAgIHRvdGFsTWVzc2FnZXMsXG4gICAgYXZlcmFnZVJlc3BvbnNlVGltZSxcbiAgICBsYXN0QWN0aXZlQXQsXG4gICAgZGFpbHlWaXNpdG9ycyxcbiAgICB3ZWVrbHlDaGF0cyxcbiAgICB0b3BRdWVzdGlvbnMsXG4gICAgcmVzcG9uc2VUaW1lSGlzdG9yeVxuICB9O1xufTtcblxuLy8gU2VydmVyLXNpZGUgZGF0YWJhc2Ugb3BlcmF0aW9ucyAoZm9yIEFQSSByb3V0ZXMpXG5leHBvcnQgY29uc3Qgc2VydmVyRGIgPSB7XG4gIC8vIEdldCBib3QgYnkgSURcbiAgYXN5bmMgZ2V0Qm90KGJvdElkOiBzdHJpbmcpOiBQcm9taXNlPEJvdCB8IG51bGw+IHtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBzZXJ2ZXJEYi5nZXRCb3QgY2FsbGVkIGZvcjonLCBib3RJZCk7XG4gICAgXG4gICAgLy8gQWx3YXlzIGNoZWNrIG1vY2sgZGF0YWJhc2UgZmlyc3QgZm9yIGRldmVsb3BtZW50XG4gICAgY29uc3QgbW9ja0JvdHMgPSBnZXRNb2NrQm90cygpO1xuICAgIGNvbnN0IG1vY2tCb3QgPSBtb2NrQm90cy5nZXQoYm90SWQpO1xuICAgIFxuICAgIGlmIChtb2NrQm90KSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBNb2NrIGJvdCBkZXRhaWxzOicsIHtcbiAgICAgICAgaWQ6IG1vY2tCb3QuaWQsXG4gICAgICAgIG5hbWU6IG1vY2tCb3QubmFtZSxcbiAgICAgICAgb3duZXJJZDogbW9ja0JvdC5vd25lcklkLFxuICAgICAgICBvd25lclBob25lTnVtYmVyOiBtb2NrQm90Lm93bmVyUGhvbmVOdW1iZXJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBGb3IgZGV2ZWxvcG1lbnQsIHVzZSBtb2NrIGRhdGEgb25seSB0byBhdm9pZCBGaXJlYmFzZSBkZWxheXNcbiAgICBpZiAoIWFkbWluRGIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OxIEZpcmViYXNlIEFkbWluIG5vdCBhdmFpbGFibGUsIHVzaW5nIG1vY2sgZGF0YWJhc2Ugb25seScpO1xuICAgICAgaWYgKG1vY2tCb3QpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBSZXR1cm5pbmcgbW9jayBib3QgZGF0YSBmb3I6JywgYm90SWQpO1xuICAgICAgICByZXR1cm4gbW9ja0JvdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5qrIE1vY2sgYm90IG5vdCBmb3VuZCBmb3I6JywgYm90SWQpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gU2tpcCBGaXJlYmFzZSBmb3Igbm93IHRvIGltcHJvdmUgcGVyZm9ybWFuY2VcbiAgICAvLyBUT0RPOiBSZS1lbmFibGUgRmlyZWJhc2Ugd2hlbiBuZWVkZWQgZm9yIHByb2R1Y3Rpb25cbiAgICBpZiAobW9ja0JvdCkge1xuICAgICAgY29uc29sZS5sb2coJ+KchSBSZXR1cm5pbmcgbW9jayBib3QgZGF0YSBmb3I6JywgYm90SWQpO1xuICAgICAgcmV0dXJuIG1vY2tCb3Q7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5qrIEJvdCBub3QgZm91bmQgaW4gRmlyZWJhc2Ugb3IgbW9jayBkYXRhYmFzZTonLCBib3RJZCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG5cbiAgLy8gR2V0IGJvdCB3aXRoIGFuYWx5dGljc1xuICBhc3luYyBnZXRCb3RXaXRoQW5hbHl0aWNzKGJvdElkOiBzdHJpbmcpOiBQcm9taXNlPEJvdCB8IG51bGw+IHtcbiAgICBjb25zb2xlLmxvZygn8J+TiiBzZXJ2ZXJEYi5nZXRCb3RXaXRoQW5hbHl0aWNzIGNhbGxlZCBmb3I6JywgYm90SWQpO1xuICAgIFxuICAgIGNvbnN0IGJvdCA9IGF3YWl0IHRoaXMuZ2V0Qm90KGJvdElkKTtcbiAgICBpZiAoIWJvdCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gR2V0IGNoYXQgc2Vzc2lvbnMgZm9yIHRoaXMgYm90XG4gICAgY29uc3Qgc2Vzc2lvbnMgPSBhd2FpdCB0aGlzLmdldENoYXRTZXNzaW9uc0J5Qm90KGJvdElkKTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgYW5hbHl0aWNzIGZyb20gc2Vzc2lvbnNcbiAgICBjb25zdCBhbmFseXRpY3MgPSBjYWxjdWxhdGVBbmFseXRpY3Moc2Vzc2lvbnMpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICAuLi5ib3QsXG4gICAgICBhbmFseXRpY3NcbiAgICB9O1xuICB9LFxuXG4gIC8vIENyZWF0ZSBuZXcgYm90XG4gIGFzeW5jIGNyZWF0ZUJvdChib3REYXRhOiBCb3QpOiBQcm9taXNlPEJvdD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn6SWIHNlcnZlckRiLmNyZWF0ZUJvdCBjYWxsZWQgd2l0aDonLCBib3REYXRhLmlkKTtcbiAgICBcbiAgICAvLyBBbHdheXMgc2F2ZSB0byBtb2NrIGRhdGFiYXNlIGZvciBkZXZlbG9wbWVudCByZWxpYWJpbGl0eVxuICAgIGNvbnN0IG1vY2tCb3RzID0gZ2V0TW9ja0JvdHMoKTtcbiAgICBtb2NrQm90cy5zZXQoYm90RGF0YS5pZCwgYm90RGF0YSk7XG4gICAgY29uc29sZS5sb2coJ+KchSBCb3Qgc2F2ZWQgdG8gbW9jayBkYXRhYmFzZTonLCBib3REYXRhLmlkKTtcbiAgICBjb25zb2xlLmxvZygn8J+TiyBUb3RhbCBtb2NrIGJvdHMgbm93OicsIG1vY2tCb3RzLnNpemUpO1xuXG4gICAgLy8gU2F2ZSB0byBmaWxlIGZvciBwZXJzaXN0ZW5jZVxuICAgIHNhdmVUb0ZpbGUoQk9UU19GSUxFLCBtb2NrQm90cyk7XG4gICAgY29uc29sZS5sb2coJ/Cfkr4gQm90IGRhdGEgc2F2ZWQgdG8gZmlsZScpO1xuXG4gICAgLy8gVHJ5IHRvIHNhdmUgdG8gRmlyZWJhc2UgaWYgYXZhaWxhYmxlXG4gICAgaWYgKGFkbWluRGIpIHtcbiAgICAgIGNvbnN0IGZpcmViYXNlQXZhaWxhYmxlID0gYXdhaXQgaXNGaXJlYmFzZUF2YWlsYWJsZSgpO1xuICAgICAgaWYgKGZpcmViYXNlQXZhaWxhYmxlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ/CflKUgQXR0ZW1wdGluZyB0byBzYXZlIGJvdCB0byBGaXJlYmFzZS4uLicpO1xuICAgICAgICAgIC8vIENsZWFuIHRoZSBib3QgZGF0YSB0byBhdm9pZCBGaXJlc3RvcmUgdW5kZWZpbmVkIHZhbHVlIGVycm9yc1xuICAgICAgICAgIGNvbnN0IGNsZWFuQm90RGF0YSA9IHtcbiAgICAgICAgICAgIC4uLmJvdERhdGEsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYm90RGF0YS5kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgICAgICAgIGRlcGxveWVkQXQ6IGJvdERhdGEuZGVwbG95ZWRBdCB8fCBudWxsLFxuICAgICAgICAgICAgcHJvZmlsZVBpY3R1cmVVcmw6IGJvdERhdGEucHJvZmlsZVBpY3R1cmVVcmwgfHwgbnVsbCxcbiAgICAgICAgICAgIHdlbGNvbWVNZXNzYWdlOiBib3REYXRhLndlbGNvbWVNZXNzYWdlIHx8IG51bGwsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICBhd2FpdCBhZG1pbkRiLmNvbGxlY3Rpb24oJ2JvdHMnKS5kb2MoYm90RGF0YS5pZCkuc2V0KGNsZWFuQm90RGF0YSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KchSBCb3QgYWxzbyBzYXZlZCB0byBGaXJlYmFzZSBzdWNjZXNzZnVsbHknKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3Igc2F2aW5nIGJvdCB0byBGaXJlYmFzZSAodXNpbmcgbW9jayBhcyBwcmltYXJ5KTonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcikpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBib3REYXRhO1xuICB9LFxuXG4gIC8vIFVwZGF0ZSBib3RcbiAgYXN5bmMgdXBkYXRlQm90KGJvdERhdGE6IEJvdCk6IFByb21pc2U8Qm90PiB7XG4gICAgY29uc29sZS5sb2coJ/CflIQgc2VydmVyRGIudXBkYXRlQm90IGNhbGxlZCBmb3I6JywgYm90RGF0YS5pZCk7XG4gICAgXG4gICAgLy8gQWx3YXlzIHVwZGF0ZSBtb2NrIGRhdGFiYXNlXG4gICAgY29uc3QgbW9ja0JvdHMgPSBnZXRNb2NrQm90cygpO1xuICAgIG1vY2tCb3RzLnNldChib3REYXRhLmlkLCBib3REYXRhKTtcbiAgICBjb25zb2xlLmxvZygn4pyFIEJvdCB1cGRhdGVkIGluIG1vY2sgZGF0YWJhc2U6JywgYm90RGF0YS5pZCk7XG5cbiAgICAvLyBTYXZlIHRvIGZpbGUgZm9yIHBlcnNpc3RlbmNlXG4gICAgc2F2ZVRvRmlsZShCT1RTX0ZJTEUsIG1vY2tCb3RzKTtcbiAgICBjb25zb2xlLmxvZygn8J+SviBCb3QgZGF0YSBzYXZlZCB0byBmaWxlJyk7XG5cbiAgICAvLyBUcnkgdG8gdXBkYXRlIEZpcmViYXNlIGlmIGF2YWlsYWJsZVxuICAgIGlmIChhZG1pbkRiKSB7XG4gICAgICBjb25zdCBmaXJlYmFzZUF2YWlsYWJsZSA9IGF3YWl0IGlzRmlyZWJhc2VBdmFpbGFibGUoKTtcbiAgICAgIGlmIChmaXJlYmFzZUF2YWlsYWJsZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SlIEF0dGVtcHRpbmcgdG8gdXBkYXRlIGJvdCBpbiBGaXJlYmFzZS4uLicpO1xuICAgICAgICAgIC8vIENsZWFuIHRoZSBib3QgZGF0YSB0byBhdm9pZCBGaXJlc3RvcmUgdW5kZWZpbmVkIHZhbHVlIGVycm9yc1xuICAgICAgICAgIGNvbnN0IGNsZWFuQm90RGF0YSA9IHtcbiAgICAgICAgICAgIC4uLmJvdERhdGEsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYm90RGF0YS5kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgICAgICAgIGRlcGxveWVkQXQ6IGJvdERhdGEuZGVwbG95ZWRBdCB8fCBudWxsLFxuICAgICAgICAgICAgcHJvZmlsZVBpY3R1cmVVcmw6IGJvdERhdGEucHJvZmlsZVBpY3R1cmVVcmwgfHwgbnVsbCxcbiAgICAgICAgICAgIHdlbGNvbWVNZXNzYWdlOiBib3REYXRhLndlbGNvbWVNZXNzYWdlIHx8IG51bGwsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICBhd2FpdCBhZG1pbkRiLmNvbGxlY3Rpb24oJ2JvdHMnKS5kb2MoYm90RGF0YS5pZCkuc2V0KGNsZWFuQm90RGF0YSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KchSBCb3QgYWxzbyB1cGRhdGVkIGluIEZpcmViYXNlIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyBib3QgaW4gRmlyZWJhc2UgKHVzaW5nIG1vY2sgYXMgcHJpbWFyeSk6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gYm90RGF0YTtcbiAgfSxcblxuICAvLyBHZXQgYm90cyBieSBvd25lciBJRFxuICBhc3luYyBnZXRCb3RzQnlPd25lcihvd25lcklkOiBzdHJpbmcpOiBQcm9taXNlPEJvdFtdPiB7XG4gICAgY29uc29sZS5sb2coJ/Cfk4sgc2VydmVyRGIuZ2V0Qm90c0J5T3duZXIgY2FsbGVkIGZvcjonLCBvd25lcklkKTtcbiAgICBcbiAgICAvLyBBbHdheXMgY2hlY2sgbW9jayBkYXRhYmFzZVxuICAgIGNvbnN0IG1vY2tCb3RzID0gZ2V0TW9ja0JvdHMoKTtcbiAgICBjb25zdCBtb2NrT3duZXJCb3RzID0gQXJyYXkuZnJvbShtb2NrQm90cy52YWx1ZXMoKSkuZmlsdGVyKGJvdCA9PiBib3Qub3duZXJJZCA9PT0gb3duZXJJZCk7XG4gICAgY29uc29sZS5sb2coJ/Cfk7EgRm91bmQnLCBtb2NrT3duZXJCb3RzLmxlbmd0aCwgJ21vY2sgYm90cyBmb3Igb3duZXI6Jywgb3duZXJJZCk7XG5cbiAgICAvLyBJZiBubyBGaXJlYmFzZSwgcmV0dXJuIG1vY2sgb25seVxuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgY29uc29sZS5sb2coJ+KchSBSZXR1cm5pbmcgbW9jayBib3RzIG9ubHkgKG5vIEZpcmViYXNlKScpO1xuICAgICAgcmV0dXJuIG1vY2tPd25lckJvdHM7XG4gICAgfVxuICAgIFxuICAgIC8vIFRyeSBGaXJlYmFzZSBpZiBhdmFpbGFibGVcbiAgICBjb25zdCBmaXJlYmFzZUF2YWlsYWJsZSA9IGF3YWl0IGlzRmlyZWJhc2VBdmFpbGFibGUoKTtcbiAgICBpZiAoZmlyZWJhc2VBdmFpbGFibGUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SlIEF0dGVtcHRpbmcgdG8gZmV0Y2ggYm90cyBmcm9tIEZpcmViYXNlLi4uJyk7XG4gICAgICAgIGNvbnN0IHF1ZXJ5U25hcHNob3QgPSBhd2FpdCBhZG1pbkRiXG4gICAgICAgICAgLmNvbGxlY3Rpb24oJ2JvdHMnKVxuICAgICAgICAgIC53aGVyZSgnb3duZXJJZCcsICc9PScsIG93bmVySWQpXG4gICAgICAgICAgLm9yZGVyQnkoJ2NyZWF0ZWRBdCcsICdkZXNjJylcbiAgICAgICAgICAuZ2V0KCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBmaXJlYmFzZUJvdHM6IEJvdFtdID0gW107XG4gICAgICAgIHF1ZXJ5U25hcHNob3QuZm9yRWFjaCgoZG9jOiBhbnkpID0+IHtcbiAgICAgICAgICBmaXJlYmFzZUJvdHMucHVzaCh7IGlkOiBkb2MuaWQsIC4uLmRvYy5kYXRhKCkgfSBhcyBCb3QpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgRm91bmQnLCBmaXJlYmFzZUJvdHMubGVuZ3RoLCAnRmlyZWJhc2UgYm90cyBmb3Igb3duZXI6Jywgb3duZXJJZCk7XG4gICAgICAgIFxuICAgICAgICAvLyBJZiB3ZSBoYXZlIEZpcmViYXNlIGJvdHMsIHJldHVybiB0aGVtICh0aGV5J3JlIHRoZSBzb3VyY2Ugb2YgdHJ1dGgpXG4gICAgICAgIGlmIChmaXJlYmFzZUJvdHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiBmaXJlYmFzZUJvdHM7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGaXJlYmFzZSBxdWVyeSBmYWlsZWQgZm9yIGJvdHMgYnkgb3duZXI6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gRmFsbGJhY2sgdG8gbW9jayBkYXRhYmFzZVxuICAgIGNvbnNvbGUubG9nKCfwn5SEIFVzaW5nIG1vY2sgZGF0YWJhc2UgYXMgZmFsbGJhY2sgZm9yIGdldEJvdHNCeU93bmVyJyk7XG4gICAgcmV0dXJuIG1vY2tPd25lckJvdHM7XG4gIH0sXG5cbiAgLy8gR2V0IGJvdHMgYnkgcGhvbmUgbnVtYmVyIChmYWxsYmFjayBmb3IgY3Jvc3Mtc2Vzc2lvbiBpZGVudGlmaWNhdGlvbilcbiAgYXN5bmMgZ2V0Qm90c0J5UGhvbmVOdW1iZXIocGhvbmVOdW1iZXI6IHN0cmluZyk6IFByb21pc2U8Qm90W10+IHtcbiAgICBjb25zb2xlLmxvZygn8J+TsSBzZXJ2ZXJEYi5nZXRCb3RzQnlQaG9uZU51bWJlciBjYWxsZWQgZm9yOicsIHBob25lTnVtYmVyKTtcbiAgICBcbiAgICAvLyBBbHdheXMgY2hlY2sgbW9jayBkYXRhYmFzZVxuICAgIGNvbnN0IG1vY2tCb3RzID0gZ2V0TW9ja0JvdHMoKTtcbiAgICBjb25zdCBtb2NrUGhvbmVCb3RzID0gQXJyYXkuZnJvbShtb2NrQm90cy52YWx1ZXMoKSkuZmlsdGVyKGJvdCA9PiBib3Qub3duZXJQaG9uZU51bWJlciA9PT0gcGhvbmVOdW1iZXIpO1xuICAgIGNvbnNvbGUubG9nKCfwn5OxIEZvdW5kJywgbW9ja1Bob25lQm90cy5sZW5ndGgsICdtb2NrIGJvdHMgZm9yIHBob25lOicsIHBob25lTnVtYmVyKTtcblxuICAgIC8vIElmIG5vIEZpcmViYXNlLCByZXR1cm4gbW9jayBvbmx5XG4gICAgaWYgKCFhZG1pbkRiKSB7XG4gICAgICBjb25zb2xlLmxvZygn4pyFIFJldHVybmluZyBtb2NrIGJvdHMgb25seSAobm8gRmlyZWJhc2UpJyk7XG4gICAgICByZXR1cm4gbW9ja1Bob25lQm90cztcbiAgICB9XG4gICAgXG4gICAgLy8gVHJ5IEZpcmViYXNlIGlmIGF2YWlsYWJsZVxuICAgIGNvbnN0IGZpcmViYXNlQXZhaWxhYmxlID0gYXdhaXQgaXNGaXJlYmFzZUF2YWlsYWJsZSgpO1xuICAgIGlmIChmaXJlYmFzZUF2YWlsYWJsZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc29sZS5sb2coJ/CflKUgQXR0ZW1wdGluZyB0byBmZXRjaCBib3RzIGZyb20gRmlyZWJhc2UgYnkgcGhvbmUuLi4nKTtcbiAgICAgICAgY29uc3QgcXVlcnlTbmFwc2hvdCA9IGF3YWl0IGFkbWluRGJcbiAgICAgICAgICAuY29sbGVjdGlvbignYm90cycpXG4gICAgICAgICAgLndoZXJlKCdvd25lclBob25lTnVtYmVyJywgJz09JywgcGhvbmVOdW1iZXIpXG4gICAgICAgICAgLm9yZGVyQnkoJ2NyZWF0ZWRBdCcsICdkZXNjJylcbiAgICAgICAgICAuZ2V0KCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBmaXJlYmFzZUJvdHM6IEJvdFtdID0gW107XG4gICAgICAgIHF1ZXJ5U25hcHNob3QuZm9yRWFjaCgoZG9jOiBhbnkpID0+IHtcbiAgICAgICAgICBmaXJlYmFzZUJvdHMucHVzaCh7IGlkOiBkb2MuaWQsIC4uLmRvYy5kYXRhKCkgfSBhcyBCb3QpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgRm91bmQnLCBmaXJlYmFzZUJvdHMubGVuZ3RoLCAnRmlyZWJhc2UgYm90cyBmb3IgcGhvbmU6JywgcGhvbmVOdW1iZXIpO1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgd2UgaGF2ZSBGaXJlYmFzZSBib3RzLCByZXR1cm4gdGhlbSAodGhleSdyZSB0aGUgc291cmNlIG9mIHRydXRoKVxuICAgICAgICBpZiAoZmlyZWJhc2VCb3RzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm4gZmlyZWJhc2VCb3RzO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRmlyZWJhc2UgcXVlcnkgZmFpbGVkIGZvciBib3RzIGJ5IHBob25lOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIEZhbGxiYWNrIHRvIG1vY2sgZGF0YWJhc2VcbiAgICBjb25zb2xlLmxvZygn8J+UhCBVc2luZyBtb2NrIGRhdGFiYXNlIGFzIGZhbGxiYWNrIGZvciBnZXRCb3RzQnlQaG9uZU51bWJlcicpO1xuICAgIHJldHVybiBtb2NrUGhvbmVCb3RzO1xuICB9LFxuXG4gIC8vIEVuaGFuY2VkIGdldEJvdHNCeU93bmVyIHRoYXQgYWxzbyBjaGVja3MgcGhvbmUgbnVtYmVyIGFzIGZhbGxiYWNrXG4gIGFzeW5jIGdldEJvdHNCeU93bmVyV2l0aEZhbGxiYWNrKG93bmVySWQ6IHN0cmluZywgcGhvbmVOdW1iZXI/OiBzdHJpbmcpOiBQcm9taXNlPEJvdFtdPiB7XG4gICAgY29uc29sZS5sb2coJ/CflI0gc2VydmVyRGIuZ2V0Qm90c0J5T3duZXJXaXRoRmFsbGJhY2sgY2FsbGVkIGZvcjonLCBvd25lcklkLCAncGhvbmU6JywgcGhvbmVOdW1iZXIpO1xuICAgIFxuICAgIC8vIEZpcnN0IHRyeSB0byBnZXQgYm90cyBieSBvd25lciBJRFxuICAgIGxldCBib3RzID0gYXdhaXQgdGhpcy5nZXRCb3RzQnlPd25lcihvd25lcklkKTtcbiAgICBcbiAgICAvLyBJZiBubyBib3RzIGZvdW5kIGFuZCB3ZSBoYXZlIGEgcGhvbmUgbnVtYmVyLCB0cnkgcGhvbmUgbnVtYmVyIGZhbGxiYWNrXG4gICAgaWYgKGJvdHMubGVuZ3RoID09PSAwICYmIHBob25lTnVtYmVyKSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+UhCBObyBib3RzIGZvdW5kIGJ5IG93bmVyIElELCB0cnlpbmcgcGhvbmUgbnVtYmVyIGZhbGxiYWNrLi4uJyk7XG4gICAgICBjb25zdCBwaG9uZUJvdHMgPSBhd2FpdCB0aGlzLmdldEJvdHNCeVBob25lTnVtYmVyKHBob25lTnVtYmVyKTtcbiAgICAgIFxuICAgICAgaWYgKHBob25lQm90cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgRm91bmQgYm90cyBieSBwaG9uZSBudW1iZXIsIHVwZGF0aW5nIG93bmVyIElEcy4uLicpO1xuICAgICAgICAvLyBVcGRhdGUgdGhlIG93bmVyIElEcyB0byB0aGUgY3VycmVudCB1c2VyIElEIGZvciBmdXR1cmUgY29uc2lzdGVuY3lcbiAgICAgICAgZm9yIChjb25zdCBib3Qgb2YgcGhvbmVCb3RzKSB7XG4gICAgICAgICAgYm90Lm93bmVySWQgPSBvd25lcklkO1xuICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlQm90KGJvdCk7XG4gICAgICAgIH1cbiAgICAgICAgYm90cyA9IHBob25lQm90cztcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coJ/Cfk4ogVG90YWwgYm90cyBmb3VuZDonLCBib3RzLmxlbmd0aCk7XG4gICAgcmV0dXJuIGJvdHM7XG4gIH0sXG5cbiAgLy8gRGVsZXRlIGJvdFxuICBhc3luYyBkZWxldGVCb3QoYm90SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5eR77iPIHNlcnZlckRiLmRlbGV0ZUJvdCBjYWxsZWQgZm9yOicsIGJvdElkKTtcbiAgICBcbiAgICAvLyBBbHdheXMgZGVsZXRlIGZyb20gbW9jayBkYXRhYmFzZVxuICAgIGNvbnN0IG1vY2tCb3RzID0gZ2V0TW9ja0JvdHMoKTtcbiAgICBjb25zdCBkZWxldGVkID0gbW9ja0JvdHMuZGVsZXRlKGJvdElkKTtcbiAgICBjb25zb2xlLmxvZygn4pyFIEJvdCBkZWxldGVkIGZyb20gbW9jayBkYXRhYmFzZTonLCBkZWxldGVkKTtcblxuICAgIC8vIFNhdmUgdG8gZmlsZSBmb3IgcGVyc2lzdGVuY2VcbiAgICBzYXZlVG9GaWxlKEJPVFNfRklMRSwgbW9ja0JvdHMpO1xuICAgIGNvbnNvbGUubG9nKCfwn5K+IEJvdCBkYXRhIHNhdmVkIHRvIGZpbGUnKTtcblxuICAgIC8vIFRyeSB0byBkZWxldGUgZnJvbSBGaXJlYmFzZSBpZiBhdmFpbGFibGVcbiAgICBpZiAoYWRtaW5EYikge1xuICAgICAgY29uc3QgZmlyZWJhc2VBdmFpbGFibGUgPSBhd2FpdCBpc0ZpcmViYXNlQXZhaWxhYmxlKCk7XG4gICAgICBpZiAoZmlyZWJhc2VBdmFpbGFibGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+UpSBBdHRlbXB0aW5nIHRvIGRlbGV0ZSBib3QgZnJvbSBGaXJlYmFzZS4uLicpO1xuICAgICAgICAgIGF3YWl0IGFkbWluRGIuY29sbGVjdGlvbignYm90cycpLmRvYyhib3RJZCkuZGVsZXRlKCk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KchSBCb3QgYWxzbyBkZWxldGVkIGZyb20gRmlyZWJhc2Ugc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGRlbGV0aW5nIGJvdCBmcm9tIEZpcmViYXNlIChtb2NrIGRlbGV0aW9uIHN1Y2Nlc3NmdWwpOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGRlbGV0ZWQ7XG4gIH0sXG5cbiAgLy8gQ2hhdCBTZXNzaW9ucyBNYW5hZ2VtZW50XG4gIGFzeW5jIGNyZWF0ZUNoYXRTZXNzaW9uKHNlc3Npb25EYXRhOiBDaGF0U2Vzc2lvbik6IFByb21pc2U8Q2hhdFNlc3Npb24+IHtcbiAgICBjb25zb2xlLmxvZygn8J+SrCBzZXJ2ZXJEYi5jcmVhdGVDaGF0U2Vzc2lvbiBjYWxsZWQgZm9yIGJvdDonLCBzZXNzaW9uRGF0YS5ib3RJZCk7XG4gICAgXG4gICAgY29uc3QgbW9ja1Nlc3Npb25zID0gZ2V0TW9ja0NoYXRTZXNzaW9ucygpO1xuICAgIG1vY2tTZXNzaW9ucy5zZXQoc2Vzc2lvbkRhdGEuaWQsIHNlc3Npb25EYXRhKTtcbiAgICBjb25zb2xlLmxvZygn4pyFIENoYXQgc2Vzc2lvbiBzYXZlZCB0byBtb2NrIGRhdGFiYXNlOicsIHNlc3Npb25EYXRhLmlkKTtcblxuICAgIC8vIFNhdmUgdG8gZmlsZSBmb3IgcGVyc2lzdGVuY2VcbiAgICBzYXZlVG9GaWxlKENIQVRfU0VTU0lPTlNfRklMRSwgbW9ja1Nlc3Npb25zKTtcblxuICAgIC8vIFRyeSB0byBzYXZlIHRvIEZpcmViYXNlIGlmIGF2YWlsYWJsZVxuICAgIGlmIChhZG1pbkRiKSB7XG4gICAgICBjb25zdCBmaXJlYmFzZUF2YWlsYWJsZSA9IGF3YWl0IGlzRmlyZWJhc2VBdmFpbGFibGUoKTtcbiAgICAgIGlmIChmaXJlYmFzZUF2YWlsYWJsZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IGFkbWluRGIuY29sbGVjdGlvbignY2hhdFNlc3Npb25zJykuZG9jKHNlc3Npb25EYXRhLmlkKS5zZXQoc2Vzc2lvbkRhdGEpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgQ2hhdCBzZXNzaW9uIGFsc28gc2F2ZWQgdG8gRmlyZWJhc2Ugc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHNhdmluZyBjaGF0IHNlc3Npb24gdG8gRmlyZWJhc2U6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gc2Vzc2lvbkRhdGE7XG4gIH0sXG5cbiAgYXN5bmMgdXBkYXRlQ2hhdFNlc3Npb24oc2Vzc2lvbkRhdGE6IENoYXRTZXNzaW9uKTogUHJvbWlzZTxDaGF0U2Vzc2lvbj4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5SEIHNlcnZlckRiLnVwZGF0ZUNoYXRTZXNzaW9uIGNhbGxlZCBmb3I6Jywgc2Vzc2lvbkRhdGEuaWQpO1xuICAgIFxuICAgIGNvbnN0IG1vY2tTZXNzaW9ucyA9IGdldE1vY2tDaGF0U2Vzc2lvbnMoKTtcbiAgICBtb2NrU2Vzc2lvbnMuc2V0KHNlc3Npb25EYXRhLmlkLCBzZXNzaW9uRGF0YSk7XG4gICAgY29uc29sZS5sb2coJ+KchSBDaGF0IHNlc3Npb24gdXBkYXRlZCBpbiBtb2NrIGRhdGFiYXNlOicsIHNlc3Npb25EYXRhLmlkKTtcblxuICAgIC8vIFNhdmUgdG8gZmlsZSBmb3IgcGVyc2lzdGVuY2VcbiAgICBzYXZlVG9GaWxlKENIQVRfU0VTU0lPTlNfRklMRSwgbW9ja1Nlc3Npb25zKTtcblxuICAgIC8vIFRyeSB0byB1cGRhdGUgRmlyZWJhc2UgaWYgYXZhaWxhYmxlXG4gICAgaWYgKGFkbWluRGIpIHtcbiAgICAgIGNvbnN0IGZpcmViYXNlQXZhaWxhYmxlID0gYXdhaXQgaXNGaXJlYmFzZUF2YWlsYWJsZSgpO1xuICAgICAgaWYgKGZpcmViYXNlQXZhaWxhYmxlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgYWRtaW5EYi5jb2xsZWN0aW9uKCdjaGF0U2Vzc2lvbnMnKS5kb2Moc2Vzc2lvbkRhdGEuaWQpLnNldChzZXNzaW9uRGF0YSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KchSBDaGF0IHNlc3Npb24gYWxzbyB1cGRhdGVkIGluIEZpcmViYXNlIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyBjaGF0IHNlc3Npb24gaW4gRmlyZWJhc2U6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gc2Vzc2lvbkRhdGE7XG4gIH0sXG5cbiAgYXN5bmMgZ2V0Q2hhdFNlc3Npb25zQnlCb3QoYm90SWQ6IHN0cmluZyk6IFByb21pc2U8Q2hhdFNlc3Npb25bXT4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5OKIHNlcnZlckRiLmdldENoYXRTZXNzaW9uc0J5Qm90IGNhbGxlZCBmb3I6JywgYm90SWQpO1xuICAgIFxuICAgIGNvbnN0IG1vY2tTZXNzaW9ucyA9IGdldE1vY2tDaGF0U2Vzc2lvbnMoKTtcbiAgICBjb25zdCBtb2NrQm90U2Vzc2lvbnMgPSBBcnJheS5mcm9tKG1vY2tTZXNzaW9ucy52YWx1ZXMoKSkuZmlsdGVyKHNlc3Npb24gPT4gc2Vzc2lvbi5ib3RJZCA9PT0gYm90SWQpO1xuICAgIGNvbnNvbGUubG9nKCfwn5OxIEZvdW5kJywgbW9ja0JvdFNlc3Npb25zLmxlbmd0aCwgJ21vY2sgc2Vzc2lvbnMgZm9yIGJvdDonLCBib3RJZCk7XG5cbiAgICAvLyBGb3IgZGV2ZWxvcG1lbnQsIHVzZSBtb2NrIGRhdGEgb25seSB0byBhdm9pZCBGaXJlYmFzZSBkZWxheXNcbiAgICBpZiAoIWFkbWluRGIpIHtcbiAgICAgIHJldHVybiBtb2NrQm90U2Vzc2lvbnM7XG4gICAgfVxuICAgIFxuICAgIC8vIFNraXAgRmlyZWJhc2UgZm9yIG5vdyB0byBpbXByb3ZlIHBlcmZvcm1hbmNlXG4gICAgLy8gVE9ETzogUmUtZW5hYmxlIEZpcmViYXNlIHdoZW4gbmVlZGVkIGZvciBwcm9kdWN0aW9uXG4gICAgcmV0dXJuIG1vY2tCb3RTZXNzaW9ucztcbiAgfSxcblxuICAvLyBVbmFuc3dlcmVkIFF1ZXN0aW9ucyBNYW5hZ2VtZW50XG4gIGFzeW5jIGNyZWF0ZVVuYW5zd2VyZWRRdWVzdGlvbihxdWVzdGlvbkRhdGE6IFVuYW5zd2VyZWRRdWVzdGlvbik6IFByb21pc2U8VW5hbnN3ZXJlZFF1ZXN0aW9uPiB7XG4gICAgY29uc29sZS5sb2coJ+KdkyBzZXJ2ZXJEYi5jcmVhdGVVbmFuc3dlcmVkUXVlc3Rpb24gY2FsbGVkIGZvciBib3Q6JywgcXVlc3Rpb25EYXRhLmJvdElkKTtcbiAgICBcbiAgICBjb25zdCBtb2NrUXVlc3Rpb25zID0gZ2V0TW9ja1VuYW5zd2VyZWRRdWVzdGlvbnMoKTtcbiAgICBtb2NrUXVlc3Rpb25zLnNldChxdWVzdGlvbkRhdGEuaWQsIHF1ZXN0aW9uRGF0YSk7XG4gICAgY29uc29sZS5sb2coJ+KchSBVbmFuc3dlcmVkIHF1ZXN0aW9uIHNhdmVkIHRvIG1vY2sgZGF0YWJhc2U6JywgcXVlc3Rpb25EYXRhLmlkKTtcblxuICAgIC8vIFNhdmUgdG8gZmlsZSBmb3IgcGVyc2lzdGVuY2VcbiAgICBzYXZlVG9GaWxlKFVOQU5TV0VSRURfUVVFU1RJT05TX0ZJTEUsIG1vY2tRdWVzdGlvbnMpO1xuXG4gICAgLy8gVHJ5IHRvIHNhdmUgdG8gRmlyZWJhc2UgaWYgYXZhaWxhYmxlXG4gICAgaWYgKGFkbWluRGIpIHtcbiAgICAgIGNvbnN0IGZpcmViYXNlQXZhaWxhYmxlID0gYXdhaXQgaXNGaXJlYmFzZUF2YWlsYWJsZSgpO1xuICAgICAgaWYgKGZpcmViYXNlQXZhaWxhYmxlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgYWRtaW5EYi5jb2xsZWN0aW9uKCd1bmFuc3dlcmVkUXVlc3Rpb25zJykuZG9jKHF1ZXN0aW9uRGF0YS5pZCkuc2V0KHF1ZXN0aW9uRGF0YSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KchSBVbmFuc3dlcmVkIHF1ZXN0aW9uIGFsc28gc2F2ZWQgdG8gRmlyZWJhc2Ugc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHNhdmluZyB1bmFuc3dlcmVkIHF1ZXN0aW9uIHRvIEZpcmViYXNlOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHF1ZXN0aW9uRGF0YTtcbiAgfSxcblxuICBhc3luYyB1cGRhdGVVbmFuc3dlcmVkUXVlc3Rpb24ocXVlc3Rpb25EYXRhOiBVbmFuc3dlcmVkUXVlc3Rpb24pOiBQcm9taXNlPFVuYW5zd2VyZWRRdWVzdGlvbj4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5SEIHNlcnZlckRiLnVwZGF0ZVVuYW5zd2VyZWRRdWVzdGlvbiBjYWxsZWQgZm9yOicsIHF1ZXN0aW9uRGF0YS5pZCk7XG4gICAgXG4gICAgY29uc3QgbW9ja1F1ZXN0aW9ucyA9IGdldE1vY2tVbmFuc3dlcmVkUXVlc3Rpb25zKCk7XG4gICAgbW9ja1F1ZXN0aW9ucy5zZXQocXVlc3Rpb25EYXRhLmlkLCBxdWVzdGlvbkRhdGEpO1xuICAgIGNvbnNvbGUubG9nKCfinIUgVW5hbnN3ZXJlZCBxdWVzdGlvbiB1cGRhdGVkIGluIG1vY2sgZGF0YWJhc2U6JywgcXVlc3Rpb25EYXRhLmlkKTtcblxuICAgIC8vIFNhdmUgdG8gZmlsZSBmb3IgcGVyc2lzdGVuY2VcbiAgICBzYXZlVG9GaWxlKFVOQU5TV0VSRURfUVVFU1RJT05TX0ZJTEUsIG1vY2tRdWVzdGlvbnMpO1xuXG4gICAgLy8gVHJ5IHRvIHVwZGF0ZSBGaXJlYmFzZSBpZiBhdmFpbGFibGVcbiAgICBpZiAoYWRtaW5EYikge1xuICAgICAgY29uc3QgZmlyZWJhc2VBdmFpbGFibGUgPSBhd2FpdCBpc0ZpcmViYXNlQXZhaWxhYmxlKCk7XG4gICAgICBpZiAoZmlyZWJhc2VBdmFpbGFibGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBhZG1pbkRiLmNvbGxlY3Rpb24oJ3VuYW5zd2VyZWRRdWVzdGlvbnMnKS5kb2MocXVlc3Rpb25EYXRhLmlkKS5zZXQocXVlc3Rpb25EYXRhKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIFVuYW5zd2VyZWQgcXVlc3Rpb24gYWxzbyB1cGRhdGVkIGluIEZpcmViYXNlIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyB1bmFuc3dlcmVkIHF1ZXN0aW9uIGluIEZpcmViYXNlOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHF1ZXN0aW9uRGF0YTtcbiAgfSxcblxuICBhc3luYyBnZXRVbmFuc3dlcmVkUXVlc3Rpb25zQnlCb3QoYm90SWQ6IHN0cmluZyk6IFByb21pc2U8VW5hbnN3ZXJlZFF1ZXN0aW9uW10+IHtcbiAgICBjb25zb2xlLmxvZygn4p2TIHNlcnZlckRiLmdldFVuYW5zd2VyZWRRdWVzdGlvbnNCeUJvdCBjYWxsZWQgZm9yOicsIGJvdElkKTtcbiAgICBcbiAgICBjb25zdCBtb2NrUXVlc3Rpb25zID0gZ2V0TW9ja1VuYW5zd2VyZWRRdWVzdGlvbnMoKTtcbiAgICBjb25zdCBtb2NrQm90UXVlc3Rpb25zID0gQXJyYXkuZnJvbShtb2NrUXVlc3Rpb25zLnZhbHVlcygpKS5maWx0ZXIocXVlc3Rpb24gPT4gcXVlc3Rpb24uYm90SWQgPT09IGJvdElkKTtcbiAgICBjb25zb2xlLmxvZygn8J+TsSBGb3VuZCcsIG1vY2tCb3RRdWVzdGlvbnMubGVuZ3RoLCAnbW9jayB1bmFuc3dlcmVkIHF1ZXN0aW9ucyBmb3IgYm90OicsIGJvdElkKTtcblxuICAgIC8vIEZvciBkZXZlbG9wbWVudCwgdXNlIG1vY2sgZGF0YSBvbmx5IHRvIGF2b2lkIEZpcmViYXNlIGRlbGF5c1xuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgcmV0dXJuIG1vY2tCb3RRdWVzdGlvbnM7XG4gICAgfVxuICAgIFxuICAgIC8vIFNraXAgRmlyZWJhc2UgZm9yIG5vdyB0byBpbXByb3ZlIHBlcmZvcm1hbmNlXG4gICAgLy8gVE9ETzogUmUtZW5hYmxlIEZpcmViYXNlIHdoZW4gbmVlZGVkIGZvciBwcm9kdWN0aW9uXG4gICAgcmV0dXJuIG1vY2tCb3RRdWVzdGlvbnM7XG4gIH0sXG5cbiAgYXN5bmMgZ2V0VW5hbnN3ZXJlZFF1ZXN0aW9uKHF1ZXN0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8VW5hbnN3ZXJlZFF1ZXN0aW9uIHwgbnVsbD4ge1xuICAgIGNvbnNvbGUubG9nKCfinZMgc2VydmVyRGIuZ2V0VW5hbnN3ZXJlZFF1ZXN0aW9uIGNhbGxlZCBmb3I6JywgcXVlc3Rpb25JZCk7XG4gICAgXG4gICAgY29uc3QgbW9ja1F1ZXN0aW9ucyA9IGdldE1vY2tVbmFuc3dlcmVkUXVlc3Rpb25zKCk7XG4gICAgY29uc3QgbW9ja1F1ZXN0aW9uID0gbW9ja1F1ZXN0aW9ucy5nZXQocXVlc3Rpb25JZCk7XG5cbiAgICAvLyBJZiBubyBGaXJlYmFzZSwgcmV0dXJuIG1vY2sgb25seVxuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgcmV0dXJuIG1vY2tRdWVzdGlvbiB8fCBudWxsO1xuICAgIH1cbiAgICBcbiAgICAvLyBUcnkgRmlyZWJhc2UgaWYgYXZhaWxhYmxlXG4gICAgY29uc3QgZmlyZWJhc2VBdmFpbGFibGUgPSBhd2FpdCBpc0ZpcmViYXNlQXZhaWxhYmxlKCk7XG4gICAgaWYgKGZpcmViYXNlQXZhaWxhYmxlKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBkb2NSZWYgPSBhZG1pbkRiLmNvbGxlY3Rpb24oJ3VuYW5zd2VyZWRRdWVzdGlvbnMnKS5kb2MocXVlc3Rpb25JZCk7XG4gICAgICAgIGNvbnN0IGRvY1NuYXAgPSBhd2FpdCBkb2NSZWYuZ2V0KCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoZG9jU25hcC5leGlzdHMpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIFVuYW5zd2VyZWQgcXVlc3Rpb24gZm91bmQgaW4gRmlyZWJhc2U6JywgcXVlc3Rpb25JZCk7XG4gICAgICAgICAgcmV0dXJuIHsgaWQ6IGRvY1NuYXAuaWQsIC4uLmRvY1NuYXAuZGF0YSgpIH0gYXMgVW5hbnN3ZXJlZFF1ZXN0aW9uO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRmlyZWJhc2UgcXVlcnkgZmFpbGVkIGZvciB1bmFuc3dlcmVkIHF1ZXN0aW9uOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBtb2NrUXVlc3Rpb24gfHwgbnVsbDtcbiAgfVxufTsgIl0sIm5hbWVzIjpbImNvbGxlY3Rpb24iLCJkb2MiLCJnZXREb2MiLCJhZGREb2MiLCJkYiIsImFkbWluRGIiLCJmcyIsInBhdGgiLCJjbGllbnREYiIsImdldEJvdCIsImJvdElkIiwiZG9jUmVmIiwiZG9jU25hcCIsImV4aXN0cyIsImlkIiwiZGF0YSIsImVycm9yIiwiY29uc29sZSIsImFkZENoYXRTZXNzaW9uIiwic2Vzc2lvbkRhdGEiLCJERVZfREFUQV9ESVIiLCJqb2luIiwicHJvY2VzcyIsImN3ZCIsIkJPVFNfRklMRSIsIkNIQVRfU0VTU0lPTlNfRklMRSIsIlVOQU5TV0VSRURfUVVFU1RJT05TX0ZJTEUiLCJlbnN1cmVEZXZEYXRhRGlyIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSIsIndhcm4iLCJsb2FkRnJvbUZpbGUiLCJmaWxlUGF0aCIsIk1hcCIsImxvZyIsInJlYWRGaWxlU3luYyIsImxlbmd0aCIsInBhcnNlZCIsIkpTT04iLCJwYXJzZSIsIk9iamVjdCIsImtleXMiLCJtYXAiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImtleSIsInZhbHVlIiwicHJvcCIsImluY2x1ZGVzIiwib3JpZ2luYWxWYWx1ZSIsIkRhdGUiLCJzZXQiLCJzaXplIiwic2F2ZVRvRmlsZSIsIm9iaiIsImZyb21FbnRyaWVzIiwid3JpdGVGaWxlU3luYyIsInN0cmluZ2lmeSIsImdsb2JhbCIsIl9fTU9DS19CT1RTX18iLCJfX01PQ0tfQ0hBVF9TRVNTSU9OU19fIiwiX19NT0NLX1VOQU5TV0VSRURfUVVFU1RJT05TX18iLCJnZXRNb2NrQm90cyIsImdldE1vY2tDaGF0U2Vzc2lvbnMiLCJnZXRNb2NrVW5hbnN3ZXJlZFF1ZXN0aW9ucyIsImZpcmViYXNlQXZhaWxhYmxlQ2FjaGUiLCJmaXJlYmFzZUNoZWNrVGltZSIsIkZJUkVCQVNFX0NIRUNLX0NBQ0hFX0RVUkFUSU9OIiwiaXNGaXJlYmFzZUF2YWlsYWJsZSIsIm5vdyIsImxpbWl0IiwiZ2V0IiwiY2FsY3VsYXRlQW5hbHl0aWNzIiwic2Vzc2lvbnMiLCJ0b3RhbFZpc2l0b3JzIiwidG90YWxDaGF0cyIsInRvdGFsTWVzc2FnZXMiLCJhdmVyYWdlUmVzcG9uc2VUaW1lIiwiZGFpbHlWaXNpdG9ycyIsIndlZWtseUNoYXRzIiwidG9wUXVlc3Rpb25zIiwicmVzcG9uc2VUaW1lSGlzdG9yeSIsImZpbHRlciIsInMiLCJtZXNzYWdlQ291bnQiLCJyZWR1Y2UiLCJzdW0iLCJsYXN0QWN0aXZlQXQiLCJNYXRoIiwibWF4IiwibGFzdEFjdGl2aXR5QXQiLCJnZXRUaW1lIiwiaSIsImRhdGUiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImRhdGVTdHIiLCJ0b0lTT1N0cmluZyIsInNwbGl0IiwiY291bnQiLCJzZXNzaW9uRGF0ZSIsInN0YXJ0ZWRBdCIsInB1c2giLCJzdGFydE9mV2VlayIsInNldEhvdXJzIiwiZW5kT2ZXZWVrIiwid2Vla1N0ciIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIndlZWsiLCJkYXlTZXNzaW9ucyIsImF2Z1RpbWUiLCJzZXJ2ZXJEYiIsIm1vY2tCb3RzIiwibW9ja0JvdCIsIm5hbWUiLCJvd25lcklkIiwib3duZXJQaG9uZU51bWJlciIsImdldEJvdFdpdGhBbmFseXRpY3MiLCJib3QiLCJnZXRDaGF0U2Vzc2lvbnNCeUJvdCIsImFuYWx5dGljcyIsImNyZWF0ZUJvdCIsImJvdERhdGEiLCJmaXJlYmFzZUF2YWlsYWJsZSIsImNsZWFuQm90RGF0YSIsImRlc2NyaXB0aW9uIiwiZGVwbG95ZWRBdCIsInByb2ZpbGVQaWN0dXJlVXJsIiwid2VsY29tZU1lc3NhZ2UiLCJFcnJvciIsIm1lc3NhZ2UiLCJTdHJpbmciLCJ1cGRhdGVCb3QiLCJnZXRCb3RzQnlPd25lciIsIm1vY2tPd25lckJvdHMiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJxdWVyeVNuYXBzaG90Iiwid2hlcmUiLCJvcmRlckJ5IiwiZmlyZWJhc2VCb3RzIiwiZ2V0Qm90c0J5UGhvbmVOdW1iZXIiLCJwaG9uZU51bWJlciIsIm1vY2tQaG9uZUJvdHMiLCJnZXRCb3RzQnlPd25lcldpdGhGYWxsYmFjayIsImJvdHMiLCJwaG9uZUJvdHMiLCJkZWxldGVCb3QiLCJkZWxldGVkIiwiZGVsZXRlIiwiY3JlYXRlQ2hhdFNlc3Npb24iLCJtb2NrU2Vzc2lvbnMiLCJ1cGRhdGVDaGF0U2Vzc2lvbiIsIm1vY2tCb3RTZXNzaW9ucyIsInNlc3Npb24iLCJjcmVhdGVVbmFuc3dlcmVkUXVlc3Rpb24iLCJxdWVzdGlvbkRhdGEiLCJtb2NrUXVlc3Rpb25zIiwidXBkYXRlVW5hbnN3ZXJlZFF1ZXN0aW9uIiwiZ2V0VW5hbnN3ZXJlZFF1ZXN0aW9uc0J5Qm90IiwibW9ja0JvdFF1ZXN0aW9ucyIsInF1ZXN0aW9uIiwiZ2V0VW5hbnN3ZXJlZFF1ZXN0aW9uIiwicXVlc3Rpb25JZCIsIm1vY2tRdWVzdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/database/index.ts\n");

/***/ }),

/***/ "(api)/./lib/firebase-admin.ts":
/*!*******************************!*\
  !*** ./lib/firebase-admin.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   adminDb: () => (/* binding */ adminDb)\n/* harmony export */ });\n/* harmony import */ var firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase-admin/app */ \"firebase-admin/app\");\n/* harmony import */ var firebase_admin_app__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase-admin/firestore */ \"firebase-admin/firestore\");\n/* harmony import */ var firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconsole.log(\"\\uD83D\\uDD0D Firebase Admin credentials check:\", {\n    hasProjectId: !!process.env.FIREBASE_PROJECT_ID,\n    hasClientEmail: !!process.env.FIREBASE_CLIENT_EMAIL,\n    hasPrivateKey: !!process.env.FIREBASE_PRIVATE_KEY,\n    isValidPrivateKey: process.env.FIREBASE_PRIVATE_KEY ? process.env.FIREBASE_PRIVATE_KEY.includes(\"BEGIN PRIVATE KEY\") : false,\n    hasValidCredentials: !!(process.env.FIREBASE_PROJECT_ID && process.env.FIREBASE_CLIENT_EMAIL && process.env.FIREBASE_PRIVATE_KEY),\n    privateKeyLength: process.env.FIREBASE_PRIVATE_KEY ? process.env.FIREBASE_PRIVATE_KEY.length : 0\n});\nlet adminDb = null;\n// Test Firebase connection\nasync function testFirebaseConnection(db) {\n    try {\n        await db.collection(\"_test\").limit(1).get();\n        console.log(\"✅ Firebase connection test successful\");\n    } catch (testError) {\n        console.warn(\"⚠️ Firebase connection test failed:\", testError instanceof Error ? testError.message : String(testError));\n        console.log(\"\\uD83D\\uDD04 Will fallback to mock database for operations\");\n    }\n}\ntry {\n    // Check if we have all required credentials\n    if (!process.env.FIREBASE_PROJECT_ID || !process.env.FIREBASE_CLIENT_EMAIL || !process.env.FIREBASE_PRIVATE_KEY) {\n        console.log(\"\\uD83D\\uDEAB Firebase Admin disabled - missing credentials, using mock data for development\");\n        adminDb = null;\n    } else {\n        // Initialize Firebase Admin if not already initialized\n        if ((0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__.getApps)().length === 0) {\n            // Clean and validate the private key\n            let privateKey = process.env.FIREBASE_PRIVATE_KEY;\n            // Handle different private key formats\n            if (privateKey.startsWith('\"') && privateKey.endsWith('\"')) {\n                privateKey = privateKey.slice(1, -1);\n            }\n            // Replace escaped newlines with actual newlines\n            privateKey = privateKey.replace(/\\\\n/g, \"\\n\");\n            // Validate the private key format\n            if (!privateKey.includes(\"BEGIN PRIVATE KEY\") || !privateKey.includes(\"END PRIVATE KEY\")) {\n                throw new Error(\"Invalid private key format - must contain BEGIN and END PRIVATE KEY markers\");\n            }\n            console.log(\"\\uD83D\\uDD27 Initializing Firebase Admin with cleaned credentials...\");\n            const serviceAccount = {\n                projectId: process.env.FIREBASE_PROJECT_ID,\n                clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\n                privateKey: privateKey\n            };\n            const app = (0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__.initializeApp)({\n                credential: (0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__.cert)(serviceAccount),\n                projectId: process.env.FIREBASE_PROJECT_ID\n            });\n            adminDb = (0,firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1__.getFirestore)(app);\n            console.log(\"✅ Firebase Admin initialized successfully\");\n            // Test the connection asynchronously\n            testFirebaseConnection(adminDb);\n        } else {\n            adminDb = (0,firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1__.getFirestore)();\n            console.log(\"✅ Firebase Admin already initialized\");\n        }\n    }\n} catch (error) {\n    console.error(\"❌ Firebase Admin initialization failed:\", error instanceof Error ? error.message : String(error));\n    console.log(\"\\uD83D\\uDEAB Firebase Admin disabled - using mock data for development\");\n    adminDb = null;\n}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNkcEMsUUFBUW9DLEtBQUssQ0FBQywyQ0FBMkNBLGlCQUFpQmIsUUFBUWEsTUFBTVosT0FBTyxHQUFHQyxPQUFPVztJQUN6R3BDLFFBQVFDLEdBQUcsQ0FBQztJQUNaYyxVQUFVO0FBQ1o7QUFFbUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hc3F1ZS1ib3QtcGxhdGZvcm0vLi9saWIvZmlyZWJhc2UtYWRtaW4udHM/NmE0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbml0aWFsaXplQXBwLCBnZXRBcHBzLCBjZXJ0IH0gZnJvbSAnZmlyZWJhc2UtYWRtaW4vYXBwJztcbmltcG9ydCB7IGdldEZpcmVzdG9yZSB9IGZyb20gJ2ZpcmViYXNlLWFkbWluL2ZpcmVzdG9yZSc7XG5cbmNvbnNvbGUubG9nKCfwn5SNIEZpcmViYXNlIEFkbWluIGNyZWRlbnRpYWxzIGNoZWNrOicsIHtcbiAgaGFzUHJvamVjdElkOiAhIXByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQsXG4gIGhhc0NsaWVudEVtYWlsOiAhIXByb2Nlc3MuZW52LkZJUkVCQVNFX0NMSUVOVF9FTUFJTCxcbiAgaGFzUHJpdmF0ZUtleTogISFwcm9jZXNzLmVudi5GSVJFQkFTRV9QUklWQVRFX0tFWSxcbiAgaXNWYWxpZFByaXZhdGVLZXk6IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BSSVZBVEVfS0VZID8gcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJJVkFURV9LRVkuaW5jbHVkZXMoJ0JFR0lOIFBSSVZBVEUgS0VZJykgOiBmYWxzZSxcbiAgaGFzVmFsaWRDcmVkZW50aWFsczogISEocHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJPSkVDVF9JRCAmJiBwcm9jZXNzLmVudi5GSVJFQkFTRV9DTElFTlRfRU1BSUwgJiYgcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJJVkFURV9LRVkpLFxuICBwcml2YXRlS2V5TGVuZ3RoOiBwcm9jZXNzLmVudi5GSVJFQkFTRV9QUklWQVRFX0tFWSA/IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BSSVZBVEVfS0VZLmxlbmd0aCA6IDBcbn0pO1xuXG5sZXQgYWRtaW5EYjogRmlyZWJhc2VGaXJlc3RvcmUuRmlyZXN0b3JlIHwgbnVsbCA9IG51bGw7XG5cbi8vIFRlc3QgRmlyZWJhc2UgY29ubmVjdGlvblxuYXN5bmMgZnVuY3Rpb24gdGVzdEZpcmViYXNlQ29ubmVjdGlvbihkYjogRmlyZWJhc2VGaXJlc3RvcmUuRmlyZXN0b3JlKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignX3Rlc3QnKS5saW1pdCgxKS5nZXQoKTtcbiAgICBjb25zb2xlLmxvZygn4pyFIEZpcmViYXNlIGNvbm5lY3Rpb24gdGVzdCBzdWNjZXNzZnVsJyk7XG4gIH0gY2F0Y2ggKHRlc3RFcnJvcikge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZpcmViYXNlIGNvbm5lY3Rpb24gdGVzdCBmYWlsZWQ6JywgdGVzdEVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyB0ZXN0RXJyb3IubWVzc2FnZSA6IFN0cmluZyh0ZXN0RXJyb3IpKTtcbiAgICBjb25zb2xlLmxvZygn8J+UhCBXaWxsIGZhbGxiYWNrIHRvIG1vY2sgZGF0YWJhc2UgZm9yIG9wZXJhdGlvbnMnKTtcbiAgfVxufVxuXG50cnkge1xuICAvLyBDaGVjayBpZiB3ZSBoYXZlIGFsbCByZXF1aXJlZCBjcmVkZW50aWFsc1xuICBpZiAoIXByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQgfHwgIXByb2Nlc3MuZW52LkZJUkVCQVNFX0NMSUVOVF9FTUFJTCB8fCAhcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJJVkFURV9LRVkpIHtcbiAgICBjb25zb2xlLmxvZygn8J+aqyBGaXJlYmFzZSBBZG1pbiBkaXNhYmxlZCAtIG1pc3NpbmcgY3JlZGVudGlhbHMsIHVzaW5nIG1vY2sgZGF0YSBmb3IgZGV2ZWxvcG1lbnQnKTtcbiAgICBhZG1pbkRiID0gbnVsbDtcbiAgfSBlbHNlIHtcbiAgICAvLyBJbml0aWFsaXplIEZpcmViYXNlIEFkbWluIGlmIG5vdCBhbHJlYWR5IGluaXRpYWxpemVkXG4gICAgaWYgKGdldEFwcHMoKS5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIENsZWFuIGFuZCB2YWxpZGF0ZSB0aGUgcHJpdmF0ZSBrZXlcbiAgICAgIGxldCBwcml2YXRlS2V5ID0gcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJJVkFURV9LRVk7XG4gICAgICBcbiAgICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgcHJpdmF0ZSBrZXkgZm9ybWF0c1xuICAgICAgaWYgKHByaXZhdGVLZXkuc3RhcnRzV2l0aCgnXCInKSAmJiBwcml2YXRlS2V5LmVuZHNXaXRoKCdcIicpKSB7XG4gICAgICAgIHByaXZhdGVLZXkgPSBwcml2YXRlS2V5LnNsaWNlKDEsIC0xKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gUmVwbGFjZSBlc2NhcGVkIG5ld2xpbmVzIHdpdGggYWN0dWFsIG5ld2xpbmVzXG4gICAgICBwcml2YXRlS2V5ID0gcHJpdmF0ZUtleS5yZXBsYWNlKC9cXFxcbi9nLCAnXFxuJyk7XG4gICAgICBcbiAgICAgIC8vIFZhbGlkYXRlIHRoZSBwcml2YXRlIGtleSBmb3JtYXRcbiAgICAgIGlmICghcHJpdmF0ZUtleS5pbmNsdWRlcygnQkVHSU4gUFJJVkFURSBLRVknKSB8fCAhcHJpdmF0ZUtleS5pbmNsdWRlcygnRU5EIFBSSVZBVEUgS0VZJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHByaXZhdGUga2V5IGZvcm1hdCAtIG11c3QgY29udGFpbiBCRUdJTiBhbmQgRU5EIFBSSVZBVEUgS0VZIG1hcmtlcnMnKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ/CflKcgSW5pdGlhbGl6aW5nIEZpcmViYXNlIEFkbWluIHdpdGggY2xlYW5lZCBjcmVkZW50aWFscy4uLicpO1xuICAgICAgXG4gICAgICBjb25zdCBzZXJ2aWNlQWNjb3VudCA9IHtcbiAgICAgICAgcHJvamVjdElkOiBwcm9jZXNzLmVudi5GSVJFQkFTRV9QUk9KRUNUX0lELFxuICAgICAgICBjbGllbnRFbWFpbDogcHJvY2Vzcy5lbnYuRklSRUJBU0VfQ0xJRU5UX0VNQUlMLFxuICAgICAgICBwcml2YXRlS2V5OiBwcml2YXRlS2V5LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgYXBwID0gaW5pdGlhbGl6ZUFwcCh7XG4gICAgICAgIGNyZWRlbnRpYWw6IGNlcnQoc2VydmljZUFjY291bnQpLFxuICAgICAgICBwcm9qZWN0SWQ6IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQsXG4gICAgICB9KTtcblxuICAgICAgYWRtaW5EYiA9IGdldEZpcmVzdG9yZShhcHApO1xuICAgICAgY29uc29sZS5sb2coJ+KchSBGaXJlYmFzZSBBZG1pbiBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgIFxuICAgICAgLy8gVGVzdCB0aGUgY29ubmVjdGlvbiBhc3luY2hyb25vdXNseVxuICAgICAgdGVzdEZpcmViYXNlQ29ubmVjdGlvbihhZG1pbkRiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWRtaW5EYiA9IGdldEZpcmVzdG9yZSgpO1xuICAgICAgY29uc29sZS5sb2coJ+KchSBGaXJlYmFzZSBBZG1pbiBhbHJlYWR5IGluaXRpYWxpemVkJyk7XG4gICAgfVxuICB9XG59IGNhdGNoIChlcnJvcikge1xuICBjb25zb2xlLmVycm9yKCfinYwgRmlyZWJhc2UgQWRtaW4gaW5pdGlhbGl6YXRpb24gZmFpbGVkOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSk7XG4gIGNvbnNvbGUubG9nKCfwn5qrIEZpcmViYXNlIEFkbWluIGRpc2FibGVkIC0gdXNpbmcgbW9jayBkYXRhIGZvciBkZXZlbG9wbWVudCcpO1xuICBhZG1pbkRiID0gbnVsbDtcbn1cblxuZXhwb3J0IHsgYWRtaW5EYiB9OyAiXSwibmFtZXMiOlsiaW5pdGlhbGl6ZUFwcCIsImdldEFwcHMiLCJjZXJ0IiwiZ2V0RmlyZXN0b3JlIiwiY29uc29sZSIsImxvZyIsImhhc1Byb2plY3RJZCIsInByb2Nlc3MiLCJlbnYiLCJGSVJFQkFTRV9QUk9KRUNUX0lEIiwiaGFzQ2xpZW50RW1haWwiLCJGSVJFQkFTRV9DTElFTlRfRU1BSUwiLCJoYXNQcml2YXRlS2V5IiwiRklSRUJBU0VfUFJJVkFURV9LRVkiLCJpc1ZhbGlkUHJpdmF0ZUtleSIsImluY2x1ZGVzIiwiaGFzVmFsaWRDcmVkZW50aWFscyIsInByaXZhdGVLZXlMZW5ndGgiLCJsZW5ndGgiLCJhZG1pbkRiIiwidGVzdEZpcmViYXNlQ29ubmVjdGlvbiIsImRiIiwiY29sbGVjdGlvbiIsImxpbWl0IiwiZ2V0IiwidGVzdEVycm9yIiwid2FybiIsIkVycm9yIiwibWVzc2FnZSIsIlN0cmluZyIsInByaXZhdGVLZXkiLCJzdGFydHNXaXRoIiwiZW5kc1dpdGgiLCJzbGljZSIsInJlcGxhY2UiLCJzZXJ2aWNlQWNjb3VudCIsInByb2plY3RJZCIsImNsaWVudEVtYWlsIiwiYXBwIiwiY3JlZGVudGlhbCIsImVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/firebase-admin.ts\n");

/***/ }),

/***/ "(api)/./lib/firebase.ts":
/*!*************************!*\
  !*** ./lib/firebase.ts ***!
  \*************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   db: () => (/* binding */ db)\n/* harmony export */ });\n/* harmony import */ var firebase_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/app */ \"firebase/app\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/firestore */ \"firebase/firestore\");\n/* harmony import */ var firebase_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! firebase/auth */ \"firebase/auth\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([firebase_app__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__, firebase_auth__WEBPACK_IMPORTED_MODULE_2__]);\n([firebase_app__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__, firebase_auth__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyBhg_QAiNn65doXbbD7f-a7Q7s5i0Rqm_k\",\n    authDomain: \"askitai.firebaseapp.com\",\n    projectId: \"askitai\",\n    storageBucket: \"askitai.firebasestorage.app\",\n    messagingSenderId: \"946988582968\",\n    appId: \"1:946988582968:web:6d6a97b69ab0a61169becd\"\n};\n// Initialize Firebase only if not already initialized\nconst app = (0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.getApps)().length === 0 ? (0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.initializeApp)(firebaseConfig) : (0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.getApps)()[0];\nconst db = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getFirestore)(app);\nconst auth = (0,firebase_auth__WEBPACK_IMPORTED_MODULE_2__.getAuth)(app);\nconsole.log(\"✅ Firebase client initialized with Auth\");\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvZmlyZWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0Q7QUFDSjtBQUNWO0FBRXhDLE1BQU1JLGlCQUFpQjtJQUNyQkMsUUFBUUMseUNBQXdDO0lBQ2hERyxZQUFZSCx5QkFBNEM7SUFDeERLLFdBQVdMLFNBQTJDO0lBQ3RETyxlQUFlUCw2QkFBK0M7SUFDOURTLG1CQUFtQlQsY0FBb0Q7SUFDdkVXLE9BQU9YLDJDQUF1QztBQUNoRDtBQUVBLHNEQUFzRDtBQUN0RCxNQUFNYSxNQUFNbEIscURBQU9BLEdBQUdtQixNQUFNLEtBQUssSUFBSXBCLDJEQUFhQSxDQUFDSSxrQkFBa0JILHFEQUFPQSxFQUFFLENBQUMsRUFBRTtBQUUxRSxNQUFNb0IsS0FBS25CLGdFQUFZQSxDQUFDaUIsS0FBSztBQUM3QixNQUFNRyxPQUFPbkIsc0RBQU9BLENBQUNnQixLQUFLO0FBRWpDSSxRQUFRQyxHQUFHLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hc3F1ZS1ib3QtcGxhdGZvcm0vLi9saWIvZmlyZWJhc2UudHM/NWQyMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbml0aWFsaXplQXBwLCBnZXRBcHBzIH0gZnJvbSAnZmlyZWJhc2UvYXBwJztcbmltcG9ydCB7IGdldEZpcmVzdG9yZSB9IGZyb20gJ2ZpcmViYXNlL2ZpcmVzdG9yZSc7XG5pbXBvcnQgeyBnZXRBdXRoIH0gZnJvbSAnZmlyZWJhc2UvYXV0aCc7XG5cbmNvbnN0IGZpcmViYXNlQ29uZmlnID0ge1xuICBhcGlLZXk6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX0FQSV9LRVksXG4gIGF1dGhEb21haW46IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX0FVVEhfRE9NQUlOLFxuICBwcm9qZWN0SWQ6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX1BST0pFQ1RfSUQsXG4gIHN0b3JhZ2VCdWNrZXQ6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX1NUT1JBR0VfQlVDS0VULFxuICBtZXNzYWdpbmdTZW5kZXJJZDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfRklSRUJBU0VfTUVTU0FHSU5HX1NFTkRFUl9JRCxcbiAgYXBwSWQ6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX0FQUF9JRCxcbn07XG5cbi8vIEluaXRpYWxpemUgRmlyZWJhc2Ugb25seSBpZiBub3QgYWxyZWFkeSBpbml0aWFsaXplZFxuY29uc3QgYXBwID0gZ2V0QXBwcygpLmxlbmd0aCA9PT0gMCA/IGluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpIDogZ2V0QXBwcygpWzBdO1xuXG5leHBvcnQgY29uc3QgZGIgPSBnZXRGaXJlc3RvcmUoYXBwKTtcbmV4cG9ydCBjb25zdCBhdXRoID0gZ2V0QXV0aChhcHApO1xuXG5jb25zb2xlLmxvZygn4pyFIEZpcmViYXNlIGNsaWVudCBpbml0aWFsaXplZCB3aXRoIEF1dGgnKTsgIl0sIm5hbWVzIjpbImluaXRpYWxpemVBcHAiLCJnZXRBcHBzIiwiZ2V0RmlyZXN0b3JlIiwiZ2V0QXV0aCIsImZpcmViYXNlQ29uZmlnIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0ZJUkVCQVNFX0FQSV9LRVkiLCJhdXRoRG9tYWluIiwiTkVYVF9QVUJMSUNfRklSRUJBU0VfQVVUSF9ET01BSU4iLCJwcm9qZWN0SWQiLCJORVhUX1BVQkxJQ19GSVJFQkFTRV9QUk9KRUNUX0lEIiwic3RvcmFnZUJ1Y2tldCIsIk5FWFRfUFVCTElDX0ZJUkVCQVNFX1NUT1JBR0VfQlVDS0VUIiwibWVzc2FnaW5nU2VuZGVySWQiLCJORVhUX1BVQkxJQ19GSVJFQkFTRV9NRVNTQUdJTkdfU0VOREVSX0lEIiwiYXBwSWQiLCJORVhUX1BVQkxJQ19GSVJFQkFTRV9BUFBfSUQiLCJhcHAiLCJsZW5ndGgiLCJkYiIsImF1dGgiLCJjb25zb2xlIiwibG9nIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/firebase.ts\n");

/***/ }),

/***/ "(api)/./pages/api/bots/by-owner/[ownerId].ts":
/*!**********************************************!*\
  !*** ./pages/api/bots/by-owner/[ownerId].ts ***!
  \**********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _lib_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/database */ \"(api)/./lib/database/index.ts\");\n/* harmony import */ var _lib_auth_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth/server */ \"(api)/./lib/auth/server.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_database__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst handler = async (req, res)=>{\n    const { ownerId } = req.query;\n    const authenticatedUserId = req.user.uid;\n    const userPhoneNumber = req.user.phoneNumber;\n    // Ensure user can only access their own bots\n    if (!ownerId || typeof ownerId !== \"string\") {\n        return res.status(400).json({\n            success: false,\n            error: \"Owner ID is required\",\n            timestamp: new Date()\n        });\n    }\n    if (ownerId !== authenticatedUserId) {\n        return res.status(403).json({\n            success: false,\n            error: \"Access denied: You can only access your own bots\",\n            timestamp: new Date()\n        });\n    }\n    if (req.method !== \"GET\") {\n        return res.status(405).json({\n            success: false,\n            error: \"Method not allowed\",\n            timestamp: new Date()\n        });\n    }\n    try {\n        console.log(\"\\uD83D\\uDCCB Fetching bots for authenticated user:\", authenticatedUserId);\n        console.log(\"\\uD83D\\uDCF1 User phone number:\", userPhoneNumber);\n        // Use the enhanced method that includes phone number fallback\n        const bots = await _lib_database__WEBPACK_IMPORTED_MODULE_0__.serverDb.getBotsByOwnerWithFallback(authenticatedUserId, userPhoneNumber);\n        console.log(\"✅ Found bots:\", bots.length);\n        return res.status(200).json({\n            success: true,\n            data: bots,\n            timestamp: new Date()\n        });\n    } catch (error) {\n        console.error(\"❌ Error fetching bots by owner:\", error);\n        // Return empty array instead of error to prevent loading issues\n        return res.status(200).json({\n            success: true,\n            data: [],\n            timestamp: new Date()\n        });\n    }\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_auth_server__WEBPACK_IMPORTED_MODULE_1__.withAuth)(handler));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYm90cy9ieS1vd25lci9bb3duZXJJZF0udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBRTBDO0FBQ3lCO0FBTW5FLE1BQU1FLFVBQVUsT0FDZEMsS0FDQUM7SUFFQSxNQUFNLEVBQUVDLE9BQU8sRUFBRSxHQUFHRixJQUFJRyxLQUFLO0lBQzdCLE1BQU1DLHNCQUFzQkosSUFBSUssSUFBSSxDQUFDQyxHQUFHO0lBQ3hDLE1BQU1DLGtCQUFrQlAsSUFBSUssSUFBSSxDQUFDRyxXQUFXO0lBRTVDLDZDQUE2QztJQUM3QyxJQUFJLENBQUNOLFdBQVcsT0FBT0EsWUFBWSxVQUFVO1FBQzNDLE9BQU9ELElBQUlRLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDMUJDLFNBQVM7WUFDVEMsT0FBTztZQUNQQyxXQUFXLElBQUlDO1FBQ2pCO0lBQ0Y7SUFFQSxJQUFJWixZQUFZRSxxQkFBcUI7UUFDbkMsT0FBT0gsSUFBSVEsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQkMsU0FBUztZQUNUQyxPQUFPO1lBQ1BDLFdBQVcsSUFBSUM7UUFDakI7SUFDRjtJQUVBLElBQUlkLElBQUllLE1BQU0sS0FBSyxPQUFPO1FBQ3hCLE9BQU9kLElBQUlRLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDMUJDLFNBQVM7WUFDVEMsT0FBTztZQUNQQyxXQUFXLElBQUlDO1FBQ2pCO0lBQ0Y7SUFFQSxJQUFJO1FBQ0ZFLFFBQVFDLEdBQUcsQ0FBQyxzREFBNENiO1FBQ3hEWSxRQUFRQyxHQUFHLENBQUMsbUNBQXlCVjtRQUVyQyw4REFBOEQ7UUFDOUQsTUFBTVcsT0FBTyxNQUFNckIsbURBQVFBLENBQUNzQiwwQkFBMEIsQ0FBQ2YscUJBQXFCRztRQUU1RVMsUUFBUUMsR0FBRyxDQUFDLGlCQUFpQkMsS0FBS0UsTUFBTTtRQUV4QyxPQUFPbkIsSUFBSVEsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQkMsU0FBUztZQUNUVSxNQUFNSDtZQUNOTCxXQUFXLElBQUlDO1FBQ2pCO0lBRUYsRUFBRSxPQUFPRixPQUFPO1FBQ2RJLFFBQVFKLEtBQUssQ0FBQyxtQ0FBbUNBO1FBQ2pELGdFQUFnRTtRQUNoRSxPQUFPWCxJQUFJUSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCQyxTQUFTO1lBQ1RVLE1BQU0sRUFBRTtZQUNSUixXQUFXLElBQUlDO1FBQ2pCO0lBQ0Y7QUFDRjtBQUVBLGlFQUFlaEIsMERBQVFBLENBQUNDLFFBQVFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hc3F1ZS1ib3QtcGxhdGZvcm0vLi9wYWdlcy9hcGkvYm90cy9ieS1vd25lci9bb3duZXJJZF0udHM/N2FkNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IEJvdCwgQXBpUmVzcG9uc2UgfSBmcm9tICdAL3R5cGVzJztcbmltcG9ydCB7IHNlcnZlckRiIH0gZnJvbSAnQC9saWIvZGF0YWJhc2UnO1xuaW1wb3J0IHsgd2l0aEF1dGgsIEF1dGhlbnRpY2F0ZWRSZXF1ZXN0IH0gZnJvbSAnQC9saWIvYXV0aC9zZXJ2ZXInO1xuXG5pbnRlcmZhY2UgQm90c1Jlc3BvbnNlIGV4dGVuZHMgQXBpUmVzcG9uc2Uge1xuICBkYXRhPzogQm90W107XG59XG5cbmNvbnN0IGhhbmRsZXIgPSBhc3luYyAoXG4gIHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlPEJvdHNSZXNwb25zZT5cbikgPT4ge1xuICBjb25zdCB7IG93bmVySWQgfSA9IHJlcS5xdWVyeTtcbiAgY29uc3QgYXV0aGVudGljYXRlZFVzZXJJZCA9IHJlcS51c2VyLnVpZDtcbiAgY29uc3QgdXNlclBob25lTnVtYmVyID0gcmVxLnVzZXIucGhvbmVOdW1iZXI7XG5cbiAgLy8gRW5zdXJlIHVzZXIgY2FuIG9ubHkgYWNjZXNzIHRoZWlyIG93biBib3RzXG4gIGlmICghb3duZXJJZCB8fCB0eXBlb2Ygb3duZXJJZCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ093bmVyIElEIGlzIHJlcXVpcmVkJyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKG93bmVySWQgIT09IGF1dGhlbnRpY2F0ZWRVc2VySWQpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0FjY2VzcyBkZW5pZWQ6IFlvdSBjYW4gb25seSBhY2Nlc3MgeW91ciBvd24gYm90cycsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChyZXEubWV0aG9kICE9PSAnR0VUJykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygn8J+TiyBGZXRjaGluZyBib3RzIGZvciBhdXRoZW50aWNhdGVkIHVzZXI6JywgYXV0aGVudGljYXRlZFVzZXJJZCk7XG4gICAgY29uc29sZS5sb2coJ/Cfk7EgVXNlciBwaG9uZSBudW1iZXI6JywgdXNlclBob25lTnVtYmVyKTtcbiAgICBcbiAgICAvLyBVc2UgdGhlIGVuaGFuY2VkIG1ldGhvZCB0aGF0IGluY2x1ZGVzIHBob25lIG51bWJlciBmYWxsYmFja1xuICAgIGNvbnN0IGJvdHMgPSBhd2FpdCBzZXJ2ZXJEYi5nZXRCb3RzQnlPd25lcldpdGhGYWxsYmFjayhhdXRoZW50aWNhdGVkVXNlcklkLCB1c2VyUGhvbmVOdW1iZXIpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCfinIUgRm91bmQgYm90czonLCBib3RzLmxlbmd0aCk7XG4gICAgXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBib3RzLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgYm90cyBieSBvd25lcjonLCBlcnJvcik7XG4gICAgLy8gUmV0dXJuIGVtcHR5IGFycmF5IGluc3RlYWQgb2YgZXJyb3IgdG8gcHJldmVudCBsb2FkaW5nIGlzc3Vlc1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogW10sXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICB9KTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgd2l0aEF1dGgoaGFuZGxlcik7ICJdLCJuYW1lcyI6WyJzZXJ2ZXJEYiIsIndpdGhBdXRoIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm93bmVySWQiLCJxdWVyeSIsImF1dGhlbnRpY2F0ZWRVc2VySWQiLCJ1c2VyIiwidWlkIiwidXNlclBob25lTnVtYmVyIiwicGhvbmVOdW1iZXIiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwidGltZXN0YW1wIiwiRGF0ZSIsIm1ldGhvZCIsImNvbnNvbGUiLCJsb2ciLCJib3RzIiwiZ2V0Qm90c0J5T3duZXJXaXRoRmFsbGJhY2siLCJsZW5ndGgiLCJkYXRhIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/bots/by-owner/[ownerId].ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbots%2Fby-owner%2F%5BownerId%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fbots%2Fby-owner%2F%5BownerId%5D.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();