"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chats";
exports.ids = ["pages/api/chats"];
exports.modules = {

/***/ "firebase-admin/app":
/*!*************************************!*\
  !*** external "firebase-admin/app" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("firebase-admin/app");

/***/ }),

/***/ "firebase-admin/auth":
/*!**************************************!*\
  !*** external "firebase-admin/auth" ***!
  \**************************************/
/***/ ((module) => {

module.exports = require("firebase-admin/auth");

/***/ }),

/***/ "firebase-admin/firestore":
/*!*******************************************!*\
  !*** external "firebase-admin/firestore" ***!
  \*******************************************/
/***/ ((module) => {

module.exports = require("firebase-admin/firestore");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "firebase/app":
/*!*******************************!*\
  !*** external "firebase/app" ***!
  \*******************************/
/***/ ((module) => {

module.exports = import("firebase/app");;

/***/ }),

/***/ "firebase/auth":
/*!********************************!*\
  !*** external "firebase/auth" ***!
  \********************************/
/***/ ((module) => {

module.exports = import("firebase/auth");;

/***/ }),

/***/ "firebase/firestore":
/*!*************************************!*\
  !*** external "firebase/firestore" ***!
  \*************************************/
/***/ ((module) => {

module.exports = import("firebase/firestore");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchats&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchats%2Findex.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchats&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchats%2Findex.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_chats_index_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/chats/index.ts */ \"(api)/./pages/api/chats/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_chats_index_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_chats_index_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chats_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chats_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/chats\",\n        pathname: \"/api/chats\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_chats_index_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNoYXRzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlMkZhcGklMkZjaGF0cyUyRmluZGV4LnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ3VEO0FBQ3ZEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxzREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsc0RBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXNxdWUtYm90LXBsYXRmb3JtLz9mZGExIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvY2hhdHMvaW5kZXgudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jaGF0c1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NoYXRzXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchats&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchats%2Findex.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/auth/server.ts":
/*!****************************!*\
  !*** ./lib/auth/server.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authenticateRequest: () => (/* binding */ authenticateRequest),\n/* harmony export */   verifyAuthToken: () => (/* binding */ verifyAuthToken),\n/* harmony export */   verifyBotOwnership: () => (/* binding */ verifyBotOwnership),\n/* harmony export */   withAuth: () => (/* binding */ withAuth),\n/* harmony export */   withBotOwnership: () => (/* binding */ withBotOwnership)\n/* harmony export */ });\n/* harmony import */ var firebase_admin_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase-admin/auth */ \"firebase-admin/auth\");\n/* harmony import */ var firebase_admin_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(firebase_admin_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase-admin/app */ \"firebase-admin/app\");\n/* harmony import */ var firebase_admin_app__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__);\n\n\n// Initialize Firebase Admin if not already initialized\nif (!(0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__.getApps)().length) {\n    const privateKey = process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\");\n    if (process.env.FIREBASE_PROJECT_ID && process.env.FIREBASE_CLIENT_EMAIL && privateKey) {\n        (0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__.initializeApp)({\n            credential: (0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__.cert)({\n                projectId: process.env.FIREBASE_PROJECT_ID,\n                clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\n                privateKey: privateKey\n            })\n        });\n        console.log(\"\\uD83D\\uDD25 Firebase Admin initialized\");\n    } else {\n        console.warn(\"⚠️ Firebase Admin not initialized - missing environment variables\");\n    }\n}\n// Extract auth token from request headers\nconst getAuthToken = (req)=>{\n    const authHeader = req.headers.authorization;\n    if (authHeader && authHeader.startsWith(\"Bearer \")) {\n        return authHeader.substring(7);\n    }\n    // Also check for token in cookies (for browser requests)\n    const tokenFromCookie = req.cookies[\"auth-token\"];\n    if (tokenFromCookie) {\n        return tokenFromCookie;\n    }\n    return null;\n};\n// Verify Firebase auth token and return user info\nconst verifyAuthToken = async (token)=>{\n    try {\n        // In development mode, if Firebase is not configured, allow test tokens\n        if ( true && !(0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_1__.getApps)().length) {\n            console.log(\"\\uD83D\\uDD27 Development mode: Using test authentication\");\n            // Allow test tokens for development\n            if (token === \"test-token\") {\n                return {\n                    uid: \"JxNSv886lwN8CYMdqAityIbtFA43\",\n                    email: \"test@example.com\",\n                    phoneNumber: \"+911234567890\"\n                };\n            }\n            // Allow any token that starts with 'dev-'\n            if (token.startsWith(\"dev-\")) {\n                const uid = token.replace(\"dev-\", \"\");\n                return {\n                    uid,\n                    email: `${uid}@example.com`,\n                    phoneNumber: \"+911234567890\"\n                };\n            }\n        }\n        const auth = (0,firebase_admin_auth__WEBPACK_IMPORTED_MODULE_0__.getAuth)();\n        const decodedToken = await auth.verifyIdToken(token);\n        return {\n            uid: decodedToken.uid,\n            email: decodedToken.email,\n            phoneNumber: decodedToken.phone_number\n        };\n    } catch (error) {\n        console.error(\"❌ Token verification failed:\", error);\n        throw new Error(\"Invalid authentication token\");\n    }\n};\n// Middleware function to authenticate API requests\nconst authenticateRequest = async (req, res)=>{\n    try {\n        const token = getAuthToken(req);\n        if (!token) {\n            res.status(401).json({\n                success: false,\n                error: \"Authentication required\",\n                timestamp: new Date()\n            });\n            return null;\n        }\n        const user = await verifyAuthToken(token);\n        return user;\n    } catch (error) {\n        console.error(\"❌ Authentication error:\", error);\n        res.status(401).json({\n            success: false,\n            error: \"Invalid authentication credentials\",\n            timestamp: new Date()\n        });\n        return null;\n    }\n};\n// Higher-order function to wrap API handlers with authentication\nconst withAuth = (handler)=>{\n    return async (req, res)=>{\n        const user = await authenticateRequest(req, res);\n        if (!user) {\n            // Response already sent by authenticateRequest\n            return;\n        }\n        // Add user to request object\n        req.user = user;\n        // Call the original handler\n        return handler(req, res);\n    };\n};\n// Verify bot ownership (now with phone number fallback)\nconst verifyBotOwnership = async (botId, userId, userPhoneNumber)=>{\n    try {\n        // Import here to avoid circular dependency\n        const { serverDb } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @/lib/database */ \"(api)/./lib/database/index.ts\"));\n        const bot = await serverDb.getBot(botId);\n        if (!bot) {\n            return false;\n        }\n        // Direct ownership check\n        if (bot.ownerId === userId) {\n            return true;\n        }\n        // Phone number fallback\n        if (userPhoneNumber && bot.ownerPhoneNumber === userPhoneNumber) {\n            console.log(\"✅ Bot ownership verified via phone number fallback\");\n            // Update the bot's ownerId for future consistency\n            bot.ownerId = userId;\n            await serverDb.updateBot(bot);\n            return true;\n        }\n        return false;\n    } catch (error) {\n        console.error(\"❌ Error verifying bot ownership:\", error);\n        return false;\n    }\n};\n// Middleware to verify bot ownership for bot-specific operations\nconst withBotOwnership = (handler)=>{\n    return withAuth(async (req, res)=>{\n        const { botId } = req.query;\n        if (!botId || typeof botId !== \"string\") {\n            return res.status(400).json({\n                success: false,\n                error: \"Bot ID is required\",\n                timestamp: new Date()\n            });\n        }\n        const isOwner = await verifyBotOwnership(botId, req.user.uid, req.user.phoneNumber);\n        if (!isOwner) {\n            return res.status(403).json({\n                success: false,\n                error: \"Access denied: You do not own this bot\",\n                timestamp: new Date()\n            });\n        }\n        return handler(req, res);\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VixJQUFJQyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsU0FBUztnQkFDVE4sT0FBTztnQkFDUE8sV0FBVyxJQUFJQztZQUNqQjtRQUNGO1FBRUEsTUFBTWdCLFVBQVUsTUFBTVosbUJBQW1CQyxPQUFPOUIsSUFBSTBCLElBQUksQ0FBQ2hCLEdBQUcsRUFBRVYsSUFBSTBCLElBQUksQ0FBQ2QsV0FBVztRQUVsRixJQUFJLENBQUM2QixTQUFTO1lBQ1osT0FBT3JCLElBQUlDLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQzFCQyxTQUFTO2dCQUNUTixPQUFPO2dCQUNQTyxXQUFXLElBQUlDO1lBQ2pCO1FBQ0Y7UUFFQSxPQUFPRyxRQUFRNUIsS0FBS29CO0lBQ3RCO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2FzcXVlLWJvdC1wbGF0Zm9ybS8uL2xpYi9hdXRoL3NlcnZlci50cz85MjYyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IGdldEF1dGggfSBmcm9tICdmaXJlYmFzZS1hZG1pbi9hdXRoJztcbmltcG9ydCB7IGluaXRpYWxpemVBcHAsIGdldEFwcHMsIGNlcnQgfSBmcm9tICdmaXJlYmFzZS1hZG1pbi9hcHAnO1xuXG4vLyBJbml0aWFsaXplIEZpcmViYXNlIEFkbWluIGlmIG5vdCBhbHJlYWR5IGluaXRpYWxpemVkXG5pZiAoIWdldEFwcHMoKS5sZW5ndGgpIHtcbiAgY29uc3QgcHJpdmF0ZUtleSA9IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BSSVZBVEVfS0VZPy5yZXBsYWNlKC9cXFxcbi9nLCAnXFxuJyk7XG4gIFxuICBpZiAocHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJPSkVDVF9JRCAmJiBwcm9jZXNzLmVudi5GSVJFQkFTRV9DTElFTlRfRU1BSUwgJiYgcHJpdmF0ZUtleSkge1xuICAgIGluaXRpYWxpemVBcHAoe1xuICAgICAgY3JlZGVudGlhbDogY2VydCh7XG4gICAgICAgIHByb2plY3RJZDogcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJPSkVDVF9JRCxcbiAgICAgICAgY2xpZW50RW1haWw6IHByb2Nlc3MuZW52LkZJUkVCQVNFX0NMSUVOVF9FTUFJTCxcbiAgICAgICAgcHJpdmF0ZUtleTogcHJpdmF0ZUtleSxcbiAgICAgIH0pLFxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKCfwn5SlIEZpcmViYXNlIEFkbWluIGluaXRpYWxpemVkJyk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKCfimqDvuI8gRmlyZWJhc2UgQWRtaW4gbm90IGluaXRpYWxpemVkIC0gbWlzc2luZyBlbnZpcm9ubWVudCB2YXJpYWJsZXMnKTtcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhlbnRpY2F0ZWRVc2VyIHtcbiAgdWlkOiBzdHJpbmc7XG4gIGVtYWlsPzogc3RyaW5nO1xuICBwaG9uZU51bWJlcj86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdXRoZW50aWNhdGVkUmVxdWVzdCBleHRlbmRzIE5leHRBcGlSZXF1ZXN0IHtcbiAgdXNlcjogQXV0aGVudGljYXRlZFVzZXI7XG59XG5cbi8vIEV4dHJhY3QgYXV0aCB0b2tlbiBmcm9tIHJlcXVlc3QgaGVhZGVyc1xuY29uc3QgZ2V0QXV0aFRva2VuID0gKHJlcTogTmV4dEFwaVJlcXVlc3QpOiBzdHJpbmcgfCBudWxsID0+IHtcbiAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XG4gIFxuICBpZiAoYXV0aEhlYWRlciAmJiBhdXRoSGVhZGVyLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xuICAgIHJldHVybiBhdXRoSGVhZGVyLnN1YnN0cmluZyg3KTtcbiAgfVxuICBcbiAgLy8gQWxzbyBjaGVjayBmb3IgdG9rZW4gaW4gY29va2llcyAoZm9yIGJyb3dzZXIgcmVxdWVzdHMpXG4gIGNvbnN0IHRva2VuRnJvbUNvb2tpZSA9IHJlcS5jb29raWVzWydhdXRoLXRva2VuJ107XG4gIGlmICh0b2tlbkZyb21Db29raWUpIHtcbiAgICByZXR1cm4gdG9rZW5Gcm9tQ29va2llO1xuICB9XG4gIFxuICByZXR1cm4gbnVsbDtcbn07XG5cbi8vIFZlcmlmeSBGaXJlYmFzZSBhdXRoIHRva2VuIGFuZCByZXR1cm4gdXNlciBpbmZvXG5leHBvcnQgY29uc3QgdmVyaWZ5QXV0aFRva2VuID0gYXN5bmMgKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPEF1dGhlbnRpY2F0ZWRVc2VyPiA9PiB7XG4gIHRyeSB7XG4gICAgLy8gSW4gZGV2ZWxvcG1lbnQgbW9kZSwgaWYgRmlyZWJhc2UgaXMgbm90IGNvbmZpZ3VyZWQsIGFsbG93IHRlc3QgdG9rZW5zXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnICYmICFnZXRBcHBzKCkubGVuZ3RoKSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+UpyBEZXZlbG9wbWVudCBtb2RlOiBVc2luZyB0ZXN0IGF1dGhlbnRpY2F0aW9uJyk7XG4gICAgICBcbiAgICAgIC8vIEFsbG93IHRlc3QgdG9rZW5zIGZvciBkZXZlbG9wbWVudFxuICAgICAgaWYgKHRva2VuID09PSAndGVzdC10b2tlbicpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1aWQ6ICdKeE5Tdjg4Nmx3TjhDWU1kcUFpdHlJYnRGQTQzJywgLy8gVXNlIHRoZSBleGlzdGluZyB1c2VyIElEIGZyb20gbW9jayBkYXRhXG4gICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBwaG9uZU51bWJlcjogJys5MTEyMzQ1Njc4OTAnLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBbGxvdyBhbnkgdG9rZW4gdGhhdCBzdGFydHMgd2l0aCAnZGV2LSdcbiAgICAgIGlmICh0b2tlbi5zdGFydHNXaXRoKCdkZXYtJykpIHtcbiAgICAgICAgY29uc3QgdWlkID0gdG9rZW4ucmVwbGFjZSgnZGV2LScsICcnKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1aWQsXG4gICAgICAgICAgZW1haWw6IGAke3VpZH1AZXhhbXBsZS5jb21gLFxuICAgICAgICAgIHBob25lTnVtYmVyOiAnKzkxMTIzNDU2Nzg5MCcsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGF1dGggPSBnZXRBdXRoKCk7XG4gICAgY29uc3QgZGVjb2RlZFRva2VuID0gYXdhaXQgYXV0aC52ZXJpZnlJZFRva2VuKHRva2VuKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdWlkOiBkZWNvZGVkVG9rZW4udWlkLFxuICAgICAgZW1haWw6IGRlY29kZWRUb2tlbi5lbWFpbCxcbiAgICAgIHBob25lTnVtYmVyOiBkZWNvZGVkVG9rZW4ucGhvbmVfbnVtYmVyLFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIFRva2VuIHZlcmlmaWNhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhdXRoZW50aWNhdGlvbiB0b2tlbicpO1xuICB9XG59O1xuXG4vLyBNaWRkbGV3YXJlIGZ1bmN0aW9uIHRvIGF1dGhlbnRpY2F0ZSBBUEkgcmVxdWVzdHNcbmV4cG9ydCBjb25zdCBhdXRoZW50aWNhdGVSZXF1ZXN0ID0gYXN5bmMgKFxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxuICByZXM6IE5leHRBcGlSZXNwb25zZVxuKTogUHJvbWlzZTxBdXRoZW50aWNhdGVkVXNlciB8IG51bGw+ID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB0b2tlbiA9IGdldEF1dGhUb2tlbihyZXEpO1xuICAgIFxuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB2ZXJpZnlBdXRoVG9rZW4odG9rZW4pO1xuICAgIHJldHVybiB1c2VyO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBBdXRoZW50aWNhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0ludmFsaWQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgfSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cbi8vIEhpZ2hlci1vcmRlciBmdW5jdGlvbiB0byB3cmFwIEFQSSBoYW5kbGVycyB3aXRoIGF1dGhlbnRpY2F0aW9uXG5leHBvcnQgY29uc3Qgd2l0aEF1dGggPSAoXG4gIGhhbmRsZXI6IChyZXE6IEF1dGhlbnRpY2F0ZWRSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkgPT4gUHJvbWlzZTx2b2lkPlxuKSA9PiB7XG4gIHJldHVybiBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aGVudGljYXRlUmVxdWVzdChyZXEsIHJlcyk7XG4gICAgXG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICAvLyBSZXNwb25zZSBhbHJlYWR5IHNlbnQgYnkgYXV0aGVudGljYXRlUmVxdWVzdFxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgdXNlciB0byByZXF1ZXN0IG9iamVjdFxuICAgIChyZXEgYXMgQXV0aGVudGljYXRlZFJlcXVlc3QpLnVzZXIgPSB1c2VyO1xuICAgIFxuICAgIC8vIENhbGwgdGhlIG9yaWdpbmFsIGhhbmRsZXJcbiAgICByZXR1cm4gaGFuZGxlcihyZXEgYXMgQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlcyk7XG4gIH07XG59O1xuXG4vLyBWZXJpZnkgYm90IG93bmVyc2hpcCAobm93IHdpdGggcGhvbmUgbnVtYmVyIGZhbGxiYWNrKVxuZXhwb3J0IGNvbnN0IHZlcmlmeUJvdE93bmVyc2hpcCA9IGFzeW5jIChcbiAgYm90SWQ6IHN0cmluZyxcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHVzZXJQaG9uZU51bWJlcj86IHN0cmluZ1xuKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gIHRyeSB7XG4gICAgLy8gSW1wb3J0IGhlcmUgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jeVxuICAgIGNvbnN0IHsgc2VydmVyRGIgfSA9IGF3YWl0IGltcG9ydCgnQC9saWIvZGF0YWJhc2UnKTtcbiAgICBjb25zdCBib3QgPSBhd2FpdCBzZXJ2ZXJEYi5nZXRCb3QoYm90SWQpO1xuICAgIFxuICAgIGlmICghYm90KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIERpcmVjdCBvd25lcnNoaXAgY2hlY2tcbiAgICBpZiAoYm90Lm93bmVySWQgPT09IHVzZXJJZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIFxuICAgIC8vIFBob25lIG51bWJlciBmYWxsYmFja1xuICAgIGlmICh1c2VyUGhvbmVOdW1iZXIgJiYgYm90Lm93bmVyUGhvbmVOdW1iZXIgPT09IHVzZXJQaG9uZU51bWJlcikge1xuICAgICAgY29uc29sZS5sb2coJ+KchSBCb3Qgb3duZXJzaGlwIHZlcmlmaWVkIHZpYSBwaG9uZSBudW1iZXIgZmFsbGJhY2snKTtcbiAgICAgIC8vIFVwZGF0ZSB0aGUgYm90J3Mgb3duZXJJZCBmb3IgZnV0dXJlIGNvbnNpc3RlbmN5XG4gICAgICBib3Qub3duZXJJZCA9IHVzZXJJZDtcbiAgICAgIGF3YWl0IHNlcnZlckRiLnVwZGF0ZUJvdChib3QpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBmYWxzZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdmVyaWZ5aW5nIGJvdCBvd25lcnNoaXA6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuLy8gTWlkZGxld2FyZSB0byB2ZXJpZnkgYm90IG93bmVyc2hpcCBmb3IgYm90LXNwZWNpZmljIG9wZXJhdGlvbnNcbmV4cG9ydCBjb25zdCB3aXRoQm90T3duZXJzaGlwID0gKFxuICBoYW5kbGVyOiAocmVxOiBBdXRoZW50aWNhdGVkUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IFByb21pc2U8dm9pZD5cbikgPT4ge1xuICByZXR1cm4gd2l0aEF1dGgoYXN5bmMgKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiB7XG4gICAgY29uc3QgeyBib3RJZCB9ID0gcmVxLnF1ZXJ5O1xuICAgIFxuICAgIGlmICghYm90SWQgfHwgdHlwZW9mIGJvdElkICE9PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQm90IElEIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgaXNPd25lciA9IGF3YWl0IHZlcmlmeUJvdE93bmVyc2hpcChib3RJZCwgcmVxLnVzZXIudWlkLCByZXEudXNlci5waG9uZU51bWJlcik7XG4gICAgXG4gICAgaWYgKCFpc093bmVyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdBY2Nlc3MgZGVuaWVkOiBZb3UgZG8gbm90IG93biB0aGlzIGJvdCcsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzKTtcbiAgfSk7XG59OyAiXSwibmFtZXMiOlsiZ2V0QXV0aCIsImluaXRpYWxpemVBcHAiLCJnZXRBcHBzIiwiY2VydCIsImxlbmd0aCIsInByaXZhdGVLZXkiLCJwcm9jZXNzIiwiZW52IiwiRklSRUJBU0VfUFJJVkFURV9LRVkiLCJyZXBsYWNlIiwiRklSRUJBU0VfUFJPSkVDVF9JRCIsIkZJUkVCQVNFX0NMSUVOVF9FTUFJTCIsImNyZWRlbnRpYWwiLCJwcm9qZWN0SWQiLCJjbGllbnRFbWFpbCIsImNvbnNvbGUiLCJsb2ciLCJ3YXJuIiwiZ2V0QXV0aFRva2VuIiwicmVxIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3RhcnRzV2l0aCIsInN1YnN0cmluZyIsInRva2VuRnJvbUNvb2tpZSIsImNvb2tpZXMiLCJ2ZXJpZnlBdXRoVG9rZW4iLCJ0b2tlbiIsInVpZCIsImVtYWlsIiwicGhvbmVOdW1iZXIiLCJhdXRoIiwiZGVjb2RlZFRva2VuIiwidmVyaWZ5SWRUb2tlbiIsInBob25lX251bWJlciIsImVycm9yIiwiRXJyb3IiLCJhdXRoZW50aWNhdGVSZXF1ZXN0IiwicmVzIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidXNlciIsIndpdGhBdXRoIiwiaGFuZGxlciIsInZlcmlmeUJvdE93bmVyc2hpcCIsImJvdElkIiwidXNlcklkIiwidXNlclBob25lTnVtYmVyIiwic2VydmVyRGIiLCJib3QiLCJnZXRCb3QiLCJvd25lcklkIiwib3duZXJQaG9uZU51bWJlciIsInVwZGF0ZUJvdCIsIndpdGhCb3RPd25lcnNoaXAiLCJxdWVyeSIsImlzT3duZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/auth/server.ts\n");

/***/ }),

/***/ "(api)/./lib/database/index.ts":
/*!*******************************!*\
  !*** ./lib/database/index.ts ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   clientDb: () => (/* binding */ clientDb),\n/* harmony export */   serverDb: () => (/* binding */ serverDb)\n/* harmony export */ });\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/firestore */ \"firebase/firestore\");\n/* harmony import */ var _lib_firebase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/firebase */ \"(api)/./lib/firebase.ts\");\n/* harmony import */ var _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/firebase-admin */ \"(api)/./lib/firebase-admin.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([firebase_firestore__WEBPACK_IMPORTED_MODULE_0__, _lib_firebase__WEBPACK_IMPORTED_MODULE_1__]);\n([firebase_firestore__WEBPACK_IMPORTED_MODULE_0__, _lib_firebase__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n// Helper function to calculate analytics\nconst calculateAnalytics = (sessions)=>{\n    const totalVisitors = sessions.length;\n    const totalChats = sessions.reduce((sum, session)=>sum + session.messageCount, 0);\n    const totalMessages = sessions.reduce((sum, session)=>sum + session.messages.length, 0);\n    const averageResponseTime = sessions.length > 0 ? sessions.reduce((sum, session)=>sum + (session.averageResponseTime || 0), 0) / sessions.length : 0;\n    const successfulResponses = sessions.reduce((sum, session)=>sum + session.successfulResponses, 0);\n    const failedQuestions = sessions.reduce((sum, session)=>sum + session.failedQuestions, 0);\n    return {\n        totalVisitors,\n        totalChats,\n        totalMessages,\n        averageResponseTime,\n        successfulResponses,\n        failedQuestions,\n        successRate: totalMessages > 0 ? successfulResponses / totalMessages * 100 : 0,\n        dailyVisitors: [],\n        weeklyChats: [],\n        topQuestions: [],\n        responseTimeHistory: []\n    };\n};\n// Client-side database operations (for frontend)\nconst clientDb = {\n    // Get bot data\n    async getBot (botId) {\n        try {\n            const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, \"bots\", botId);\n            const docSnap = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(docRef);\n            if (docSnap.exists()) {\n                return {\n                    id: docSnap.id,\n                    ...docSnap.data()\n                };\n            }\n            return null;\n        } catch (error) {\n            console.error(\"Error fetching bot:\", error);\n            return null;\n        }\n    },\n    // Add chat session\n    async addChatSession (sessionData) {\n        try {\n            const docRef = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.addDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, \"chatSessions\"), sessionData);\n            return docRef.id;\n        } catch (error) {\n            console.error(\"Error adding chat session:\", error);\n            return null;\n        }\n    }\n};\n// Server-side database operations (for API routes)\nconst serverDb = {\n    // Get bot by ID\n    async getBot (botId) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            const docRef = _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").doc(botId);\n            const docSnap = await docRef.get();\n            if (docSnap.exists) {\n                return {\n                    id: docSnap.id,\n                    ...docSnap.data()\n                };\n            }\n            return null;\n        } catch (error) {\n            console.error(\"Error fetching bot from Firebase:\", error);\n            return null;\n        }\n    },\n    // Get bot with analytics\n    async getBotWithAnalytics (botId) {\n        const bot = await this.getBot(botId);\n        if (!bot) return null;\n        const sessions = await this.getChatSessionsByBot(botId);\n        bot.analytics = calculateAnalytics(sessions);\n        return bot;\n    },\n    // Create new bot\n    async createBot (botData) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            const cleanBotData = {\n                ...botData,\n                description: botData.description || \"\",\n                deployedAt: botData.deployedAt || null,\n                profilePictureUrl: botData.profilePictureUrl || null,\n                welcomeMessage: botData.welcomeMessage || null\n            };\n            await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").doc(botData.id).set(cleanBotData);\n            return botData;\n        } catch (error) {\n            console.error(\"Error saving bot to Firebase:\", error);\n            throw error;\n        }\n    },\n    // Update bot\n    async updateBot (botData) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            const cleanBotData = {\n                ...botData,\n                description: botData.description || \"\",\n                deployedAt: botData.deployedAt || null,\n                profilePictureUrl: botData.profilePictureUrl || null,\n                welcomeMessage: botData.welcomeMessage || null\n            };\n            await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").doc(botData.id).set(cleanBotData);\n            return botData;\n        } catch (error) {\n            console.error(\"Error updating bot in Firebase:\", error);\n            throw error;\n        }\n    },\n    // Get bots by owner ID\n    async getBotsByOwner (ownerId) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            const querySnapshot = await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").where(\"ownerId\", \"==\", ownerId).orderBy(\"createdAt\", \"desc\").get();\n            const firebaseBots = [];\n            querySnapshot.forEach((doc)=>{\n                firebaseBots.push({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            });\n            return firebaseBots;\n        } catch (error) {\n            console.error(\"Error fetching bots by owner from Firebase:\", error);\n            return [];\n        }\n    },\n    // Get bots by phone number\n    async getBotsByPhoneNumber (phoneNumber) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            const querySnapshot = await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").where(\"ownerPhoneNumber\", \"==\", phoneNumber).orderBy(\"createdAt\", \"desc\").get();\n            const firebaseBots = [];\n            querySnapshot.forEach((doc)=>{\n                firebaseBots.push({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            });\n            return firebaseBots;\n        } catch (error) {\n            console.error(\"Error fetching bots by phone from Firebase:\", error);\n            return [];\n        }\n    },\n    // Enhanced getBotsByOwner that also checks phone number as fallback\n    async getBotsByOwnerWithFallback (ownerId, phoneNumber) {\n        let bots = await this.getBotsByOwner(ownerId);\n        if (bots.length === 0 && phoneNumber) {\n            const phoneBots = await this.getBotsByPhoneNumber(phoneNumber);\n            if (phoneBots.length > 0) {\n                for (const bot of phoneBots){\n                    bot.ownerId = ownerId;\n                    await this.updateBot(bot);\n                }\n                bots = phoneBots;\n            }\n        }\n        return bots;\n    },\n    // Delete bot\n    async deleteBot (botId) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"bots\").doc(botId).delete();\n            return true;\n        } catch (error) {\n            console.error(\"Error deleting bot from Firebase:\", error);\n            return false;\n        }\n    },\n    // Chat Sessions Management\n    async createChatSession (sessionData) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"chatSessions\").doc(sessionData.id).set(sessionData);\n            return sessionData;\n        } catch (error) {\n            console.error(\"Error saving chat session to Firebase:\", error);\n            throw error;\n        }\n    },\n    async updateChatSession (sessionData) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"chatSessions\").doc(sessionData.id).set(sessionData);\n            return sessionData;\n        } catch (error) {\n            console.error(\"Error updating chat session in Firebase:\", error);\n            throw error;\n        }\n    },\n    async getChatSessionsByBot (botId) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            const querySnapshot = await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"chatSessions\").where(\"botId\", \"==\", botId).orderBy(\"lastActivityAt\", \"desc\").get();\n            const firebaseSessions = [];\n            querySnapshot.forEach((doc)=>{\n                firebaseSessions.push({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            });\n            return firebaseSessions;\n        } catch (error) {\n            console.error(\"Error fetching chat sessions by bot from Firebase:\", error);\n            return [];\n        }\n    },\n    async getChatSessionsByUser (userId) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            // Use simpler query to avoid complex composite index requirements\n            const querySnapshot = await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"chatSessions\").where(\"userId\", \"==\", userId).get();\n            const firebaseSessions = [];\n            querySnapshot.forEach((doc)=>{\n                const sessionData = doc.data();\n                // Filter for authenticated sessions in memory\n                if (sessionData.isAuthenticated === true) {\n                    firebaseSessions.push({\n                        id: doc.id,\n                        ...sessionData\n                    });\n                }\n            });\n            // Sort by lastActivityAt in memory (descending)\n            return firebaseSessions.sort((a, b)=>{\n                const aTime = a.lastActivityAt instanceof Date ? a.lastActivityAt : new Date(a.lastActivityAt);\n                const bTime = b.lastActivityAt instanceof Date ? b.lastActivityAt : new Date(b.lastActivityAt);\n                return bTime.getTime() - aTime.getTime();\n            });\n        } catch (error) {\n            console.error(\"Error fetching chat sessions by user from Firebase:\", error);\n            return [];\n        }\n    },\n    async getChatSession (sessionId) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            const docRef = _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"chatSessions\").doc(sessionId);\n            const docSnap = await docRef.get();\n            if (docSnap.exists) {\n                return {\n                    id: docSnap.id,\n                    ...docSnap.data()\n                };\n            }\n            return null;\n        } catch (error) {\n            console.error(\"Error fetching chat session from Firebase:\", error);\n            return null;\n        }\n    },\n    // Unanswered Questions Management\n    async createUnansweredQuestion (questionData) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"unansweredQuestions\").doc(questionData.id).set(questionData);\n            return questionData;\n        } catch (error) {\n            console.error(\"Error saving unanswered question to Firebase:\", error);\n            throw error;\n        }\n    },\n    async updateUnansweredQuestion (questionData) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"unansweredQuestions\").doc(questionData.id).set(questionData);\n            return questionData;\n        } catch (error) {\n            console.error(\"Error updating unanswered question in Firebase:\", error);\n            throw error;\n        }\n    },\n    async getUnansweredQuestionsByBot (botId) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            const querySnapshot = await _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"unansweredQuestions\").where(\"botId\", \"==\", botId).where(\"isAnswered\", \"==\", false).get();\n            const questions = [];\n            querySnapshot.forEach((doc)=>{\n                questions.push({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            });\n            return questions;\n        } catch (error) {\n            console.error(\"Error fetching unanswered questions from Firebase:\", error);\n            return [];\n        }\n    },\n    async getUnansweredQuestion (questionId) {\n        if (!_lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb) {\n            throw new Error(\"Firebase Admin is not initialized. Please check your environment variables.\");\n        }\n        try {\n            const docRef = _lib_firebase_admin__WEBPACK_IMPORTED_MODULE_2__.adminDb.collection(\"unansweredQuestions\").doc(questionId);\n            const docSnap = await docRef.get();\n            if (docSnap.exists) {\n                return {\n                    id: docSnap.id,\n                    ...docSnap.data()\n                };\n            }\n            return null;\n        } catch (error) {\n            console.error(\"Error fetching unanswered question from Firebase:\", error);\n            return null;\n        }\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TTdCLE9BQ3JCNkIsS0FBSyxDQUFDLGNBQWMsTUFBTSxPQUMxQmpCLEdBQUc7WUFDTixNQUFNaUQsWUFBa0MsRUFBRTtZQUMxQ2pDLGNBQWNJLE9BQU8sQ0FBQyxDQUFDMUQ7Z0JBQ3JCdUYsVUFBVTVCLElBQUksQ0FBQztvQkFBRTdCLElBQUk5QixJQUFJOEIsRUFBRTtvQkFBRSxHQUFHOUIsSUFBSStCLElBQUksRUFBRTtnQkFBQztZQUM3QztZQUNBLE9BQU93RDtRQUNULEVBQUUsT0FBT3ZELE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLHNEQUFzREE7WUFDcEUsT0FBTyxFQUFFO1FBQ1g7SUFDRjtJQUVBLE1BQU13RCx1QkFBc0JDLFVBQWtCO1FBQzVDLElBQUksQ0FBQ3JGLHdEQUFPQSxFQUFFO1lBQ1osTUFBTSxJQUFJaUMsTUFBTTtRQUNsQjtRQUNBLElBQUk7WUFDRixNQUFNVixTQUFTdkIsd0RBQU9BLENBQUNMLFVBQVUsQ0FBQyx1QkFBdUJDLEdBQUcsQ0FBQ3lGO1lBQzdELE1BQU03RCxVQUFVLE1BQU1ELE9BQU9XLEdBQUc7WUFDaEMsSUFBSVYsUUFBUUMsTUFBTSxFQUFFO2dCQUNsQixPQUFPO29CQUFFQyxJQUFJRixRQUFRRSxFQUFFO29CQUFFLEdBQUdGLFFBQVFHLElBQUksRUFBRTtnQkFBQztZQUM3QztZQUNBLE9BQU87UUFDVCxFQUFFLE9BQU9DLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLHFEQUFxREE7WUFDbkUsT0FBTztRQUNUO0lBQ0Y7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXNxdWUtYm90LXBsYXRmb3JtLy4vbGliL2RhdGFiYXNlL2luZGV4LnRzP2FjNzYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgXG4gIGNvbGxlY3Rpb24sIFxuICBkb2MsIFxuICBnZXREb2MsIFxuICBhZGREb2Ncbn0gZnJvbSAnZmlyZWJhc2UvZmlyZXN0b3JlJztcbmltcG9ydCB7IGRiIH0gZnJvbSAnQC9saWIvZmlyZWJhc2UnO1xuaW1wb3J0IHsgYWRtaW5EYiB9IGZyb20gJ0AvbGliL2ZpcmViYXNlLWFkbWluJztcbmltcG9ydCB7IEJvdCwgQ2hhdFNlc3Npb24sIFVuYW5zd2VyZWRRdWVzdGlvbiwgQ2hhdEFuYWx5dGljcywgQm90QW5hbHl0aWNzIH0gZnJvbSAnQC90eXBlcyc7XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBjYWxjdWxhdGUgYW5hbHl0aWNzXG5jb25zdCBjYWxjdWxhdGVBbmFseXRpY3MgPSAoc2Vzc2lvbnM6IENoYXRTZXNzaW9uW10pOiBCb3RBbmFseXRpY3MgPT4ge1xuICBjb25zdCB0b3RhbFZpc2l0b3JzID0gc2Vzc2lvbnMubGVuZ3RoO1xuICBjb25zdCB0b3RhbENoYXRzID0gc2Vzc2lvbnMucmVkdWNlKChzdW0sIHNlc3Npb24pID0+IHN1bSArIHNlc3Npb24ubWVzc2FnZUNvdW50LCAwKTtcbiAgY29uc3QgdG90YWxNZXNzYWdlcyA9IHNlc3Npb25zLnJlZHVjZSgoc3VtLCBzZXNzaW9uKSA9PiBzdW0gKyBzZXNzaW9uLm1lc3NhZ2VzLmxlbmd0aCwgMCk7XG4gIGNvbnN0IGF2ZXJhZ2VSZXNwb25zZVRpbWUgPSBzZXNzaW9ucy5sZW5ndGggPiAwIFxuICAgID8gc2Vzc2lvbnMucmVkdWNlKChzdW0sIHNlc3Npb24pID0+IHN1bSArIChzZXNzaW9uLmF2ZXJhZ2VSZXNwb25zZVRpbWUgfHwgMCksIDApIC8gc2Vzc2lvbnMubGVuZ3RoIFxuICAgIDogMDtcbiAgY29uc3Qgc3VjY2Vzc2Z1bFJlc3BvbnNlcyA9IHNlc3Npb25zLnJlZHVjZSgoc3VtLCBzZXNzaW9uKSA9PiBzdW0gKyBzZXNzaW9uLnN1Y2Nlc3NmdWxSZXNwb25zZXMsIDApO1xuICBjb25zdCBmYWlsZWRRdWVzdGlvbnMgPSBzZXNzaW9ucy5yZWR1Y2UoKHN1bSwgc2Vzc2lvbikgPT4gc3VtICsgc2Vzc2lvbi5mYWlsZWRRdWVzdGlvbnMsIDApO1xuXG4gIHJldHVybiB7XG4gICAgdG90YWxWaXNpdG9ycyxcbiAgICB0b3RhbENoYXRzLFxuICAgIHRvdGFsTWVzc2FnZXMsXG4gICAgYXZlcmFnZVJlc3BvbnNlVGltZSxcbiAgICBzdWNjZXNzZnVsUmVzcG9uc2VzLFxuICAgIGZhaWxlZFF1ZXN0aW9ucyxcbiAgICBzdWNjZXNzUmF0ZTogdG90YWxNZXNzYWdlcyA+IDAgPyAoc3VjY2Vzc2Z1bFJlc3BvbnNlcyAvIHRvdGFsTWVzc2FnZXMpICogMTAwIDogMCxcbiAgICBkYWlseVZpc2l0b3JzOiBbXSxcbiAgICB3ZWVrbHlDaGF0czogW10sXG4gICAgdG9wUXVlc3Rpb25zOiBbXSxcbiAgICByZXNwb25zZVRpbWVIaXN0b3J5OiBbXVxuICB9O1xufTtcblxuLy8gQ2xpZW50LXNpZGUgZGF0YWJhc2Ugb3BlcmF0aW9ucyAoZm9yIGZyb250ZW5kKVxuZXhwb3J0IGNvbnN0IGNsaWVudERiID0ge1xuICAvLyBHZXQgYm90IGRhdGFcbiAgYXN5bmMgZ2V0Qm90KGJvdElkOiBzdHJpbmcpOiBQcm9taXNlPEJvdCB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZG9jUmVmID0gZG9jKGRiLCAnYm90cycsIGJvdElkKTtcbiAgICAgIGNvbnN0IGRvY1NuYXAgPSBhd2FpdCBnZXREb2MoZG9jUmVmKTtcbiAgICAgIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7XG4gICAgICAgIHJldHVybiB7IGlkOiBkb2NTbmFwLmlkLCAuLi5kb2NTbmFwLmRhdGEoKSB9IGFzIEJvdDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib3Q6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9LFxuICAvLyBBZGQgY2hhdCBzZXNzaW9uXG4gIGFzeW5jIGFkZENoYXRTZXNzaW9uKHNlc3Npb25EYXRhOiBPbWl0PENoYXRTZXNzaW9uLCAnaWQnPik6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkb2NSZWYgPSBhd2FpdCBhZGREb2MoY29sbGVjdGlvbihkYiwgJ2NoYXRTZXNzaW9ucycpLCBzZXNzaW9uRGF0YSk7XG4gICAgICByZXR1cm4gZG9jUmVmLmlkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhZGRpbmcgY2hhdCBzZXNzaW9uOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxufTtcblxuLy8gU2VydmVyLXNpZGUgZGF0YWJhc2Ugb3BlcmF0aW9ucyAoZm9yIEFQSSByb3V0ZXMpXG5leHBvcnQgY29uc3Qgc2VydmVyRGIgPSB7XG4gIC8vIEdldCBib3QgYnkgSURcbiAgYXN5bmMgZ2V0Qm90KGJvdElkOiBzdHJpbmcpOiBQcm9taXNlPEJvdCB8IG51bGw+IHtcbiAgICBpZiAoIWFkbWluRGIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmlyZWJhc2UgQWRtaW4gaXMgbm90IGluaXRpYWxpemVkLiBQbGVhc2UgY2hlY2sgeW91ciBlbnZpcm9ubWVudCB2YXJpYWJsZXMuJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkb2NSZWYgPSBhZG1pbkRiLmNvbGxlY3Rpb24oJ2JvdHMnKS5kb2MoYm90SWQpO1xuICAgICAgY29uc3QgZG9jU25hcCA9IGF3YWl0IGRvY1JlZi5nZXQoKTtcbiAgICAgIGlmIChkb2NTbmFwLmV4aXN0cykge1xuICAgICAgICByZXR1cm4geyBpZDogZG9jU25hcC5pZCwgLi4uZG9jU25hcC5kYXRhKCkgfSBhcyBCb3Q7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgYm90IGZyb20gRmlyZWJhc2U6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9LFxuXG4gIC8vIEdldCBib3Qgd2l0aCBhbmFseXRpY3NcbiAgYXN5bmMgZ2V0Qm90V2l0aEFuYWx5dGljcyhib3RJZDogc3RyaW5nKTogUHJvbWlzZTxCb3QgfCBudWxsPiB7XG4gICAgY29uc3QgYm90ID0gYXdhaXQgdGhpcy5nZXRCb3QoYm90SWQpO1xuICAgIGlmICghYm90KSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IHRoaXMuZ2V0Q2hhdFNlc3Npb25zQnlCb3QoYm90SWQpO1xuICAgIGJvdC5hbmFseXRpY3MgPSBjYWxjdWxhdGVBbmFseXRpY3Moc2Vzc2lvbnMpO1xuICAgIHJldHVybiBib3Q7XG4gIH0sXG5cbiAgLy8gQ3JlYXRlIG5ldyBib3RcbiAgYXN5bmMgY3JlYXRlQm90KGJvdERhdGE6IEJvdCk6IFByb21pc2U8Qm90PiB7XG4gICAgaWYgKCFhZG1pbkRiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpcmViYXNlIEFkbWluIGlzIG5vdCBpbml0aWFsaXplZC4gUGxlYXNlIGNoZWNrIHlvdXIgZW52aXJvbm1lbnQgdmFyaWFibGVzLicpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgY2xlYW5Cb3REYXRhID0ge1xuICAgICAgICAuLi5ib3REYXRhLFxuICAgICAgICBkZXNjcmlwdGlvbjogYm90RGF0YS5kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgICAgZGVwbG95ZWRBdDogYm90RGF0YS5kZXBsb3llZEF0IHx8IG51bGwsXG4gICAgICAgIHByb2ZpbGVQaWN0dXJlVXJsOiBib3REYXRhLnByb2ZpbGVQaWN0dXJlVXJsIHx8IG51bGwsXG4gICAgICAgIHdlbGNvbWVNZXNzYWdlOiBib3REYXRhLndlbGNvbWVNZXNzYWdlIHx8IG51bGwsXG4gICAgICB9O1xuICAgICAgYXdhaXQgYWRtaW5EYi5jb2xsZWN0aW9uKCdib3RzJykuZG9jKGJvdERhdGEuaWQpLnNldChjbGVhbkJvdERhdGEpO1xuICAgICAgcmV0dXJuIGJvdERhdGE7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNhdmluZyBib3QgdG8gRmlyZWJhc2U6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9LFxuXG4gIC8vIFVwZGF0ZSBib3RcbiAgYXN5bmMgdXBkYXRlQm90KGJvdERhdGE6IEJvdCk6IFByb21pc2U8Qm90PiB7XG4gICAgaWYgKCFhZG1pbkRiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpcmViYXNlIEFkbWluIGlzIG5vdCBpbml0aWFsaXplZC4gUGxlYXNlIGNoZWNrIHlvdXIgZW52aXJvbm1lbnQgdmFyaWFibGVzLicpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgY2xlYW5Cb3REYXRhID0ge1xuICAgICAgICAuLi5ib3REYXRhLFxuICAgICAgICBkZXNjcmlwdGlvbjogYm90RGF0YS5kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgICAgZGVwbG95ZWRBdDogYm90RGF0YS5kZXBsb3llZEF0IHx8IG51bGwsXG4gICAgICAgIHByb2ZpbGVQaWN0dXJlVXJsOiBib3REYXRhLnByb2ZpbGVQaWN0dXJlVXJsIHx8IG51bGwsXG4gICAgICAgIHdlbGNvbWVNZXNzYWdlOiBib3REYXRhLndlbGNvbWVNZXNzYWdlIHx8IG51bGwsXG4gICAgICB9O1xuICAgICAgYXdhaXQgYWRtaW5EYi5jb2xsZWN0aW9uKCdib3RzJykuZG9jKGJvdERhdGEuaWQpLnNldChjbGVhbkJvdERhdGEpO1xuICAgICAgcmV0dXJuIGJvdERhdGE7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIGJvdCBpbiBGaXJlYmFzZTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH0sXG5cbiAgLy8gR2V0IGJvdHMgYnkgb3duZXIgSURcbiAgYXN5bmMgZ2V0Qm90c0J5T3duZXIob3duZXJJZDogc3RyaW5nKTogUHJvbWlzZTxCb3RbXT4ge1xuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaXJlYmFzZSBBZG1pbiBpcyBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBjaGVjayB5b3VyIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHF1ZXJ5U25hcHNob3QgPSBhd2FpdCBhZG1pbkRiXG4gICAgICAgIC5jb2xsZWN0aW9uKCdib3RzJylcbiAgICAgICAgLndoZXJlKCdvd25lcklkJywgJz09Jywgb3duZXJJZClcbiAgICAgICAgLm9yZGVyQnkoJ2NyZWF0ZWRBdCcsICdkZXNjJylcbiAgICAgICAgLmdldCgpO1xuICAgICAgY29uc3QgZmlyZWJhc2VCb3RzOiBCb3RbXSA9IFtdO1xuICAgICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2M6IGFueSkgPT4ge1xuICAgICAgICBmaXJlYmFzZUJvdHMucHVzaCh7IGlkOiBkb2MuaWQsIC4uLmRvYy5kYXRhKCkgfSBhcyBCb3QpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZmlyZWJhc2VCb3RzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib3RzIGJ5IG93bmVyIGZyb20gRmlyZWJhc2U6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfSxcblxuICAvLyBHZXQgYm90cyBieSBwaG9uZSBudW1iZXJcbiAgYXN5bmMgZ2V0Qm90c0J5UGhvbmVOdW1iZXIocGhvbmVOdW1iZXI6IHN0cmluZyk6IFByb21pc2U8Qm90W10+IHtcbiAgICBpZiAoIWFkbWluRGIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmlyZWJhc2UgQWRtaW4gaXMgbm90IGluaXRpYWxpemVkLiBQbGVhc2UgY2hlY2sgeW91ciBlbnZpcm9ubWVudCB2YXJpYWJsZXMuJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBxdWVyeVNuYXBzaG90ID0gYXdhaXQgYWRtaW5EYlxuICAgICAgICAuY29sbGVjdGlvbignYm90cycpXG4gICAgICAgIC53aGVyZSgnb3duZXJQaG9uZU51bWJlcicsICc9PScsIHBob25lTnVtYmVyKVxuICAgICAgICAub3JkZXJCeSgnY3JlYXRlZEF0JywgJ2Rlc2MnKVxuICAgICAgICAuZ2V0KCk7XG4gICAgICBjb25zdCBmaXJlYmFzZUJvdHM6IEJvdFtdID0gW107XG4gICAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goKGRvYzogYW55KSA9PiB7XG4gICAgICAgIGZpcmViYXNlQm90cy5wdXNoKHsgaWQ6IGRvYy5pZCwgLi4uZG9jLmRhdGEoKSB9IGFzIEJvdCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBmaXJlYmFzZUJvdHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvdHMgYnkgcGhvbmUgZnJvbSBGaXJlYmFzZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9LFxuXG4gIC8vIEVuaGFuY2VkIGdldEJvdHNCeU93bmVyIHRoYXQgYWxzbyBjaGVja3MgcGhvbmUgbnVtYmVyIGFzIGZhbGxiYWNrXG4gIGFzeW5jIGdldEJvdHNCeU93bmVyV2l0aEZhbGxiYWNrKG93bmVySWQ6IHN0cmluZywgcGhvbmVOdW1iZXI/OiBzdHJpbmcpOiBQcm9taXNlPEJvdFtdPiB7XG4gICAgbGV0IGJvdHMgPSBhd2FpdCB0aGlzLmdldEJvdHNCeU93bmVyKG93bmVySWQpO1xuICAgIGlmIChib3RzLmxlbmd0aCA9PT0gMCAmJiBwaG9uZU51bWJlcikge1xuICAgICAgY29uc3QgcGhvbmVCb3RzID0gYXdhaXQgdGhpcy5nZXRCb3RzQnlQaG9uZU51bWJlcihwaG9uZU51bWJlcik7XG4gICAgICBpZiAocGhvbmVCb3RzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZm9yIChjb25zdCBib3Qgb2YgcGhvbmVCb3RzKSB7XG4gICAgICAgICAgYm90Lm93bmVySWQgPSBvd25lcklkO1xuICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlQm90KGJvdCk7XG4gICAgICAgIH1cbiAgICAgICAgYm90cyA9IHBob25lQm90cztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGJvdHM7XG4gIH0sXG5cbiAgLy8gRGVsZXRlIGJvdFxuICBhc3luYyBkZWxldGVCb3QoYm90SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaXJlYmFzZSBBZG1pbiBpcyBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBjaGVjayB5b3VyIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFkbWluRGIuY29sbGVjdGlvbignYm90cycpLmRvYyhib3RJZCkuZGVsZXRlKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgYm90IGZyb20gRmlyZWJhc2U6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSxcblxuICAvLyBDaGF0IFNlc3Npb25zIE1hbmFnZW1lbnRcbiAgYXN5bmMgY3JlYXRlQ2hhdFNlc3Npb24oc2Vzc2lvbkRhdGE6IENoYXRTZXNzaW9uKTogUHJvbWlzZTxDaGF0U2Vzc2lvbj4ge1xuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaXJlYmFzZSBBZG1pbiBpcyBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBjaGVjayB5b3VyIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFkbWluRGIuY29sbGVjdGlvbignY2hhdFNlc3Npb25zJykuZG9jKHNlc3Npb25EYXRhLmlkKS5zZXQoc2Vzc2lvbkRhdGEpO1xuICAgICAgcmV0dXJuIHNlc3Npb25EYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgY2hhdCBzZXNzaW9uIHRvIEZpcmViYXNlOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfSxcblxuICBhc3luYyB1cGRhdGVDaGF0U2Vzc2lvbihzZXNzaW9uRGF0YTogQ2hhdFNlc3Npb24pOiBQcm9taXNlPENoYXRTZXNzaW9uPiB7XG4gICAgaWYgKCFhZG1pbkRiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpcmViYXNlIEFkbWluIGlzIG5vdCBpbml0aWFsaXplZC4gUGxlYXNlIGNoZWNrIHlvdXIgZW52aXJvbm1lbnQgdmFyaWFibGVzLicpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgYWRtaW5EYi5jb2xsZWN0aW9uKCdjaGF0U2Vzc2lvbnMnKS5kb2Moc2Vzc2lvbkRhdGEuaWQpLnNldChzZXNzaW9uRGF0YSk7XG4gICAgICByZXR1cm4gc2Vzc2lvbkRhdGE7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIGNoYXQgc2Vzc2lvbiBpbiBGaXJlYmFzZTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgZ2V0Q2hhdFNlc3Npb25zQnlCb3QoYm90SWQ6IHN0cmluZyk6IFByb21pc2U8Q2hhdFNlc3Npb25bXT4ge1xuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaXJlYmFzZSBBZG1pbiBpcyBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBjaGVjayB5b3VyIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHF1ZXJ5U25hcHNob3QgPSBhd2FpdCBhZG1pbkRiXG4gICAgICAgIC5jb2xsZWN0aW9uKCdjaGF0U2Vzc2lvbnMnKVxuICAgICAgICAud2hlcmUoJ2JvdElkJywgJz09JywgYm90SWQpXG4gICAgICAgIC5vcmRlckJ5KCdsYXN0QWN0aXZpdHlBdCcsICdkZXNjJylcbiAgICAgICAgLmdldCgpO1xuICAgICAgY29uc3QgZmlyZWJhc2VTZXNzaW9uczogQ2hhdFNlc3Npb25bXSA9IFtdO1xuICAgICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2M6IGFueSkgPT4ge1xuICAgICAgICBmaXJlYmFzZVNlc3Npb25zLnB1c2goeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0gYXMgQ2hhdFNlc3Npb24pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZmlyZWJhc2VTZXNzaW9ucztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgY2hhdCBzZXNzaW9ucyBieSBib3QgZnJvbSBGaXJlYmFzZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9LFxuXG4gIGFzeW5jIGdldENoYXRTZXNzaW9uc0J5VXNlcih1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8Q2hhdFNlc3Npb25bXT4ge1xuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaXJlYmFzZSBBZG1pbiBpcyBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBjaGVjayB5b3VyIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBzaW1wbGVyIHF1ZXJ5IHRvIGF2b2lkIGNvbXBsZXggY29tcG9zaXRlIGluZGV4IHJlcXVpcmVtZW50c1xuICAgICAgY29uc3QgcXVlcnlTbmFwc2hvdCA9IGF3YWl0IGFkbWluRGJcbiAgICAgICAgLmNvbGxlY3Rpb24oJ2NoYXRTZXNzaW9ucycpXG4gICAgICAgIC53aGVyZSgndXNlcklkJywgJz09JywgdXNlcklkKVxuICAgICAgICAuZ2V0KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGZpcmViYXNlU2Vzc2lvbnM6IENoYXRTZXNzaW9uW10gPSBbXTtcbiAgICAgIHF1ZXJ5U25hcHNob3QuZm9yRWFjaCgoZG9jOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSBkb2MuZGF0YSgpO1xuICAgICAgICAvLyBGaWx0ZXIgZm9yIGF1dGhlbnRpY2F0ZWQgc2Vzc2lvbnMgaW4gbWVtb3J5XG4gICAgICAgIGlmIChzZXNzaW9uRGF0YS5pc0F1dGhlbnRpY2F0ZWQgPT09IHRydWUpIHtcbiAgICAgICAgICBmaXJlYmFzZVNlc3Npb25zLnB1c2goeyBpZDogZG9jLmlkLCAuLi5zZXNzaW9uRGF0YSB9IGFzIENoYXRTZXNzaW9uKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFNvcnQgYnkgbGFzdEFjdGl2aXR5QXQgaW4gbWVtb3J5IChkZXNjZW5kaW5nKVxuICAgICAgcmV0dXJuIGZpcmViYXNlU2Vzc2lvbnMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICBjb25zdCBhVGltZSA9IGEubGFzdEFjdGl2aXR5QXQgaW5zdGFuY2VvZiBEYXRlID8gYS5sYXN0QWN0aXZpdHlBdCA6IG5ldyBEYXRlKGEubGFzdEFjdGl2aXR5QXQpO1xuICAgICAgICBjb25zdCBiVGltZSA9IGIubGFzdEFjdGl2aXR5QXQgaW5zdGFuY2VvZiBEYXRlID8gYi5sYXN0QWN0aXZpdHlBdCA6IG5ldyBEYXRlKGIubGFzdEFjdGl2aXR5QXQpO1xuICAgICAgICByZXR1cm4gYlRpbWUuZ2V0VGltZSgpIC0gYVRpbWUuZ2V0VGltZSgpO1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNoYXQgc2Vzc2lvbnMgYnkgdXNlciBmcm9tIEZpcmViYXNlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgZ2V0Q2hhdFNlc3Npb24oc2Vzc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPENoYXRTZXNzaW9uIHwgbnVsbD4ge1xuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaXJlYmFzZSBBZG1pbiBpcyBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBjaGVjayB5b3VyIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRvY1JlZiA9IGFkbWluRGIuY29sbGVjdGlvbignY2hhdFNlc3Npb25zJykuZG9jKHNlc3Npb25JZCk7XG4gICAgICBjb25zdCBkb2NTbmFwID0gYXdhaXQgZG9jUmVmLmdldCgpO1xuICAgICAgaWYgKGRvY1NuYXAuZXhpc3RzKSB7XG4gICAgICAgIHJldHVybiB7IGlkOiBkb2NTbmFwLmlkLCAuLi5kb2NTbmFwLmRhdGEoKSB9IGFzIENoYXRTZXNzaW9uO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNoYXQgc2Vzc2lvbiBmcm9tIEZpcmViYXNlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfSxcblxuICAvLyBVbmFuc3dlcmVkIFF1ZXN0aW9ucyBNYW5hZ2VtZW50XG4gIGFzeW5jIGNyZWF0ZVVuYW5zd2VyZWRRdWVzdGlvbihxdWVzdGlvbkRhdGE6IFVuYW5zd2VyZWRRdWVzdGlvbik6IFByb21pc2U8VW5hbnN3ZXJlZFF1ZXN0aW9uPiB7XG4gICAgaWYgKCFhZG1pbkRiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpcmViYXNlIEFkbWluIGlzIG5vdCBpbml0aWFsaXplZC4gUGxlYXNlIGNoZWNrIHlvdXIgZW52aXJvbm1lbnQgdmFyaWFibGVzLicpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgYWRtaW5EYi5jb2xsZWN0aW9uKCd1bmFuc3dlcmVkUXVlc3Rpb25zJykuZG9jKHF1ZXN0aW9uRGF0YS5pZCkuc2V0KHF1ZXN0aW9uRGF0YSk7XG4gICAgICByZXR1cm4gcXVlc3Rpb25EYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgdW5hbnN3ZXJlZCBxdWVzdGlvbiB0byBGaXJlYmFzZTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgdXBkYXRlVW5hbnN3ZXJlZFF1ZXN0aW9uKHF1ZXN0aW9uRGF0YTogVW5hbnN3ZXJlZFF1ZXN0aW9uKTogUHJvbWlzZTxVbmFuc3dlcmVkUXVlc3Rpb24+IHtcbiAgICBpZiAoIWFkbWluRGIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmlyZWJhc2UgQWRtaW4gaXMgbm90IGluaXRpYWxpemVkLiBQbGVhc2UgY2hlY2sgeW91ciBlbnZpcm9ubWVudCB2YXJpYWJsZXMuJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBhZG1pbkRiLmNvbGxlY3Rpb24oJ3VuYW5zd2VyZWRRdWVzdGlvbnMnKS5kb2MocXVlc3Rpb25EYXRhLmlkKS5zZXQocXVlc3Rpb25EYXRhKTtcbiAgICAgIHJldHVybiBxdWVzdGlvbkRhdGE7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHVuYW5zd2VyZWQgcXVlc3Rpb24gaW4gRmlyZWJhc2U6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9LFxuXG4gIGFzeW5jIGdldFVuYW5zd2VyZWRRdWVzdGlvbnNCeUJvdChib3RJZDogc3RyaW5nKTogUHJvbWlzZTxVbmFuc3dlcmVkUXVlc3Rpb25bXT4ge1xuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaXJlYmFzZSBBZG1pbiBpcyBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBjaGVjayB5b3VyIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHF1ZXJ5U25hcHNob3QgPSBhd2FpdCBhZG1pbkRiXG4gICAgICAgIC5jb2xsZWN0aW9uKCd1bmFuc3dlcmVkUXVlc3Rpb25zJylcbiAgICAgICAgLndoZXJlKCdib3RJZCcsICc9PScsIGJvdElkKVxuICAgICAgICAud2hlcmUoJ2lzQW5zd2VyZWQnLCAnPT0nLCBmYWxzZSlcbiAgICAgICAgLmdldCgpO1xuICAgICAgY29uc3QgcXVlc3Rpb25zOiBVbmFuc3dlcmVkUXVlc3Rpb25bXSA9IFtdO1xuICAgICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2M6IGFueSkgPT4ge1xuICAgICAgICBxdWVzdGlvbnMucHVzaCh7IGlkOiBkb2MuaWQsIC4uLmRvYy5kYXRhKCkgfSBhcyBVbmFuc3dlcmVkUXVlc3Rpb24pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcXVlc3Rpb25zO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB1bmFuc3dlcmVkIHF1ZXN0aW9ucyBmcm9tIEZpcmViYXNlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgZ2V0VW5hbnN3ZXJlZFF1ZXN0aW9uKHF1ZXN0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8VW5hbnN3ZXJlZFF1ZXN0aW9uIHwgbnVsbD4ge1xuICAgIGlmICghYWRtaW5EYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaXJlYmFzZSBBZG1pbiBpcyBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBjaGVjayB5b3VyIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRvY1JlZiA9IGFkbWluRGIuY29sbGVjdGlvbigndW5hbnN3ZXJlZFF1ZXN0aW9ucycpLmRvYyhxdWVzdGlvbklkKTtcbiAgICAgIGNvbnN0IGRvY1NuYXAgPSBhd2FpdCBkb2NSZWYuZ2V0KCk7XG4gICAgICBpZiAoZG9jU25hcC5leGlzdHMpIHtcbiAgICAgICAgcmV0dXJuIHsgaWQ6IGRvY1NuYXAuaWQsIC4uLmRvY1NuYXAuZGF0YSgpIH0gYXMgVW5hbnN3ZXJlZFF1ZXN0aW9uO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHVuYW5zd2VyZWQgcXVlc3Rpb24gZnJvbSBGaXJlYmFzZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbn07ICJdLCJuYW1lcyI6WyJjb2xsZWN0aW9uIiwiZG9jIiwiZ2V0RG9jIiwiYWRkRG9jIiwiZGIiLCJhZG1pbkRiIiwiY2FsY3VsYXRlQW5hbHl0aWNzIiwic2Vzc2lvbnMiLCJ0b3RhbFZpc2l0b3JzIiwibGVuZ3RoIiwidG90YWxDaGF0cyIsInJlZHVjZSIsInN1bSIsInNlc3Npb24iLCJtZXNzYWdlQ291bnQiLCJ0b3RhbE1lc3NhZ2VzIiwibWVzc2FnZXMiLCJhdmVyYWdlUmVzcG9uc2VUaW1lIiwic3VjY2Vzc2Z1bFJlc3BvbnNlcyIsImZhaWxlZFF1ZXN0aW9ucyIsInN1Y2Nlc3NSYXRlIiwiZGFpbHlWaXNpdG9ycyIsIndlZWtseUNoYXRzIiwidG9wUXVlc3Rpb25zIiwicmVzcG9uc2VUaW1lSGlzdG9yeSIsImNsaWVudERiIiwiZ2V0Qm90IiwiYm90SWQiLCJkb2NSZWYiLCJkb2NTbmFwIiwiZXhpc3RzIiwiaWQiLCJkYXRhIiwiZXJyb3IiLCJjb25zb2xlIiwiYWRkQ2hhdFNlc3Npb24iLCJzZXNzaW9uRGF0YSIsInNlcnZlckRiIiwiRXJyb3IiLCJnZXQiLCJnZXRCb3RXaXRoQW5hbHl0aWNzIiwiYm90IiwiZ2V0Q2hhdFNlc3Npb25zQnlCb3QiLCJhbmFseXRpY3MiLCJjcmVhdGVCb3QiLCJib3REYXRhIiwiY2xlYW5Cb3REYXRhIiwiZGVzY3JpcHRpb24iLCJkZXBsb3llZEF0IiwicHJvZmlsZVBpY3R1cmVVcmwiLCJ3ZWxjb21lTWVzc2FnZSIsInNldCIsInVwZGF0ZUJvdCIsImdldEJvdHNCeU93bmVyIiwib3duZXJJZCIsInF1ZXJ5U25hcHNob3QiLCJ3aGVyZSIsIm9yZGVyQnkiLCJmaXJlYmFzZUJvdHMiLCJmb3JFYWNoIiwicHVzaCIsImdldEJvdHNCeVBob25lTnVtYmVyIiwicGhvbmVOdW1iZXIiLCJnZXRCb3RzQnlPd25lcldpdGhGYWxsYmFjayIsImJvdHMiLCJwaG9uZUJvdHMiLCJkZWxldGVCb3QiLCJkZWxldGUiLCJjcmVhdGVDaGF0U2Vzc2lvbiIsInVwZGF0ZUNoYXRTZXNzaW9uIiwiZmlyZWJhc2VTZXNzaW9ucyIsImdldENoYXRTZXNzaW9uc0J5VXNlciIsInVzZXJJZCIsImlzQXV0aGVudGljYXRlZCIsInNvcnQiLCJhIiwiYiIsImFUaW1lIiwibGFzdEFjdGl2aXR5QXQiLCJEYXRlIiwiYlRpbWUiLCJnZXRUaW1lIiwiZ2V0Q2hhdFNlc3Npb24iLCJzZXNzaW9uSWQiLCJjcmVhdGVVbmFuc3dlcmVkUXVlc3Rpb24iLCJxdWVzdGlvbkRhdGEiLCJ1cGRhdGVVbmFuc3dlcmVkUXVlc3Rpb24iLCJnZXRVbmFuc3dlcmVkUXVlc3Rpb25zQnlCb3QiLCJxdWVzdGlvbnMiLCJnZXRVbmFuc3dlcmVkUXVlc3Rpb24iLCJxdWVzdGlvbklkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/database/index.ts\n");

/***/ }),

/***/ "(api)/./lib/firebase-admin.ts":
/*!*******************************!*\
  !*** ./lib/firebase-admin.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   adminDb: () => (/* binding */ adminDb)\n/* harmony export */ });\n/* harmony import */ var firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase-admin/app */ \"firebase-admin/app\");\n/* harmony import */ var firebase_admin_app__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase-admin/firestore */ \"firebase-admin/firestore\");\n/* harmony import */ var firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconsole.log(\"\\uD83D\\uDD0D Firebase Admin credentials check:\", {\n    hasProjectId: !!process.env.FIREBASE_PROJECT_ID,\n    hasClientEmail: !!process.env.FIREBASE_CLIENT_EMAIL,\n    hasPrivateKey: !!process.env.FIREBASE_PRIVATE_KEY,\n    isValidPrivateKey: process.env.FIREBASE_PRIVATE_KEY ? process.env.FIREBASE_PRIVATE_KEY.includes(\"BEGIN PRIVATE KEY\") : false,\n    hasValidCredentials: !!(process.env.FIREBASE_PROJECT_ID && process.env.FIREBASE_CLIENT_EMAIL && process.env.FIREBASE_PRIVATE_KEY),\n    privateKeyLength: process.env.FIREBASE_PRIVATE_KEY ? process.env.FIREBASE_PRIVATE_KEY.length : 0\n});\nlet adminDb = null;\n// Test Firebase connection\nasync function testFirebaseConnection(db) {\n    try {\n        await db.collection(\"_test\").limit(1).get();\n        console.log(\"✅ Firebase connection test successful\");\n    } catch (testError) {\n        console.warn(\"⚠️ Firebase connection test failed:\", testError instanceof Error ? testError.message : String(testError));\n        console.log(\"\\uD83D\\uDD04 Will fallback to mock database for operations\");\n    }\n}\ntry {\n    // Check if we have all required credentials\n    if (!process.env.FIREBASE_PROJECT_ID || !process.env.FIREBASE_CLIENT_EMAIL || !process.env.FIREBASE_PRIVATE_KEY) {\n        console.log(\"\\uD83D\\uDEAB Firebase Admin disabled - missing credentials, using mock data for development\");\n        adminDb = null;\n    } else {\n        // Initialize Firebase Admin if not already initialized\n        if ((0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__.getApps)().length === 0) {\n            // Clean and validate the private key\n            let privateKey = process.env.FIREBASE_PRIVATE_KEY;\n            // Handle different private key formats\n            if (privateKey.startsWith('\"') && privateKey.endsWith('\"')) {\n                privateKey = privateKey.slice(1, -1);\n            }\n            // Replace escaped newlines with actual newlines\n            privateKey = privateKey.replace(/\\\\n/g, \"\\n\");\n            // Validate the private key format\n            if (!privateKey.includes(\"BEGIN PRIVATE KEY\") || !privateKey.includes(\"END PRIVATE KEY\")) {\n                throw new Error(\"Invalid private key format - must contain BEGIN and END PRIVATE KEY markers\");\n            }\n            console.log(\"\\uD83D\\uDD27 Initializing Firebase Admin with cleaned credentials...\");\n            const serviceAccount = {\n                projectId: process.env.FIREBASE_PROJECT_ID,\n                clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\n                privateKey: privateKey\n            };\n            const app = (0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__.initializeApp)({\n                credential: (0,firebase_admin_app__WEBPACK_IMPORTED_MODULE_0__.cert)(serviceAccount),\n                projectId: process.env.FIREBASE_PROJECT_ID\n            });\n            adminDb = (0,firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1__.getFirestore)(app);\n            console.log(\"✅ Firebase Admin initialized successfully\");\n            // Test the connection asynchronously\n            testFirebaseConnection(adminDb);\n        } else {\n            adminDb = (0,firebase_admin_firestore__WEBPACK_IMPORTED_MODULE_1__.getFirestore)();\n            console.log(\"✅ Firebase Admin already initialized\");\n        }\n    }\n} catch (error) {\n    console.error(\"❌ Firebase Admin initialization failed:\", error instanceof Error ? error.message : String(error));\n    console.log(\"\\uD83D\\uDEAB Firebase Admin disabled - using mock data for development\");\n    adminDb = null;\n}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNkcEMsUUFBUW9DLEtBQUssQ0FBQywyQ0FBMkNBLGlCQUFpQmIsUUFBUWEsTUFBTVosT0FBTyxHQUFHQyxPQUFPVztJQUN6R3BDLFFBQVFDLEdBQUcsQ0FBQztJQUNaYyxVQUFVO0FBQ1o7QUFFbUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hc3F1ZS1ib3QtcGxhdGZvcm0vLi9saWIvZmlyZWJhc2UtYWRtaW4udHM/NmE0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbml0aWFsaXplQXBwLCBnZXRBcHBzLCBjZXJ0IH0gZnJvbSAnZmlyZWJhc2UtYWRtaW4vYXBwJztcbmltcG9ydCB7IGdldEZpcmVzdG9yZSB9IGZyb20gJ2ZpcmViYXNlLWFkbWluL2ZpcmVzdG9yZSc7XG5cbmNvbnNvbGUubG9nKCfwn5SNIEZpcmViYXNlIEFkbWluIGNyZWRlbnRpYWxzIGNoZWNrOicsIHtcbiAgaGFzUHJvamVjdElkOiAhIXByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQsXG4gIGhhc0NsaWVudEVtYWlsOiAhIXByb2Nlc3MuZW52LkZJUkVCQVNFX0NMSUVOVF9FTUFJTCxcbiAgaGFzUHJpdmF0ZUtleTogISFwcm9jZXNzLmVudi5GSVJFQkFTRV9QUklWQVRFX0tFWSxcbiAgaXNWYWxpZFByaXZhdGVLZXk6IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BSSVZBVEVfS0VZID8gcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJJVkFURV9LRVkuaW5jbHVkZXMoJ0JFR0lOIFBSSVZBVEUgS0VZJykgOiBmYWxzZSxcbiAgaGFzVmFsaWRDcmVkZW50aWFsczogISEocHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJPSkVDVF9JRCAmJiBwcm9jZXNzLmVudi5GSVJFQkFTRV9DTElFTlRfRU1BSUwgJiYgcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJJVkFURV9LRVkpLFxuICBwcml2YXRlS2V5TGVuZ3RoOiBwcm9jZXNzLmVudi5GSVJFQkFTRV9QUklWQVRFX0tFWSA/IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BSSVZBVEVfS0VZLmxlbmd0aCA6IDBcbn0pO1xuXG5sZXQgYWRtaW5EYjogRmlyZWJhc2VGaXJlc3RvcmUuRmlyZXN0b3JlIHwgbnVsbCA9IG51bGw7XG5cbi8vIFRlc3QgRmlyZWJhc2UgY29ubmVjdGlvblxuYXN5bmMgZnVuY3Rpb24gdGVzdEZpcmViYXNlQ29ubmVjdGlvbihkYjogRmlyZWJhc2VGaXJlc3RvcmUuRmlyZXN0b3JlKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignX3Rlc3QnKS5saW1pdCgxKS5nZXQoKTtcbiAgICBjb25zb2xlLmxvZygn4pyFIEZpcmViYXNlIGNvbm5lY3Rpb24gdGVzdCBzdWNjZXNzZnVsJyk7XG4gIH0gY2F0Y2ggKHRlc3RFcnJvcikge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZpcmViYXNlIGNvbm5lY3Rpb24gdGVzdCBmYWlsZWQ6JywgdGVzdEVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyB0ZXN0RXJyb3IubWVzc2FnZSA6IFN0cmluZyh0ZXN0RXJyb3IpKTtcbiAgICBjb25zb2xlLmxvZygn8J+UhCBXaWxsIGZhbGxiYWNrIHRvIG1vY2sgZGF0YWJhc2UgZm9yIG9wZXJhdGlvbnMnKTtcbiAgfVxufVxuXG50cnkge1xuICAvLyBDaGVjayBpZiB3ZSBoYXZlIGFsbCByZXF1aXJlZCBjcmVkZW50aWFsc1xuICBpZiAoIXByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQgfHwgIXByb2Nlc3MuZW52LkZJUkVCQVNFX0NMSUVOVF9FTUFJTCB8fCAhcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJJVkFURV9LRVkpIHtcbiAgICBjb25zb2xlLmxvZygn8J+aqyBGaXJlYmFzZSBBZG1pbiBkaXNhYmxlZCAtIG1pc3NpbmcgY3JlZGVudGlhbHMsIHVzaW5nIG1vY2sgZGF0YSBmb3IgZGV2ZWxvcG1lbnQnKTtcbiAgICBhZG1pbkRiID0gbnVsbDtcbiAgfSBlbHNlIHtcbiAgICAvLyBJbml0aWFsaXplIEZpcmViYXNlIEFkbWluIGlmIG5vdCBhbHJlYWR5IGluaXRpYWxpemVkXG4gICAgaWYgKGdldEFwcHMoKS5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIENsZWFuIGFuZCB2YWxpZGF0ZSB0aGUgcHJpdmF0ZSBrZXlcbiAgICAgIGxldCBwcml2YXRlS2V5ID0gcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJJVkFURV9LRVk7XG4gICAgICBcbiAgICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgcHJpdmF0ZSBrZXkgZm9ybWF0c1xuICAgICAgaWYgKHByaXZhdGVLZXkuc3RhcnRzV2l0aCgnXCInKSAmJiBwcml2YXRlS2V5LmVuZHNXaXRoKCdcIicpKSB7XG4gICAgICAgIHByaXZhdGVLZXkgPSBwcml2YXRlS2V5LnNsaWNlKDEsIC0xKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gUmVwbGFjZSBlc2NhcGVkIG5ld2xpbmVzIHdpdGggYWN0dWFsIG5ld2xpbmVzXG4gICAgICBwcml2YXRlS2V5ID0gcHJpdmF0ZUtleS5yZXBsYWNlKC9cXFxcbi9nLCAnXFxuJyk7XG4gICAgICBcbiAgICAgIC8vIFZhbGlkYXRlIHRoZSBwcml2YXRlIGtleSBmb3JtYXRcbiAgICAgIGlmICghcHJpdmF0ZUtleS5pbmNsdWRlcygnQkVHSU4gUFJJVkFURSBLRVknKSB8fCAhcHJpdmF0ZUtleS5pbmNsdWRlcygnRU5EIFBSSVZBVEUgS0VZJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHByaXZhdGUga2V5IGZvcm1hdCAtIG11c3QgY29udGFpbiBCRUdJTiBhbmQgRU5EIFBSSVZBVEUgS0VZIG1hcmtlcnMnKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ/CflKcgSW5pdGlhbGl6aW5nIEZpcmViYXNlIEFkbWluIHdpdGggY2xlYW5lZCBjcmVkZW50aWFscy4uLicpO1xuICAgICAgXG4gICAgICBjb25zdCBzZXJ2aWNlQWNjb3VudCA9IHtcbiAgICAgICAgcHJvamVjdElkOiBwcm9jZXNzLmVudi5GSVJFQkFTRV9QUk9KRUNUX0lELFxuICAgICAgICBjbGllbnRFbWFpbDogcHJvY2Vzcy5lbnYuRklSRUJBU0VfQ0xJRU5UX0VNQUlMLFxuICAgICAgICBwcml2YXRlS2V5OiBwcml2YXRlS2V5LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgYXBwID0gaW5pdGlhbGl6ZUFwcCh7XG4gICAgICAgIGNyZWRlbnRpYWw6IGNlcnQoc2VydmljZUFjY291bnQpLFxuICAgICAgICBwcm9qZWN0SWQ6IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQsXG4gICAgICB9KTtcblxuICAgICAgYWRtaW5EYiA9IGdldEZpcmVzdG9yZShhcHApO1xuICAgICAgY29uc29sZS5sb2coJ+KchSBGaXJlYmFzZSBBZG1pbiBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgIFxuICAgICAgLy8gVGVzdCB0aGUgY29ubmVjdGlvbiBhc3luY2hyb25vdXNseVxuICAgICAgdGVzdEZpcmViYXNlQ29ubmVjdGlvbihhZG1pbkRiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWRtaW5EYiA9IGdldEZpcmVzdG9yZSgpO1xuICAgICAgY29uc29sZS5sb2coJ+KchSBGaXJlYmFzZSBBZG1pbiBhbHJlYWR5IGluaXRpYWxpemVkJyk7XG4gICAgfVxuICB9XG59IGNhdGNoIChlcnJvcikge1xuICBjb25zb2xlLmVycm9yKCfinYwgRmlyZWJhc2UgQWRtaW4gaW5pdGlhbGl6YXRpb24gZmFpbGVkOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSk7XG4gIGNvbnNvbGUubG9nKCfwn5qrIEZpcmViYXNlIEFkbWluIGRpc2FibGVkIC0gdXNpbmcgbW9jayBkYXRhIGZvciBkZXZlbG9wbWVudCcpO1xuICBhZG1pbkRiID0gbnVsbDtcbn1cblxuZXhwb3J0IHsgYWRtaW5EYiB9OyAiXSwibmFtZXMiOlsiaW5pdGlhbGl6ZUFwcCIsImdldEFwcHMiLCJjZXJ0IiwiZ2V0RmlyZXN0b3JlIiwiY29uc29sZSIsImxvZyIsImhhc1Byb2plY3RJZCIsInByb2Nlc3MiLCJlbnYiLCJGSVJFQkFTRV9QUk9KRUNUX0lEIiwiaGFzQ2xpZW50RW1haWwiLCJGSVJFQkFTRV9DTElFTlRfRU1BSUwiLCJoYXNQcml2YXRlS2V5IiwiRklSRUJBU0VfUFJJVkFURV9LRVkiLCJpc1ZhbGlkUHJpdmF0ZUtleSIsImluY2x1ZGVzIiwiaGFzVmFsaWRDcmVkZW50aWFscyIsInByaXZhdGVLZXlMZW5ndGgiLCJsZW5ndGgiLCJhZG1pbkRiIiwidGVzdEZpcmViYXNlQ29ubmVjdGlvbiIsImRiIiwiY29sbGVjdGlvbiIsImxpbWl0IiwiZ2V0IiwidGVzdEVycm9yIiwid2FybiIsIkVycm9yIiwibWVzc2FnZSIsIlN0cmluZyIsInByaXZhdGVLZXkiLCJzdGFydHNXaXRoIiwiZW5kc1dpdGgiLCJzbGljZSIsInJlcGxhY2UiLCJzZXJ2aWNlQWNjb3VudCIsInByb2plY3RJZCIsImNsaWVudEVtYWlsIiwiYXBwIiwiY3JlZGVudGlhbCIsImVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/firebase-admin.ts\n");

/***/ }),

/***/ "(api)/./lib/firebase.ts":
/*!*************************!*\
  !*** ./lib/firebase.ts ***!
  \*************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   db: () => (/* binding */ db)\n/* harmony export */ });\n/* harmony import */ var firebase_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/app */ \"firebase/app\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/firestore */ \"firebase/firestore\");\n/* harmony import */ var firebase_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! firebase/auth */ \"firebase/auth\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([firebase_app__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__, firebase_auth__WEBPACK_IMPORTED_MODULE_2__]);\n([firebase_app__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__, firebase_auth__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyBhg_QAiNn65doXbbD7f-a7Q7s5i0Rqm_k\",\n    authDomain: \"askitai.firebaseapp.com\",\n    projectId: \"askitai\",\n    storageBucket: \"askitai.firebasestorage.app\",\n    messagingSenderId: \"946988582968\",\n    appId: \"1:946988582968:web:6d6a97b69ab0a61169becd\"\n};\n// Initialize Firebase only if not already initialized\nconst app = (0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.getApps)().length === 0 ? (0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.initializeApp)(firebaseConfig) : (0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.getApps)()[0];\nconst db = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getFirestore)(app);\nconst auth = (0,firebase_auth__WEBPACK_IMPORTED_MODULE_2__.getAuth)(app);\nconsole.log(\"✅ Firebase client initialized with Auth\");\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvZmlyZWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0Q7QUFDSjtBQUNWO0FBRXhDLE1BQU1JLGlCQUFpQjtJQUNyQkMsUUFBUUMseUNBQXdDO0lBQ2hERyxZQUFZSCx5QkFBNEM7SUFDeERLLFdBQVdMLFNBQTJDO0lBQ3RETyxlQUFlUCw2QkFBK0M7SUFDOURTLG1CQUFtQlQsY0FBb0Q7SUFDdkVXLE9BQU9YLDJDQUF1QztBQUNoRDtBQUVBLHNEQUFzRDtBQUN0RCxNQUFNYSxNQUFNbEIscURBQU9BLEdBQUdtQixNQUFNLEtBQUssSUFBSXBCLDJEQUFhQSxDQUFDSSxrQkFBa0JILHFEQUFPQSxFQUFFLENBQUMsRUFBRTtBQUUxRSxNQUFNb0IsS0FBS25CLGdFQUFZQSxDQUFDaUIsS0FBSztBQUM3QixNQUFNRyxPQUFPbkIsc0RBQU9BLENBQUNnQixLQUFLO0FBRWpDSSxRQUFRQyxHQUFHLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hc3F1ZS1ib3QtcGxhdGZvcm0vLi9saWIvZmlyZWJhc2UudHM/NWQyMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbml0aWFsaXplQXBwLCBnZXRBcHBzIH0gZnJvbSAnZmlyZWJhc2UvYXBwJztcbmltcG9ydCB7IGdldEZpcmVzdG9yZSB9IGZyb20gJ2ZpcmViYXNlL2ZpcmVzdG9yZSc7XG5pbXBvcnQgeyBnZXRBdXRoIH0gZnJvbSAnZmlyZWJhc2UvYXV0aCc7XG5cbmNvbnN0IGZpcmViYXNlQ29uZmlnID0ge1xuICBhcGlLZXk6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX0FQSV9LRVksXG4gIGF1dGhEb21haW46IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX0FVVEhfRE9NQUlOLFxuICBwcm9qZWN0SWQ6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX1BST0pFQ1RfSUQsXG4gIHN0b3JhZ2VCdWNrZXQ6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX1NUT1JBR0VfQlVDS0VULFxuICBtZXNzYWdpbmdTZW5kZXJJZDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfRklSRUJBU0VfTUVTU0FHSU5HX1NFTkRFUl9JRCxcbiAgYXBwSWQ6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZJUkVCQVNFX0FQUF9JRCxcbn07XG5cbi8vIEluaXRpYWxpemUgRmlyZWJhc2Ugb25seSBpZiBub3QgYWxyZWFkeSBpbml0aWFsaXplZFxuY29uc3QgYXBwID0gZ2V0QXBwcygpLmxlbmd0aCA9PT0gMCA/IGluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpIDogZ2V0QXBwcygpWzBdO1xuXG5leHBvcnQgY29uc3QgZGIgPSBnZXRGaXJlc3RvcmUoYXBwKTtcbmV4cG9ydCBjb25zdCBhdXRoID0gZ2V0QXV0aChhcHApO1xuXG5jb25zb2xlLmxvZygn4pyFIEZpcmViYXNlIGNsaWVudCBpbml0aWFsaXplZCB3aXRoIEF1dGgnKTsgIl0sIm5hbWVzIjpbImluaXRpYWxpemVBcHAiLCJnZXRBcHBzIiwiZ2V0RmlyZXN0b3JlIiwiZ2V0QXV0aCIsImZpcmViYXNlQ29uZmlnIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0ZJUkVCQVNFX0FQSV9LRVkiLCJhdXRoRG9tYWluIiwiTkVYVF9QVUJMSUNfRklSRUJBU0VfQVVUSF9ET01BSU4iLCJwcm9qZWN0SWQiLCJORVhUX1BVQkxJQ19GSVJFQkFTRV9QUk9KRUNUX0lEIiwic3RvcmFnZUJ1Y2tldCIsIk5FWFRfUFVCTElDX0ZJUkVCQVNFX1NUT1JBR0VfQlVDS0VUIiwibWVzc2FnaW5nU2VuZGVySWQiLCJORVhUX1BVQkxJQ19GSVJFQkFTRV9NRVNTQUdJTkdfU0VOREVSX0lEIiwiYXBwSWQiLCJORVhUX1BVQkxJQ19GSVJFQkFTRV9BUFBfSUQiLCJhcHAiLCJsZW5ndGgiLCJkYiIsImF1dGgiLCJjb25zb2xlIiwibG9nIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/firebase.ts\n");

/***/ }),

/***/ "(api)/./pages/api/chats/index.ts":
/*!**********************************!*\
  !*** ./pages/api/chats/index.ts ***!
  \**********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _lib_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/database */ \"(api)/./lib/database/index.ts\");\n/* harmony import */ var _lib_auth_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth/server */ \"(api)/./lib/auth/server.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_database__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst handler = async (req, res)=>{\n    console.log(`📱 User chats API called for: ${req.user.uid}`);\n    if (req.method === \"GET\") {\n        try {\n            // Get all chat sessions for this user\n            const userSessions = await _lib_database__WEBPACK_IMPORTED_MODULE_0__.serverDb.getChatSessionsByUser(req.user.uid);\n            // Convert to chat summaries\n            const chatSummaries = userSessions.map((session)=>({\n                    sessionId: session.id,\n                    botId: session.botId,\n                    botName: session.botName,\n                    botProfilePictureUrl: session.botProfilePictureUrl,\n                    lastMessage: session.messages.length > 0 ? session.messages[session.messages.length - 1].content : \"Chat started\",\n                    lastMessageTime: session.lastActivityAt,\n                    messageCount: session.messageCount,\n                    isActive: !session.isCompleted\n                }));\n            console.log(`✅ Found ${chatSummaries.length} chat sessions for user: ${req.user.uid}`);\n            return res.status(200).json({\n                success: true,\n                data: chatSummaries,\n                timestamp: new Date()\n            });\n        } catch (error) {\n            console.error(\"\\uD83D\\uDCA5 Error fetching user chats:\", error);\n            return res.status(500).json({\n                success: false,\n                error: \"Failed to load chat history. Please try again.\",\n                timestamp: new Date()\n            });\n        }\n    }\n    return res.status(405).json({\n        success: false,\n        error: \"Method not allowed\",\n        timestamp: new Date()\n    });\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_auth_server__WEBPACK_IMPORTED_MODULE_1__.withAuth)(handler));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvY2hhdHMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQzBDO0FBQ3lCO0FBR25FLE1BQU1FLFVBQVUsT0FDZEMsS0FDQUM7SUFFQUMsUUFBUUMsR0FBRyxDQUFDLENBQUMsOEJBQThCLEVBQUVILElBQUlJLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUM7SUFFM0QsSUFBSUwsSUFBSU0sTUFBTSxLQUFLLE9BQU87UUFDeEIsSUFBSTtZQUNGLHNDQUFzQztZQUN0QyxNQUFNQyxlQUFlLE1BQU1WLG1EQUFRQSxDQUFDVyxxQkFBcUIsQ0FBQ1IsSUFBSUksSUFBSSxDQUFDQyxHQUFHO1lBRXRFLDRCQUE0QjtZQUM1QixNQUFNSSxnQkFBbUNGLGFBQWFHLEdBQUcsQ0FBQ0MsQ0FBQUEsVUFBWTtvQkFDcEVDLFdBQVdELFFBQVFFLEVBQUU7b0JBQ3JCQyxPQUFPSCxRQUFRRyxLQUFLO29CQUNwQkMsU0FBU0osUUFBUUksT0FBTztvQkFDeEJDLHNCQUFzQkwsUUFBUUssb0JBQW9CO29CQUNsREMsYUFBYU4sUUFBUU8sUUFBUSxDQUFDQyxNQUFNLEdBQUcsSUFDbkNSLFFBQVFPLFFBQVEsQ0FBQ1AsUUFBUU8sUUFBUSxDQUFDQyxNQUFNLEdBQUcsRUFBRSxDQUFDQyxPQUFPLEdBQ3JEO29CQUNKQyxpQkFBaUJWLFFBQVFXLGNBQWM7b0JBQ3ZDQyxjQUFjWixRQUFRWSxZQUFZO29CQUNsQ0MsVUFBVSxDQUFDYixRQUFRYyxXQUFXO2dCQUNoQztZQUVBdkIsUUFBUUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFTSxjQUFjVSxNQUFNLENBQUMseUJBQXlCLEVBQUVuQixJQUFJSSxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDO1lBRXJGLE9BQU9KLElBQUl5QixNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsU0FBUztnQkFDVEMsTUFBTXBCO2dCQUNOcUIsV0FBVyxJQUFJQztZQUNqQjtRQUVGLEVBQUUsT0FBT0MsT0FBTztZQUNkOUIsUUFBUThCLEtBQUssQ0FBQywyQ0FBaUNBO1lBQy9DLE9BQU8vQixJQUFJeUIsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFDMUJDLFNBQVM7Z0JBQ1RJLE9BQU87Z0JBQ1BGLFdBQVcsSUFBSUM7WUFDakI7UUFDRjtJQUNGO0lBRUEsT0FBTzlCLElBQUl5QixNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1FBQzFCQyxTQUFTO1FBQ1RJLE9BQU87UUFDUEYsV0FBVyxJQUFJQztJQUNqQjtBQUNGO0FBRUEsaUVBQWVqQywwREFBUUEsQ0FBQ0MsUUFBUUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL2FzcXVlLWJvdC1wbGF0Zm9ybS8uL3BhZ2VzL2FwaS9jaGF0cy9pbmRleC50cz9jODNiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHsgc2VydmVyRGIgfSBmcm9tICdAL2xpYi9kYXRhYmFzZSc7XG5pbXBvcnQgeyB3aXRoQXV0aCwgQXV0aGVudGljYXRlZFJlcXVlc3QgfSBmcm9tICdAL2xpYi9hdXRoL3NlcnZlcic7XG5pbXBvcnQgeyBHZXRVc2VyQ2hhdHNSZXNwb25zZSwgVXNlckNoYXRTdW1tYXJ5IH0gZnJvbSAnQC90eXBlcyc7XG5cbmNvbnN0IGhhbmRsZXIgPSBhc3luYyAoXG4gIHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlPEdldFVzZXJDaGF0c1Jlc3BvbnNlPlxuKSA9PiB7XG4gIGNvbnNvbGUubG9nKGDwn5OxIFVzZXIgY2hhdHMgQVBJIGNhbGxlZCBmb3I6ICR7cmVxLnVzZXIudWlkfWApO1xuXG4gIGlmIChyZXEubWV0aG9kID09PSAnR0VUJykge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgYWxsIGNoYXQgc2Vzc2lvbnMgZm9yIHRoaXMgdXNlclxuICAgICAgY29uc3QgdXNlclNlc3Npb25zID0gYXdhaXQgc2VydmVyRGIuZ2V0Q2hhdFNlc3Npb25zQnlVc2VyKHJlcS51c2VyLnVpZCk7XG4gICAgICBcbiAgICAgIC8vIENvbnZlcnQgdG8gY2hhdCBzdW1tYXJpZXNcbiAgICAgIGNvbnN0IGNoYXRTdW1tYXJpZXM6IFVzZXJDaGF0U3VtbWFyeVtdID0gdXNlclNlc3Npb25zLm1hcChzZXNzaW9uID0+ICh7XG4gICAgICAgIHNlc3Npb25JZDogc2Vzc2lvbi5pZCxcbiAgICAgICAgYm90SWQ6IHNlc3Npb24uYm90SWQsXG4gICAgICAgIGJvdE5hbWU6IHNlc3Npb24uYm90TmFtZSxcbiAgICAgICAgYm90UHJvZmlsZVBpY3R1cmVVcmw6IHNlc3Npb24uYm90UHJvZmlsZVBpY3R1cmVVcmwsXG4gICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLm1lc3NhZ2VzLmxlbmd0aCA+IDAgXG4gICAgICAgICAgPyBzZXNzaW9uLm1lc3NhZ2VzW3Nlc3Npb24ubWVzc2FnZXMubGVuZ3RoIC0gMV0uY29udGVudCBcbiAgICAgICAgICA6ICdDaGF0IHN0YXJ0ZWQnLFxuICAgICAgICBsYXN0TWVzc2FnZVRpbWU6IHNlc3Npb24ubGFzdEFjdGl2aXR5QXQsXG4gICAgICAgIG1lc3NhZ2VDb3VudDogc2Vzc2lvbi5tZXNzYWdlQ291bnQsXG4gICAgICAgIGlzQWN0aXZlOiAhc2Vzc2lvbi5pc0NvbXBsZXRlZFxuICAgICAgfSkpO1xuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIEZvdW5kICR7Y2hhdFN1bW1hcmllcy5sZW5ndGh9IGNoYXQgc2Vzc2lvbnMgZm9yIHVzZXI6ICR7cmVxLnVzZXIudWlkfWApO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjaGF0U3VtbWFyaWVzLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICAgIH0pO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ/CfkqUgRXJyb3IgZmV0Y2hpbmcgdXNlciBjaGF0czonLCBlcnJvcik7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gbG9hZCBjaGF0IGhpc3RvcnkuIFBsZWFzZSB0cnkgYWdhaW4uJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oe1xuICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgIGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyxcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgfSk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCB3aXRoQXV0aChoYW5kbGVyKTsgIl0sIm5hbWVzIjpbInNlcnZlckRiIiwid2l0aEF1dGgiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwiY29uc29sZSIsImxvZyIsInVzZXIiLCJ1aWQiLCJtZXRob2QiLCJ1c2VyU2Vzc2lvbnMiLCJnZXRDaGF0U2Vzc2lvbnNCeVVzZXIiLCJjaGF0U3VtbWFyaWVzIiwibWFwIiwic2Vzc2lvbiIsInNlc3Npb25JZCIsImlkIiwiYm90SWQiLCJib3ROYW1lIiwiYm90UHJvZmlsZVBpY3R1cmVVcmwiLCJsYXN0TWVzc2FnZSIsIm1lc3NhZ2VzIiwibGVuZ3RoIiwiY29udGVudCIsImxhc3RNZXNzYWdlVGltZSIsImxhc3RBY3Rpdml0eUF0IiwibWVzc2FnZUNvdW50IiwiaXNBY3RpdmUiLCJpc0NvbXBsZXRlZCIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsInRpbWVzdGFtcCIsIkRhdGUiLCJlcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/chats/index.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchats&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchats%2Findex.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();